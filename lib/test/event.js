/// <reference path="../../typings/index.d.ts"/>
Object.defineProperty(exports, "__esModule", { value: true });
const chai = require("chai");
const event_1 = require("../event");
let expect = chai.expect;
describe("EventProperty", () => {
    it("constructor", () => {
        new event_1.EventProperty();
    });
    describe(".on()", () => {
        testTriggers("on");
        it("invokes all listeners", (done) => {
            let event = new event_1.EventProperty.Void();
            let resolve1 = null;
            let resolve2 = null;
            let promise1 = new Promise((resolve) => { resolve1 = resolve; });
            let promise2 = new Promise((resolve) => { resolve2 = resolve; });
            event.on(resolve1);
            event.on(resolve2);
            Promise.all([promise1, promise2]).then(function () { done(); }).catch(done);
            event.emit();
        });
        it("invokes listeners on each emit", (done) => {
            let event = new event_1.EventProperty.Void();
            let nExpected = 5;
            let nRegistered = 0;
            event.on(() => {
                nRegistered++;
                if (nRegistered === nExpected)
                    done();
            });
            for (let i = 0; i < nExpected; i++)
                event.emit();
        });
    });
    describe(".off()", () => {
        it("by handler", () => {
            let event = new event_1.EventProperty.Void();
            let handler = () => {
                throw new Error("Should not be invoked");
            };
            event.on(handler);
            event.off(handler);
            event.emit();
        });
        it("by id", () => {
            let event = new event_1.EventProperty.Void();
            let handler = () => {
                throw new Error("Should not be invoked");
            };
            let id = event.on(handler);
            event.off(id);
            event.emit();
        });
        it("by context", (done) => {
            let event = new event_1.EventProperty.Void();
            let context = {};
            let handler = function () {
                if (this === context)
                    throw new Error("Should not be invoked");
                else
                    done();
            };
            // Off by context should remove all handlers with the
            // context but should not affect the handlers passed without context
            event.on(handler, context);
            event.on(handler, context);
            event.on(handler);
            event.off(context);
            event.emit();
        });
        it("clears", (done) => {
            let event = new event_1.EventProperty.Void();
            let handler = function () {
                if (this === context)
                    throw new Error("Should not be invoked");
                else
                    done();
            };
            // Off by context should remove all handlers with the
            // context but should not affect the handlers passed without context
            event.on(handler);
            event.on(handler);
            event.off();
            setTimeout(done, 10);
            event.emit();
        });
    });
    describe(".once()", () => {
        testTriggers("once");
        it("triggers once", () => {
            let event = new event_1.EventProperty.Void();
            let isFirst = true;
            event.once(function () {
                chai.assert(isFirst);
                isFirst = false;
            });
            event.emit();
            event.emit();
        });
    });
    describe(".match()", () => {
        testMatchTriggers("match");
        it("matches object part", (done) => {
            let event = new event_1.EventProperty();
            event.match({ a: 1, b: 2 }, function () { done(); });
            event.emit({ a: 1, b: 2, c: 3, d: "x" });
        });
        it("matches deeper", (done) => {
            let event = new event_1.EventProperty();
            event.match({ a: { x: "y" }, c: [1, 2] }, function () { done(); });
            event.emit({ a: { x: "y", z: { r: 1 } }, c: [1, 2, { x: "?" }, null] });
        });
        it("matches regexp", (done) => {
            let event = new event_1.EventProperty();
            event.match(/test[123]+x/, function () { done(); });
            event.emit("test-test2xs");
        });
    });
    describe(".matchOnce()", () => {
        testMatchTriggers("matchOnce");
        it("matches once", () => {
            let event = new event_1.EventProperty();
            let isFirst = true;
            event.matchOnce("match", function () {
                chai.assert(isFirst);
                isFirst = false;
            });
            event.emit("match");
            event.emit("match");
            event.emit("unmatch");
        });
    });
    describe(".pipe()", () => {
        it("passes argument, get listenerId", (done) => {
            let eventFrom = new event_1.EventProperty();
            let eventTo = new event_1.EventProperty();
            let testArg = "test";
            eventTo.on(function (arg) {
                expect(arg).to.equal(testArg);
                done();
            });
            let id = eventFrom.pipe(eventTo);
            expect(typeof id).to.equal("number");
            eventFrom.emit(testArg);
        });
        it("offs with id", () => {
            let eventFrom = new event_1.EventProperty.Void();
            let eventTo = new event_1.EventProperty.Void();
            eventTo.on(function () { throw new Error("Should not happen"); });
            let id = eventFrom.pipe(eventTo);
            eventFrom.off(id);
            eventFrom.emit();
        });
        it("offs with event", () => {
            let eventFrom = new event_1.EventProperty.Void();
            let eventTo = new event_1.EventProperty.Void();
            eventTo.on(function () { throw new Error("Should not happen"); });
            eventFrom.pipe(eventTo);
            eventFrom.off(eventTo);
            eventFrom.emit();
        });
    });
    describe(".route()", () => {
        it("string", () => {
            let eventFrom = new event_1.EventProperty();
            let eventTo = new event_1.EventProperty();
            eventTo.on(function (arg) {
                expect(arg).to.equal("test");
            });
            let id = eventFrom.route("test", eventTo);
            expect(typeof id).to.equal("number");
            eventFrom.emit("test");
            eventFrom.emit("random");
            eventFrom.emit("any");
        });
        it("regexp", () => {
            let eventFrom = new event_1.EventProperty();
            let eventTo = new event_1.EventProperty();
            let pass = 1;
            eventTo.on(function (arg) {
                chai.assert(/^\/[a-zA-Z]*/.test(arg));
                chai.assert(!--pass);
            });
            let id = eventFrom.route(/^\/[a-zA-Z]+/, eventTo);
            expect(typeof id).to.equal("number");
            eventFrom.emit("/root");
            eventFrom.emit("random");
            eventFrom.emit("/34/");
        });
    });
    describe(".init()", () => {
        it("resolves with value", (done) => {
            let event = new event_1.EventProperty();
            let testArg = "test";
            event.init((arg) => {
                expect(arg).to.equal(testArg);
                done();
            });
            event.emit(testArg);
        });
        it("can be caught after emit", (done) => {
            let event = new event_1.EventProperty.Void();
            event.emit();
            event.init(() => {
                done();
            });
        });
        it("init handlers are invoked immediately", () => {
            let event = new event_1.EventProperty.Void();
            let flag = false;
            event.init(() => { flag = true; });
            event.emit();
            // Because promise is resolved in the next event-loop iteration
            expect(flag).to.equal(true);
        });
    });
    describe("Factory", () => {
        it("EventProperty.make()", (done) => {
            class Test {
                constructor() {
                    [this.event, this.emitter] = event_1.EventProperty.make();
                }
                test() {
                    this.event.emit("test");
                }
            }
            let instance = new Test();
            instance.emitter.on(() => done());
            instance.test();
        });
        it("EventProperty.split()", (done) => {
            class Test {
                constructor() {
                    [this.triggerEvent, this.event] = event_1.EventProperty.split();
                }
                test() {
                    this.triggerEvent("test");
                }
            }
            let instance = new Test();
            instance.event.on(() => done());
            instance.test();
        });
        it("EventProperty.splitVoid()", (done) => {
            class Test {
                constructor() {
                    [this.triggerEvent, this.event] = event_1.EventProperty.splitVoid();
                }
                test() {
                    this.triggerEvent();
                }
            }
            let instance = new Test();
            instance.event.on(() => done());
            instance.test();
        });
    });
    describe("timing", () => {
    });
});
function testTriggers(method) {
    it("returns listenerId", () => {
        let event = new event_1.EventProperty();
        let id = event[method](() => { });
        expect(typeof id).to.equal("number");
    });
    it("triggers", (done) => {
        let event = new event_1.EventProperty.Void();
        event[method](done);
        event.emit();
    });
    it("passes argument", (done) => {
        let testArg = "test";
        let event = new event_1.EventProperty();
        event[method]((arg) => {
            expect(arg).to.be.equal(testArg);
            done();
        });
        event.emit(testArg);
    });
    it("passes context", (done) => {
        let event = new event_1.EventProperty.Void();
        let listener;
        listener = {
            itIsListener: true,
            fn() {
                chai.expect(this).to.be.equal(listener);
                done();
            }
        };
        event[method](listener.fn, listener);
        event.emit();
    });
}
function testMatchTriggers(method) {
    let match = "testMatchValue";
    it("returns listenerId", () => {
        let event = new event_1.EventProperty();
        let id = event[method](match, () => { });
        expect(typeof id).to.equal("number");
    });
    it("triggers", (done) => {
        let event = new event_1.EventProperty();
        event[method](match, function () { done(); });
        event.emit(match);
    });
    it("passes argument", (done) => {
        let testArg = "test";
        let event = new event_1.EventProperty();
        event[method](testArg, (arg) => {
            expect(arg).to.be.equal(testArg);
            done();
        });
        event.emit(testArg);
    });
    it("passes context", (done) => {
        let event = new event_1.EventProperty();
        let listener;
        listener = {
            itIsListener: true,
            fn() {
                chai.expect(this).to.be.equal(listener);
                done();
            }
        };
        event[method](match, listener.fn, listener);
        event.emit(match);
    });
    it("ignores irrelevant emits", () => {
        let event = new event_1.EventProperty();
        event[method](match, function () { throw new Error("Must not be invoked"); });
        event.emit("");
        event.emit("abc");
        event.emit(null);
    });
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZXZlbnQuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi9zcmMvdGVzdC9ldmVudC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQSxnREFBZ0Q7O0FBRWhELDZCQUE2QjtBQUM3QixvQ0FBdUM7QUFFdkMsSUFBSSxNQUFNLEdBQUcsSUFBSSxDQUFDLE1BQU0sQ0FBQztBQUV6QixRQUFRLENBQUMsZUFBZSxFQUFFO0lBQ3RCLEVBQUUsQ0FBQyxhQUFhLEVBQUU7UUFDZCxJQUFJLHFCQUFhLEVBQVEsQ0FBQztJQUM5QixDQUFDLENBQUMsQ0FBQztJQUNILFFBQVEsQ0FBQyxPQUFPLEVBQUU7UUFDZCxZQUFZLENBQUMsSUFBSSxDQUFDLENBQUM7UUFFbkIsRUFBRSxDQUFDLHVCQUF1QixFQUFFLENBQUMsSUFBZTtZQUN4QyxJQUFJLEtBQUssR0FBRyxJQUFJLHFCQUFhLENBQUMsSUFBSSxFQUFFLENBQUM7WUFDckMsSUFBSSxRQUFRLEdBQWUsSUFBSSxDQUFDO1lBQ2hDLElBQUksUUFBUSxHQUFlLElBQUksQ0FBQztZQUNoQyxJQUFJLFFBQVEsR0FBaUIsSUFBSSxPQUFPLENBQU0sQ0FBQyxPQUFPLE9BQU8sUUFBUSxHQUFHLE9BQU8sQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDO1lBQ3BGLElBQUksUUFBUSxHQUFpQixJQUFJLE9BQU8sQ0FBTSxDQUFDLE9BQU8sT0FBTyxRQUFRLEdBQUcsT0FBTyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUM7WUFDcEYsS0FBSyxDQUFDLEVBQUUsQ0FBQyxRQUFRLENBQUMsQ0FBQztZQUNuQixLQUFLLENBQUMsRUFBRSxDQUFDLFFBQVEsQ0FBQyxDQUFDO1lBQ25CLE9BQU8sQ0FBQyxHQUFHLENBQUMsQ0FBQyxRQUFRLEVBQUUsUUFBUSxDQUFDLENBQUMsQ0FBQyxJQUFJLENBQUMsY0FBWSxJQUFJLEVBQUUsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLEtBQUssQ0FBQyxJQUFJLENBQUMsQ0FBQztZQUMx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O1NBQ0osQ0FBQztRQUNGLEtBQUssQ0FBQyxNQUFNLENBQUMsQ0FBQyxLQUFLLEVBQUUsUUFBUSxDQUFDLEVBQUUsRUFBRSxRQUFRLENBQUMsQ0FBQztRQUM1QyxLQUFLLENBQUMsSUFBSSxDQUFDLEtBQUssQ0FBQyxDQUFDO0lBQ3RCLENBQUMsQ0FBQyxDQUFDO0lBQ0gsRUFBRSxDQUFDLDBCQUEwQixFQUFFO1FBQzNCLElBQUksS0FBSyxHQUFHLElBQUkscUJBQWEsRUFBVSxDQUFDO1FBQ3hDLEtBQUssQ0FBQyxNQUFNLENBQUMsQ0FBQyxLQUFLLEVBQUUsY0FBYyxNQUFNLElBQUksS0FBSyxDQUFDLHFCQUFxQixDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQztRQUM5RSxLQUFLLENBQUMsSUFBSSxDQUFDLEVBQUUsQ0FBQyxDQUFDO1FBQ2YsS0FBSyxDQUFDLElBQUksQ0FBQyxLQUFLLENBQUMsQ0FBQztRQUNsQixLQUFLLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxDQUFDO0lBQ3JCLENBQUMsQ0FBQyxDQUFDO0FBQ1AsQ0FBQyIsInNvdXJjZXNDb250ZW50IjpbIi8vLyA8cmVmZXJlbmNlIHBhdGg9XCIuLi8uLi90eXBpbmdzL2luZGV4LmQudHNcIi8+XG5cbmltcG9ydCAqIGFzIGNoYWkgZnJvbSBcImNoYWlcIjtcbmltcG9ydCB7RXZlbnRQcm9wZXJ0eX0gZnJvbSBcIi4uL2V2ZW50XCI7XG5pbXBvcnQge2Fzc2VydH0gZnJvbSBcIn5jaGFpL2xpYi9DaGFpXCI7XG5sZXQgZXhwZWN0ID0gY2hhaS5leHBlY3Q7XG5cbmRlc2NyaWJlKFwiRXZlbnRQcm9wZXJ0eVwiLCAoKSA9PiB7XG4gICAgaXQoXCJjb25zdHJ1Y3RvclwiLCAoKSA9PiB7XG4gICAgICAgIG5ldyBFdmVudFByb3BlcnR5PHZvaWQ+KCk7XG4gICAgfSk7XG4gICAgZGVzY3JpYmUoXCIub24oKVwiLCAoKSA9PiB7XG4gICAgICAgIHRlc3RUcmlnZ2VycyhcIm9uXCIpO1xuXG4gICAgICAgIGl0KFwiaW52b2tlcyBhbGwgbGlzdGVuZXJzXCIsIChkb25lOiBNb2NoYURvbmUpID0+IHtcbiAgICAgICAgICAgIGxldCBldmVudCA9IG5ldyBFdmVudFByb3BlcnR5LlZvaWQoKTtcbiAgICAgICAgICAgIGxldCByZXNvbHZlMTogKCkgPT4gdm9pZCA9IG51bGw7XG4gICAgICAgICAgICBsZXQgcmVzb2x2ZTI6ICgpID0+IHZvaWQgPSBudWxsO1xuICAgICAgICAgICAgbGV0IHByb21pc2UxOiBQcm9taXNlPGFueT4gPSBuZXcgUHJvbWlzZTxhbnk+KChyZXNvbHZlKSA9PiB7IHJlc29sdmUxID0gcmVzb2x2ZTsgfSk7XG4gICAgICAgICAgICBsZXQgcHJvbWlzZTI6IFByb21pc2U8YW55PiA9IG5ldyBQcm9taXNlPGFueT4oKHJlc29sdmUpID0+IHsgcmVzb2x2ZTIgPSByZXNvbHZlOyB9KTtcbiAgICAgICAgICAgIGV2ZW50Lm9uKHJlc29sdmUxKTtcbiAgICAgICAgICAgIGV2ZW50Lm9uKHJlc29sdmUyKTtcbiAgICAgICAgICAgIFByb21pc2UuYWxsKFtwcm9taXNlMSwgcHJvbWlzZTJdKS50aGVuKGZ1bmN0aW9uKCl7IGRvbmUoKTsgfSkuY2F0Y2goZG9uZSk7XG4gICAgICAgICAgICBldmVudC5lbWl0KCk7XG4gICAgICAgIH0pO1xuICAgICAgICBpdChcImludm9rZXMgbGlzdGVuZXJzIG9uIGVhY2ggZW1pdFwiLCAoZG9uZTogTW9jaGFEb25lKSA9PiB7XG4gICAgICAgICAgICBsZXQgZXZlbnQgPSBuZXcgRXZlbnRQcm9wZXJ0eS5Wb2lkKCk7XG4gICAgICAgICAgICBsZXQgbkV4cGVjdGVkID0gNTtcbiAgICAgICAgICAgIGxldCBuUmVnaXN0ZXJlZCA9IDA7XG4gICAgICAgICAgICBldmVudC5vbigoKSA9PiB7XG4gICAgICAgICAgICAgICAgblJlZ2lzdGVyZWQrKztcbiAgICAgICAgICAgICAgICBpZiAoblJlZ2lzdGVyZWQgPT09IG5FeHBlY3RlZCkgZG9uZSgpO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IG5FeHBlY3RlZDsgaSsrKSBldmVudC5lbWl0KCk7XG4gICAgICAgIH0pO1xuICAgIH0pO1xuXG4gICAgZGVzY3JpYmUoXCIub2ZmKClcIiwgKCkgPT4ge1xuICAgICAgICBpdChcImJ5IGhhbmRsZXJcIiwgKCkgPT4ge1xuICAgICAgICAgICAgbGV0IGV2ZW50ID0gbmV3IEV2ZW50UHJvcGVydHkuVm9pZCgpO1xuICAgICAgICAgICAgbGV0IGhhbmRsZXIgPSAoKSA9PiB7XG4gICAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKFwiU2hvdWxkIG5vdCBiZSBpbnZva2VkXCIpO1xuICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgZXZlbnQub24oaGFuZGxlcik7XG4gICAgICAgICAgICBldmVudC5vZmYoaGFuZGxlcik7XG5cbiAgICAgICAgICAgIGV2ZW50LmVtaXQoKTtcbiAgICAgICAgfSk7XG4gICAgICAgIGl0KFwiYnkgaWRcIiwgKCkgPT4ge1xuICAgICAgICAgICAgbGV0IGV2ZW50ID0gbmV3IEV2ZW50UHJvcGVydHkuVm9pZCgpO1xuICAgICAgICAgICAgbGV0IGhhbmRsZXIgPSAoKSA9PiB7XG4gICAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKFwiU2hvdWxkIG5vdCBiZSBpbnZva2VkXCIpO1xuICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgbGV0IGlkID0gZXZlbnQub24oaGFuZGxlcik7XG4gICAgICAgICAgICBldmVudC5vZmYoaWQpO1xuXG4gICAgICAgICAgICBldmVudC5lbWl0KCk7XG4gICAgICAgIH0pO1xuICAgICAgICBpdChcImJ5IGNvbnRleHRcIiwgKGRvbmU6IE1vY2hhRG9uZSkgPT4ge1xuICAgICAgICAgICAgbGV0IGV2ZW50ID0gbmV3IEV2ZW50UHJvcGVydHkuVm9pZCgpO1xuICAgICAgICAgICAgbGV0IGNvbnRleHQgPSB7fTtcbiAgICAgICAgICAgIGxldCBoYW5kbGVyID0gZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgaWYgKHRoaXMgPT09IGNvbnRleHQpXG4gICAgICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihcIlNob3VsZCBub3QgYmUgaW52b2tlZFwiKTtcbiAgICAgICAgICAgICAgICBlbHNlXG4gICAgICAgICAgICAgICAgICAgIGRvbmUoKTtcbiAgICAgICAgICAgIH07XG4gICAgICAgICAgICAvLyBPZmYgYnkgY29udGV4dCBzaG91bGQgcmVtb3ZlIGFsbCBoYW5kbGVycyB3aXRoIHRoZVxuICAgICAgICAgICAgLy8gY29udGV4dCBidXQgc2hvdWxkIG5vdCBhZmZlY3QgdGhlIGhhbmRsZXJzIHBhc3NlZCB3aXRob3V0IGNvbnRleHRcblxuICAgICAgICAgICAgZXZlbnQub24oaGFuZGxlciwgY29udGV4dCk7XG4gICAgICAgICAgICBldmVudC5vbihoYW5kbGVyLCBjb250ZXh0KTtcbiAgICAgICAgICAgIGV2ZW50Lm9uKGhhbmRsZXIpO1xuICAgICAgICAgICAgZXZlbnQub2ZmKGNvbnRleHQpO1xuXG4gICAgICAgICAgICBldmVudC5lbWl0KCk7XG4gICAgICAgIH0pO1xuICAgICAgICBpdChcImNsZWFyc1wiLCAoZG9uZTogTW9jaGFEb25lKSA9PiB7XG4gICAgICAgICAgICBsZXQgZXZlbnQgPSBuZXcgRXZlbnRQcm9wZXJ0eS5Wb2lkKCk7XG4gICAgICAgICAgICBsZXQgaGFuZGxlciA9IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgIGlmICh0aGlzID09PSBjb250ZXh0KVxuICAgICAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXCJTaG91bGQgbm90IGJlIGludm9rZWRcIik7XG4gICAgICAgICAgICAgICAgZWxzZVxuICAgICAgICAgICAgICAgICAgICBkb25lKCk7XG4gICAgICAgICAgICB9O1xuICAgICAgICAgICAgLy8gT2ZmIGJ5IGNvbnRleHQgc2hvdWxkIHJlbW92ZSBhbGwgaGFuZGxlcnMgd2l0aCB0aGVcbiAgICAgICAgICAgIC8vIGNvbnRleHQgYnV0IHNob3VsZCBub3QgYWZmZWN0IHRoZSBoYW5kbGVycyBwYXNzZWQgd2l0aG91dCBjb250ZXh0XG4gICAgICAgICAgICBldmVudC5vbihoYW5kbGVyKTtcbiAgICAgICAgICAgIGV2ZW50Lm9uKGhhbmRsZXIpO1xuICAgICAgICAgICAgZXZlbnQub2ZmKCk7XG4gICAgICAgICAgICBzZXRUaW1lb3V0KGRvbmUsIDEwKTtcblxuICAgICAgICAgICAgZXZlbnQuZW1pdCgpO1xuICAgICAgICB9KTtcbiAgICB9KTtcblxuICAgIGRlc2NyaWJlKFwiLm9uY2UoKVwiLCAoKSA9PiB7XG4gICAgICAgIHRlc3RUcmlnZ2VycyhcIm9uY2VcIik7XG5cbiAgICAgICAgaXQoXCJ0cmlnZ2VycyBvbmNlXCIsICgpID0+IHtcbiAgICAgICAgICAgIGxldCBldmVudCA9IG5ldyBFdmVudFByb3BlcnR5LlZvaWQoKTtcbiAgICAgICAgICAgIGxldCBpc0ZpcnN0ID0gdHJ1ZTtcbiAgICAgICAgICAgIGV2ZW50Lm9uY2UoZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgIGNoYWkuYXNzZXJ0KGlzRmlyc3QpO1xuICAgICAgICAgICAgICAgIGlzRmlyc3QgPSBmYWxzZTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgZXZlbnQuZW1pdCgpO1xuICAgICAgICAgICAgZXZlbnQuZW1pdCgpO1xuICAgICAgICB9KTtcbiAgICB9KTtcbiAgICBkZXNjcmliZShcIi5tYXRjaCgpXCIsICgpID0+IHtcbiAgICAgICAgdGVzdE1hdGNoVHJpZ2dlcnMoXCJtYXRjaFwiKTtcblxuICAgICAgICBpdChcIm1hdGNoZXMgb2JqZWN0IHBhcnRcIiwgKGRvbmU6IE1vY2hhRG9uZSkgPT4ge1xuICAgICAgICAgICAgbGV0IGV2ZW50ID0gbmV3IEV2ZW50UHJvcGVydHk8YW55PigpO1xuICAgICAgICAgICAgZXZlbnQubWF0Y2goeyBhOiAxLCBiOiAyIH0sIGZ1bmN0aW9uICgpIHsgZG9uZSgpOyB9KTtcbiAgICAgICAgICAgIGV2ZW50LmVtaXQoeyBhOiAxLCBiOiAyLCBjOiAzLCBkOiBcInhcIn0pO1xuICAgICAgICB9KTtcbiAgICAgICAgaXQoXCJtYXRjaGVzIGRlZXBlclwiLCAoZG9uZTogTW9jaGFEb25lKSA9PiB7XG4gICAgICAgICAgICBsZXQgZXZlbnQgPSBuZXcgRXZlbnRQcm9wZXJ0eTxhbnk+KCk7XG4gICAgICAgICAgICBldmVudC5tYXRjaCh7IGE6IHt4IDogXCJ5XCJ9LCBjOiBbMSwgMl0gfSwgZnVuY3Rpb24gKCkgeyBkb25lKCk7IH0pO1xuICAgICAgICAgICAgZXZlbnQuZW1pdCh7IGE6IHt4IDogXCJ5XCIsIHo6IHtyOiAxfX0sIGM6IFsxLCAyLCB7IHg6IFwiP1wifSwgbnVsbF0gfSk7XG4gICAgICAgIH0pO1xuICAgICAgICBpdChcIm1hdGNoZXMgcmVnZXhwXCIsIChkb25lOiBNb2NoYURvbmUpID0+IHtcbiAgICAgICAgICAgIGxldCBldmVudCA9IG5ldyBFdmVudFByb3BlcnR5PGFueT4oKTtcbiAgICAgICAgICAgIGV2ZW50Lm1hdGNoKC90ZXN0WzEyM10reC8sIGZ1bmN0aW9uICgpIHsgZG9uZSgpOyB9KTtcbiAgICAgICAgICAgIGV2ZW50LmVtaXQoXCJ0ZXN0LXRlc3QyeHNcIik7XG4gICAgICAgIH0pO1xuICAgIH0pO1xuICAgIGRlc2NyaWJlKFwiLm1hdGNoT25jZSgpXCIsICgpID0+IHtcbiAgICAgICAgdGVzdE1hdGNoVHJpZ2dlcnMoXCJtYXRjaE9uY2VcIik7XG5cbiAgICAgICAgaXQoXCJtYXRjaGVzIG9uY2VcIiwgKCkgPT4ge1xuICAgICAgICAgICAgbGV0IGV2ZW50ID0gbmV3IEV2ZW50UHJvcGVydHk8c3RyaW5nPigpO1xuICAgICAgICAgICAgbGV0IGlzRmlyc3QgPSB0cnVlO1xuICAgICAgICAgICAgZXZlbnQubWF0Y2hPbmNlKFwibWF0Y2hcIiwgZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgIGNoYWkuYXNzZXJ0KGlzRmlyc3QpO1xuICAgICAgICAgICAgICAgIGlzRmlyc3QgPSBmYWxzZTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgZXZlbnQuZW1pdChcIm1hdGNoXCIpO1xuICAgICAgICAgICAgZXZlbnQuZW1pdChcIm1hdGNoXCIpO1xuICAgICAgICAgICAgZXZlbnQuZW1pdChcInVubWF0Y2hcIik7XG4gICAgICAgIH0pO1xuICAgIH0pO1xuICAgIGRlc2NyaWJlKFwiLnBpcGUoKVwiLCAoKSA9PiB7XG4gICAgICAgIGl0KFwicGFzc2VzIGFyZ3VtZW50LCBnZXQgbGlzdGVuZXJJZFwiLCAoZG9uZTogTW9jaGFEb25lKSA9PiB7XG4gICAgICAgICAgICBsZXQgZXZlbnRGcm9tID0gbmV3IEV2ZW50UHJvcGVydHk8c3RyaW5nPigpO1xuICAgICAgICAgICAgbGV0IGV2ZW50VG8gPSBuZXcgRXZlbnRQcm9wZXJ0eTxzdHJpbmc+KCk7XG4gICAgICAgICAgICBsZXQgdGVzdEFyZyA9IFwidGVzdFwiO1xuICAgICAgICAgICAgZXZlbnRUby5vbihmdW5jdGlvbiAoYXJnOiBzdHJpbmcpIHtcbiAgICAgICAgICAgICAgICBleHBlY3QoYXJnKS50by5lcXVhbCh0ZXN0QXJnKTtcbiAgICAgICAgICAgICAgICBkb25lKCk7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIGxldCBpZCA9IGV2ZW50RnJvbS5waXBlKGV2ZW50VG8pO1xuICAgICAgICAgICAgZXhwZWN0KHR5cGVvZiBpZCkudG8uZXF1YWwoXCJudW1iZXJcIik7XG4gICAgICAgICAgICBldmVudEZyb20uZW1pdCh0ZXN0QXJnKTtcbiAgICAgICAgfSk7XG4gICAgICAgIGl0KFwib2ZmcyB3aXRoIGlkXCIsICgpID0+IHtcbiAgICAgICAgICAgIGxldCBldmVudEZyb20gPSBuZXcgRXZlbnRQcm9wZXJ0eS5Wb2lkKCk7XG4gICAgICAgICAgICBsZXQgZXZlbnRUbyA9IG5ldyBFdmVudFByb3BlcnR5LlZvaWQoKTtcblxuICAgICAgICAgICAgZXZlbnRUby5vbihmdW5jdGlvbiAoKSB7IHRocm93IG5ldyBFcnJvcihcIlNob3VsZCBub3QgaGFwcGVuXCIpOyB9KTtcbiAgICAgICAgICAgIGxldCBpZCA9IGV2ZW50RnJvbS5waXBlKGV2ZW50VG8pO1xuICAgICAgICAgICAgZXZlbnRGcm9tLm9mZihpZCk7XG4gICAgICAgICAgICBldmVudEZyb20uZW1pdCgpO1xuICAgICAgICB9KTtcbiAgICAgICAgaXQoXCJvZmZzIHdpdGggZXZlbnRcIiwgKCkgPT4ge1xuICAgICAgICAgICAgbGV0IGV2ZW50RnJvbSA9IG5ldyBFdmVudFByb3BlcnR5LlZvaWQoKTtcbiAgICAgICAgICAgIGxldCBldmVudFRvID0gbmV3IEV2ZW50UHJvcGVydHkuVm9pZCgpO1xuXG4gICAgICAgICAgICBldmVudFRvLm9uKGZ1bmN0aW9uICgpIHsgdGhyb3cgbmV3IEVycm9yKFwiU2hvdWxkIG5vdCBoYXBwZW5cIik7IH0pO1xuICAgICAgICAgICAgZXZlbnRGcm9tLnBpcGUoZXZlbnRUbyk7XG4gICAgICAgICAgICBldmVudEZyb20ub2ZmKGV2ZW50VG8pO1xuICAgICAgICAgICAgZXZlbnRGcm9tLmVtaXQoKTtcbiAgICAgICAgfSk7XG4gICAgfSk7XG4gICAgZGVzY3JpYmUoXCIucm91dGUoKVwiLCAoKSA9PiB7XG4gICAgICAgIGl0KFwic3RyaW5nXCIsICgpID0+IHtcbiAgICAgICAgICAgIGxldCBldmVudEZyb20gPSBuZXcgRXZlbnRQcm9wZXJ0eTxzdHJpbmc+KCk7XG4gICAgICAgICAgICBsZXQgZXZlbnRUbyA9IG5ldyBFdmVudFByb3BlcnR5PHN0cmluZz4oKTtcblxuICAgICAgICAgICAgZXZlbnRUby5vbihmdW5jdGlvbiAoYXJnOiBzdHJpbmcpIHtcbiAgICAgICAgICAgICAgICBleHBlY3QoYXJnKS50by5lcXVhbChcInRlc3RcIik7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIGxldCBpZCA9IGV2ZW50RnJvbS5yb3V0ZShcInRlc3RcIiwgZXZlbnRUbyk7XG4gICAgICAgICAgICBleHBlY3QodHlwZW9mIGlkKS50by5lcXVhbChcIm51bWJlclwiKTtcbiAgICAgICAgICAgIGV2ZW50RnJvbS5lbWl0KFwidGVzdFwiKTtcbiAgICAgICAgICAgIGV2ZW50RnJvbS5lbWl0KFwicmFuZG9tXCIpO1xuICAgICAgICAgICAgZXZlbnRGcm9tLmVtaXQoXCJhbnlcIik7XG4gICAgICAgIH0pO1xuICAgICAgICBpdChcInJlZ2V4cFwiLCAoKSA9PiB7XG4gICAgICAgICAgICBsZXQgZXZlbnRGcm9tID0gbmV3IEV2ZW50UHJvcGVydHk8c3RyaW5nPigpO1xuICAgICAgICAgICAgbGV0IGV2ZW50VG8gPSBuZXcgRXZlbnRQcm9wZXJ0eTxzdHJpbmc+KCk7XG4gICAgICAgICAgICBsZXQgcGFzcyA9IDE7XG5cbiAgICAgICAgICAgIGV2ZW50VG8ub24oZnVuY3Rpb24gKGFyZzogc3RyaW5nKSB7XG4gICAgICAgICAgICAgICAgY2hhaS5hc3NlcnQoL15cXC9bYS16QS1aXSovLnRlc3QoYXJnKSk7XG4gICAgICAgICAgICAgICAgY2hhaS5hc3NlcnQoIS0tcGFzcyk7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIGxldCBpZCA9IGV2ZW50RnJvbS5yb3V0ZSgvXlxcL1thLXpBLVpdKy8sIGV2ZW50VG8pO1xuICAgICAgICAgICAgZXhwZWN0KHR5cGVvZiBpZCkudG8uZXF1YWwoXCJudW1iZXJcIik7XG4gICAgICAgICAgICBldmVudEZyb20uZW1pdChcIi9yb290XCIpO1xuICAgICAgICAgICAgZXZlbnRGcm9tLmVtaXQoXCJyYW5kb21cIik7XG4gICAgICAgICAgICBldmVudEZyb20uZW1pdChcIi8zNC9cIik7XG4gICAgICAgIH0pO1xuICAgIH0pO1xuICAgIGRlc2NyaWJlKFwiLmluaXQoKVwiLCAoKSA9PiB7XG4gICAgICAgIGl0KFwicmVzb2x2ZXMgd2l0aCB2YWx1ZVwiLCAoZG9uZTogTW9jaGFEb25lKSA9PiB7XG4gICAgICAgICAgICBsZXQgZXZlbnQgPSBuZXcgRXZlbnRQcm9wZXJ0eTxzdHJpbmc+KCk7XG4gICAgICAgICAgICBsZXQgdGVzdEFyZzogc3RyaW5nID0gXCJ0ZXN0XCI7XG4gICAgICAgICAgICBldmVudC5pbml0KChhcmc6IHN0cmluZykgPT4ge1xuICAgICAgICAgICAgICAgIGV4cGVjdChhcmcpLnRvLmVxdWFsKHRlc3RBcmcpO1xuICAgICAgICAgICAgICAgIGRvbmUoKTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgZXZlbnQuZW1pdCh0ZXN0QXJnKTtcbiAgICAgICAgfSk7XG5cbiAgICAgICAgaXQoXCJjYW4gYmUgY2F1Z2h0IGFmdGVyIGVtaXRcIiwgKGRvbmU6IE1vY2hhRG9uZSkgPT4ge1xuICAgICAgICAgICAgbGV0IGV2ZW50ID0gbmV3IEV2ZW50UHJvcGVydHkuVm9pZCgpO1xuICAgICAgICAgICAgZXZlbnQuZW1pdCgpO1xuICAgICAgICAgICAgZXZlbnQuaW5pdCgoKSA9PiB7XG4gICAgICAgICAgICAgICAgZG9uZSgpO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgIH0pO1xuXG4gICAgICAgIGl0KFwiaW5pdCBoYW5kbGVycyBhcmUgaW52b2tlZCBpbW1lZGlhdGVseVwiLCAoKSA9PiB7XG4gICAgICAgICAgICBsZXQgZXZlbnQgPSBuZXcgRXZlbnRQcm9wZXJ0eS5Wb2lkKCk7XG4gICAgICAgICAgICBsZXQgZmxhZyA9IGZhbHNlO1xuICAgICAgICAgICAgZXZlbnQuaW5pdCgoKSA9PiB7IGZsYWcgPSB0cnVlOyB9KTtcbiAgICAgICAgICAgIGV2ZW50LmVtaXQoKTtcblxuICAgICAgICAgICAgLy8gQmVjYXVzZSBwcm9taXNlIGlzIHJlc29sdmVkIGluIHRoZSBuZXh0IGV2ZW50LWxvb3AgaXRlcmF0aW9uXG4gICAgICAgICAgICBleHBlY3QoZmxhZykudG8uZXF1YWwodHJ1ZSk7XG4gICAgICAgIH0pO1xuICAgIH0pO1xuICAgIGRlc2NyaWJlKFwiRmFjdG9yeVwiLCAoKSA9PiB7XG4gICAgICAgIGl0KFwiRXZlbnRQcm9wZXJ0eS5tYWtlKClcIiwgKGRvbmU6IE1vY2hhRG9uZSkgPT4ge1xuICAgICAgICAgICAgY2xhc3MgVGVzdCB7XG4gICAgICAgICAgICAgICAgcHJpdmF0ZSBldmVudDogRXZlbnRQcm9wZXJ0eTxzdHJpbmc+O1xuICAgICAgICAgICAgICAgIHB1YmxpYyBlbWl0dGVyOiBFdmVudFByb3BlcnR5LkVtaXR0ZXI8c3RyaW5nPjtcbiAgICAgICAgICAgICAgICBjb25zdHJ1Y3RvcigpIHtcbiAgICAgICAgICAgICAgICAgICAgW3RoaXMuZXZlbnQsIHRoaXMuZW1pdHRlcl0gPSBFdmVudFByb3BlcnR5Lm1ha2U8c3RyaW5nPigpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB0ZXN0KCkge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLmV2ZW50LmVtaXQoXCJ0ZXN0XCIpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGxldCBpbnN0YW5jZSA9IG5ldyBUZXN0KCk7XG4gICAgICAgICAgICBpbnN0YW5jZS5lbWl0dGVyLm9uKCgpID0+IGRvbmUoKSk7XG4gICAgICAgICAgICBpbnN0YW5jZS50ZXN0KCk7XG4gICAgICAgIH0pO1xuICAgICAgICBpdChcIkV2ZW50UHJvcGVydHkuc3BsaXQoKVwiLCAoZG9uZTogTW9jaGFEb25lKSA9PiB7XG4gICAgICAgICAgICBjbGFzcyBUZXN0IHtcbiAgICAgICAgICAgICAgICBwcml2YXRlIHRyaWdnZXJFdmVudDogRXZlbnRQcm9wZXJ0eS5FbWl0TWV0aG9kPHN0cmluZz47XG4gICAgICAgICAgICAgICAgcHVibGljIGV2ZW50OiBFdmVudFByb3BlcnR5LkVtaXR0ZXI8c3RyaW5nPjtcbiAgICAgICAgICAgICAgICBjb25zdHJ1Y3RvcigpIHtcbiAgICAgICAgICAgICAgICAgICAgW3RoaXMudHJpZ2dlckV2ZW50LCB0aGlzLmV2ZW50XSA9IEV2ZW50UHJvcGVydHkuc3BsaXQ8c3RyaW5nPigpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB0ZXN0KCkge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLnRyaWdnZXJFdmVudChcInRlc3RcIik7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgICAgbGV0IGluc3RhbmNlID0gbmV3IFRlc3QoKTtcbiAgICAgICAgICAgIGluc3RhbmNlLmV2ZW50Lm9uKCgpID0+IGRvbmUoKSk7XG4gICAgICAgICAgICBpbnN0YW5jZS50ZXN0KCk7XG4gICAgICAgIH0pO1xuICAgICAgICBpdChcIkV2ZW50UHJvcGVydHkuc3BsaXRWb2lkKClcIiwgKGRvbmU6IE1vY2hhRG9uZSkgPT4ge1xuICAgICAgICAgICAgY2xhc3MgVGVzdCB7XG4gICAgICAgICAgICAgICAgcHJpdmF0ZSB0cmlnZ2VyRXZlbnQ6IEV2ZW50UHJvcGVydHkuVm9pZEVtaXRNZXRob2Q7XG4gICAgICAgICAgICAgICAgcHVibGljIGV2ZW50OiBFdmVudFByb3BlcnR5LkVtaXR0ZXI8dm9pZD47XG4gICAgICAgICAgICAgICAgY29uc3RydWN0b3IoKSB7XG4gICAgICAgICAgICAgICAgICAgIFt0aGlzLnRyaWdnZXJFdmVudCwgdGhpcy5ldmVudF0gPSBFdmVudFByb3BlcnR5LnNwbGl0Vm9pZCgpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB0ZXN0KCkge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLnRyaWdnZXJFdmVudCgpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGxldCBpbnN0YW5jZSA9IG5ldyBUZXN0KCk7XG4gICAgICAgICAgICBpbnN0YW5jZS5ldmVudC5vbigoKSA9PiBkb25lKCkpO1xuICAgICAgICAgICAgaW5zdGFuY2UudGVzdCgpO1xuICAgICAgICB9KTtcbiAgICB9KTtcbiAgICBkZXNjcmliZShcInRpbWluZ1wiLCAoKSA9PiB7XG5cbiAgICB9KTtcbn0pO1xuXG5cbmZ1bmN0aW9uIHRlc3RUcmlnZ2VycyhtZXRob2Q6IHN0cmluZykge1xuICAgIGl0KFwicmV0dXJucyBsaXN0ZW5lcklkXCIsICgpID0+IHtcbiAgICAgICAgbGV0IGV2ZW50ID0gbmV3IEV2ZW50UHJvcGVydHk8dm9pZD4oKTtcbiAgICAgICAgbGV0IGlkID0gZXZlbnRbbWV0aG9kXSgoKSA9PiB7fSk7XG4gICAgICAgIGV4cGVjdCh0eXBlb2YgaWQpLnRvLmVxdWFsKFwibnVtYmVyXCIpO1xuICAgIH0pO1xuICAgIGl0KFwidHJpZ2dlcnNcIiwgKGRvbmU6IE1vY2hhRG9uZSkgPT4ge1xuICAgICAgICBsZXQgZXZlbnQgPSBuZXcgRXZlbnRQcm9wZXJ0eS5Wb2lkKCk7XG4gICAgICAgIGV2ZW50W21ldGhvZF0oZG9uZSk7XG4gICAgICAgIGV2ZW50LmVtaXQoKTtcbiAgICB9KTtcbiAgICBpdChcInBhc3NlcyBhcmd1bWVudFwiLCAoZG9uZTogTW9jaGFEb25lKSA9PiB7XG4gICAgICAgIGxldCB0ZXN0QXJnID0gXCJ0ZXN0XCI7XG4gICAgICAgIGxldCBldmVudCA9IG5ldyBFdmVudFByb3BlcnR5PHN0cmluZz4oKTtcbiAgICAgICAgZXZlbnRbbWV0aG9kXSgoYXJnOiBzdHJpbmcpID0+IHtcbiAgICAgICAgICAgIGV4cGVjdChhcmcpLnRvLmJlLmVxdWFsKHRlc3RBcmcpO1xuICAgICAgICAgICAgZG9uZSgpO1xuICAgICAgICB9KTtcbiAgICAgICAgZXZlbnQuZW1pdCh0ZXN0QXJnKTtcbiAgICB9KTtcbiAgICBpdChcInBhc3NlcyBjb250ZXh0XCIsIChkb25lOiBNb2NoYURvbmUpID0+IHtcbiAgICAgICAgbGV0IGV2ZW50ID0gbmV3IEV2ZW50UHJvcGVydHkuVm9pZCgpO1xuICAgICAgICBsZXQgbGlzdGVuZXI6IHtcbiAgICAgICAgICAgIGl0SXNMaXN0ZW5lcjogYm9vbGVhbjtcbiAgICAgICAgICAgIGZuOiAoKSA9PiB2b2lkO1xuICAgICAgICB9O1xuICAgICAgICBsaXN0ZW5lciAgPSB7XG4gICAgICAgICAgICBpdElzTGlzdGVuZXI6IHRydWUsXG4gICAgICAgICAgICBmbigpIHtcbiAgICAgICAgICAgICAgICBjaGFpLmV4cGVjdCh0aGlzKS50by5iZS5lcXVhbChsaXN0ZW5lcik7XG4gICAgICAgICAgICAgICAgZG9uZSgpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9O1xuICAgICAgICBldmVudFttZXRob2RdKGxpc3RlbmVyLmZuLCBsaXN0ZW5lcik7XG4gICAgICAgIGV2ZW50LmVtaXQoKTtcbiAgICB9KTtcbn1cblxuZnVuY3Rpb24gdGVzdE1hdGNoVHJpZ2dlcnMobWV0aG9kOiBzdHJpbmcpIHtcbiAgICBsZXQgbWF0Y2ggPSBcInRlc3RNYXRjaFZhbHVlXCI7XG4gICAgaXQoXCJyZXR1cm5zIGxpc3RlbmVySWRcIiwgKCkgPT4ge1xuICAgICAgICBsZXQgZXZlbnQgPSBuZXcgRXZlbnRQcm9wZXJ0eTxzdHJpbmc+KCk7XG4gICAgICAgIGxldCBpZCA9IGV2ZW50W21ldGhvZF0obWF0Y2gsICgpID0+IHt9KTtcbiAgICAgICAgZXhwZWN0KHR5cGVvZiBpZCkudG8uZXF1YWwoXCJudW1iZXJcIik7XG4gICAgfSk7XG4gICAgaXQoXCJ0cmlnZ2Vyc1wiLCAoZG9uZTogTW9jaGFEb25lKSA9PiB7XG4gICAgICAgIGxldCBldmVudCA9IG5ldyBFdmVudFByb3BlcnR5PHN0cmluZz4oKTtcbiAgICAgICAgZXZlbnRbbWV0aG9kXShtYXRjaCwgZnVuY3Rpb24gKCkgeyBkb25lKCk7IH0pO1xuICAgICAgICBldmVudC5lbWl0KG1hdGNoKTtcbiAgICB9KTtcbiAgICBpdChcInBhc3NlcyBhcmd1bWVudFwiLCAoZG9uZTogTW9jaGFEb25lKSA9PiB7XG4gICAgICAgIGxldCB0ZXN0QXJnID0gXCJ0ZXN0XCI7XG4gICAgICAgIGxldCBldmVudCA9IG5ldyBFdmVudFByb3BlcnR5PHN0cmluZz4oKTtcbiAgICAgICAgZXZlbnRbbWV0aG9kXSh0ZXN0QXJnLCAoYXJnOiBzdHJpbmcpID0+IHtcbiAgICAgICAgICAgIGV4cGVjdChhcmcpLnRvLmJlLmVxdWFsKHRlc3RBcmcpO1xuICAgICAgICAgICAgZG9uZSgpO1xuICAgICAgICB9KTtcbiAgICAgICAgZXZlbnQuZW1pdCh0ZXN0QXJnKTtcbiAgICB9KTtcbiAgICBpdChcInBhc3NlcyBjb250ZXh0XCIsIChkb25lOiBNb2NoYURvbmUpID0+IHtcbiAgICAgICAgbGV0IGV2ZW50ID0gbmV3IEV2ZW50UHJvcGVydHk8c3RyaW5nPigpO1xuICAgICAgICBsZXQgbGlzdGVuZXI6IHtcbiAgICAgICAgICAgIGl0SXNMaXN0ZW5lcjogYm9vbGVhbjtcbiAgICAgICAgICAgIGZuOiAoKSA9PiB2b2lkO1xuICAgICAgICB9O1xuICAgICAgICBsaXN0ZW5lciAgPSB7XG4gICAgICAgICAgICBpdElzTGlzdGVuZXI6IHRydWUsXG4gICAgICAgICAgICBmbigpIHtcbiAgICAgICAgICAgICAgICBjaGFpLmV4cGVjdCh0aGlzKS50by5iZS5lcXVhbChsaXN0ZW5lcik7XG4gICAgICAgICAgICAgICAgZG9uZSgpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9O1xuICAgICAgICBldmVudFttZXRob2RdKG1hdGNoLCBsaXN0ZW5lci5mbiwgbGlzdGVuZXIpO1xuICAgICAgICBldmVudC5lbWl0KG1hdGNoKTtcbiAgICB9KTtcbiAgICBpdChcImlnbm9yZXMgaXJyZWxldmFudCBlbWl0c1wiLCAoKSA9PiB7XG4gICAgICAgIGxldCBldmVudCA9IG5ldyBFdmVudFByb3BlcnR5PHN0cmluZz4oKTtcbiAgICAgICAgZXZlbnRbbWV0aG9kXShtYXRjaCwgZnVuY3Rpb24gKCkgeyB0aHJvdyBuZXcgRXJyb3IoXCJNdXN0IG5vdCBiZSBpbnZva2VkXCIpOyB9KTtcbiAgICAgICAgZXZlbnQuZW1pdChcIlwiKTtcbiAgICAgICAgZXZlbnQuZW1pdChcImFiY1wiKTtcbiAgICAgICAgZXZlbnQuZW1pdChudWxsKTtcbiAgICB9KTtcbn0iXX0=