/// <reference path="../../typings/index.d.ts"/>
Object.defineProperty(exports, "__esModule", { value: true });
const chai = require("chai");
const event_1 = require("../event");
let expect = chai.expect;
function testTriggers(method) {
    it("returns listenerId", () => {
        let event = new event_1.EventProperty();
        let id = event[method](() => { });
        expect(typeof id).to.equal("number");
    });
    it("triggers", (done) => {
        let event = new event_1.EventProperty();
        event[method](done);
        event.emit();
    });
    it("passes argument", (done) => {
        let testArg = "test";
        let event = new event_1.EventProperty();
        event[method]((arg) => {
            expect(arg).to.be.equal(testArg);
            done();
        });
        event.emit(testArg);
    });
    it("passes context", (done) => {
        let event = new event_1.EventProperty();
        let listener;
        listener = {
            itIsListener: true,
            fn() {
                chai.expect(this).to.be.equal(listener);
                done();
            }
        };
        event[method](listener.fn, listener);
        event.emit();
    });
}
function testMatchTriggers(method) {
    let match = "testMatchValue";
    it("returns listenerId", () => {
        let event = new event_1.EventProperty();
        let id = event[method](match, () => { });
        expect(typeof id).to.equal("number");
    });
    it("triggers", (done) => {
        let event = new event_1.EventProperty();
        event[method](match, function () { done(); });
        event.emit(match);
    });
    it("passes argument", (done) => {
        let testArg = "test";
        let event = new event_1.EventProperty();
        event[method](testArg, (arg) => {
            expect(arg).to.be.equal(testArg);
            done();
        });
        event.emit(testArg);
    });
    it("passes context", (done) => {
        let event = new event_1.EventProperty();
        let listener;
        listener = {
            itIsListener: true,
            fn() {
                chai.expect(this).to.be.equal(listener);
                done();
            }
        };
        event[method](match, listener.fn, listener);
        event.emit(match);
    });
    it("ignores irrelevant emits", () => {
        let event = new event_1.EventProperty();
        event[method](match, function () { throw new Error("Must not be invoked"); });
        event.emit();
        event.emit("abc");
        event.emit(null);
    });
}
describe("EventProperty", () => {
    it("constructor", () => {
        new event_1.EventProperty();
    });
    describe("on", () => {
        testTriggers("on");
        it("invokes all listeners", (done) => {
            let event = new event_1.EventProperty();
            let resolve1 = null;
            let resolve2 = null;
            let promise1 = new Promise((resolve) => { resolve1 = resolve; });
            let promise2 = new Promise((resolve) => { resolve2 = resolve; });
            event.on(resolve1);
            event.on(resolve2);
            Promise.all([promise1, promise2]).then(function () { done(); }).catch(done);
            event.emit();
        });
        it("invokes listeners on each emit", (done) => {
            let event = new event_1.EventProperty();
            let nExpected = 5;
            let nRegistered = 0;
            event.on(() => {
                nRegistered++;
                if (nRegistered === nExpected)
                    done();
            });
            for (let i = 0; i < nExpected; i++)
                event.emit();
        });
    });
    describe("off", () => {
        it("by handler", () => {
            let event = new event_1.EventProperty();
            let handler = () => {
                throw new Error("Should not be invoked");
            };
            event.on(handler);
            event.off(handler);
            event.emit();
        });
        it("by id", () => {
            let event = new event_1.EventProperty();
            let handler = () => {
                throw new Error("Should not be invoked");
            };
            let id = event.on(handler);
            event.off(id);
            event.emit();
        });
        it("by context", (done) => {
            let event = new event_1.EventProperty();
            let context = {};
            let handler = function () {
                if (this === context)
                    throw new Error("Should not be invoked");
                else
                    done();
            };
            // Off by context should remove all handlers with the
            // context but should not affect the handlers passed without context
            event.on(handler, context);
            event.on(handler, context);
            event.on(handler);
            event.off(context);
            event.emit();
        });
        it("clears", (done) => {
            let event = new event_1.EventProperty();
            let handler = function () {
                if (this === context)
                    throw new Error("Should not be invoked");
                else
                    done();
            };
            // Off by context should remove all handlers with the
            // context but should not affect the handlers passed without context
            event.on(handler);
            event.on(handler);
            event.off();
            setTimeout(done, 10);
            event.emit();
        });
    });
    describe("once", () => {
        testTriggers("once");
        it("triggers once", () => {
            let event = new event_1.EventProperty();
            let isFirst = true;
            event.once(function () {
                chai.assert(isFirst);
                isFirst = false;
            });
            event.emit();
            event.emit();
        });
    });
    describe("match", () => {
        testMatchTriggers("match");
        it("matches object part", (done) => {
            let event = new event_1.EventProperty();
            event.match({ a: 1, b: 2 }, function () { done(); });
            event.emit({ a: 1, b: 2, c: 3, d: "x" });
        });
        it("matches deeper", (done) => {
            let event = new event_1.EventProperty();
            event.match({ a: { x: "y" }, c: [1, 2] }, function () { done(); });
            event.emit({ a: { x: "y", z: { r: 1 } }, c: [1, 2, { x: "?" }, null] });
        });
        it("matches regexp", (done) => {
            let event = new event_1.EventProperty();
            event.match(/test[123]+x/, function () { done(); });
            event.emit("test-test2xs");
        });
    });
    describe("matchOnce", () => {
        testMatchTriggers("matchOnce");
        it("matches once", () => {
            let event = new event_1.EventProperty();
            let isFirst = true;
            event.matchOnce("match", function () {
                chai.assert(isFirst);
                isFirst = false;
            });
            event.emit("match");
            event.emit("match");
            event.emit("unmatch");
        });
    });
    describe("pipe", () => {
        it("passes argument, get listenerId", (done) => {
            let eventFrom = new event_1.EventProperty();
            let eventTo = new event_1.EventProperty();
            let testArg = "test";
            eventTo.on(function (arg) {
                expect(arg).to.equal(testArg);
                done();
            });
            let id = eventFrom.pipe(eventTo);
            expect(typeof id).to.equal("number");
            eventFrom.emit(testArg);
        });
        it("offs with id", () => {
            let eventFrom = new event_1.EventProperty();
            let eventTo = new event_1.EventProperty();
            eventTo.on(function () { throw new Error("Should not happen"); });
            let id = eventFrom.pipe(eventTo);
            eventFrom.off(id);
            eventFrom.emit();
        });
        it("offs with event", () => {
            let eventFrom = new event_1.EventProperty();
            let eventTo = new event_1.EventProperty();
            eventTo.on(function () { throw new Error("Should not happen"); });
            eventFrom.pipe(eventTo);
            eventFrom.off(eventTo);
            eventFrom.emit();
        });
    });
    describe("route", () => {
        it("string", () => {
            let eventFrom = new event_1.EventProperty();
            let eventTo = new event_1.EventProperty();
            eventTo.on(function (arg) {
                expect(arg).to.equal("test");
            });
            let id = eventFrom.route("test", eventTo);
            expect(typeof id).to.equal("number");
            eventFrom.emit("test");
            eventFrom.emit("random");
            eventFrom.emit("any");
        });
        it("regexp", () => {
            let eventFrom = new event_1.EventProperty();
            let eventTo = new event_1.EventProperty();
            let pass = 1;
            eventTo.on(function (arg) {
                chai.assert(/^\/[a-zA-Z]*/.test(arg));
                chai.assert(!--pass);
            });
            let id = eventFrom.route(/^\/[a-zA-Z]+/, eventTo);
            expect(typeof id).to.equal("number");
            eventFrom.emit("/root");
            eventFrom.emit("random");
            eventFrom.emit("/34/");
        });
    });
    describe("first", () => {
        it("resolves with value", (done) => {
            let event = new event_1.EventProperty();
            let testArg = "test";
            event.first().then((arg) => {
                expect(arg).to.equal(testArg);
                done();
            });
            event.emit(testArg);
        });
        it("can be caught after emit", (done) => {
            let event = new event_1.EventProperty();
            event.emit();
            event.first().then(() => {
                done();
            });
        });
    });
    describe("next", () => {
        it("resolves with value", (done) => {
            let event = new event_1.EventProperty();
            let testArg = "test";
            event.next().then((arg) => {
                expect(arg).to.equal(testArg);
                done();
            });
            event.emit(testArg);
        });
        it("creates new promises", (done) => {
            let event = new event_1.EventProperty();
            let testArg1 = "test1";
            let testArg2 = "test2";
            event.next().then((arg) => {
                expect(arg).to.equal(testArg1);
                event.next().then((arg) => {
                    expect(arg).to.equal(testArg2);
                    event.next().then((arg) => {
                        expect(arg).to.equal(testArg1);
                        done();
                    });
                    event.emit(testArg1);
                });
                event.emit(testArg2);
            });
            event.emit(testArg1);
        });
    });
    it("EventProperty.make", (done) => {
        class Test {
            constructor() {
                [this.event, this.emitter] = event_1.EventProperty.make();
            }
            test() {
                this.event.emit();
            }
        }
        let instance = new Test();
        instance.emitter.on(done);
        instance.test();
    });
});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZXZlbnQuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi9zcmMvdGVzdC9ldmVudC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQSxnREFBZ0Q7O0FBRWhELDZCQUE2QjtBQUM3QixvQ0FBdUM7QUFFdkMsSUFBSSxNQUFNLEdBQUcsSUFBSSxDQUFDLE1BQU0sQ0FBQztBQUV6QixzQkFBc0IsTUFBYztJQUNoQyxFQUFFLENBQUMsb0JBQW9CLEVBQUU7UUFDckIsSUFBSSxLQUFLLEdBQUcsSUFBSSxxQkFBYSxFQUFRLENBQUM7UUFDdEMsSUFBSSxFQUFFLEdBQUcsS0FBSyxDQUFDLE1BQU0sQ0FBQyxDQUFDLFFBQU8sQ0FBQyxDQUFDLENBQUM7UUFDakMsTUFBTSxDQUFDLE9BQU8sRUFBRSxDQUFDLENBQUMsRUFBRSxDQUFDLEtBQUssQ0FBQyxRQUFRLENBQUMsQ0FBQztJQUN6QyxDQUFDLENBQUMsQ0FBQztJQUNILEVBQUUsQ0FBQyxVQUFVLEVBQUUsQ0FBQyxJQUFlO1FBQzNCLElBQUksS0FBSyxHQUFHLElBQUkscUJBQWEsRUFBUSxDQUFDO1FBQ3RDLEtBQUssQ0FBQyxNQUFNLENBQUMsQ0FBQyxJQUFJLENBQUMsQ0FBQztRQUNwQixLQUFLLENBQUMsSUFBSSxFQUFFLENBQUM7SUFDakIsQ0FBQyxDQUFDLENBQUM7SUFDSCxFQUFFLENBQUMsaUJBQWlCLEVBQUUsQ0FBQyxJQUFlO1FBQ2xDLElBQUksT0FBTyxHQUFHLE1BQU0sQ0FBQztRQUNyQixJQUFJLEtBQUssR0FBRyxJQUFJLHFCQUFhLEVBQVUsQ0FBQztRQUN4QyxLQUFLLENBQUMsTUFBTSxDQUFDLENBQUMsQ0FBQyxHQUFXO1lBQ3RCLE1BQU0sQ0FBQyxHQUFHLENBQUMsQ0FBQyxFQUFFLENBQUMsRUFBRSxDQUFDLEtBQUssQ0FBQyxPQUFPLENBQUMsQ0FBQztZQUNqQyxJQUFJLEVBQUUsQ0FBQztRQUNYLENBQUMsQ0FBQyxDQUFDO1FBQ0gsS0FBSyxDQUFDLElBQUksQ0FBQyxPQUFPLENBQUMsQ0FBQztJQUN4QixDQUFDLENBQUMsQ0FBQztJQUNILEVBQUUsQ0FBQyxnQkFBZ0IsRUFBRSxDQUFDLElBQWU7UUFDakMsSUFBSSxLQUFLLEdBQUcsSUFBSSxxQkFBYSxFQUFRLENBQUM7UUFDdEMsSUFBSSxRQUdILENBQUM7UUFDRixRQUFRLEdBQUk7WUFDUixZQUFZLEVBQUUsSUFBSTtZQUNsQixFQUFFO2dCQUNFLElBQUksQ0FBQyxNQUFNLENBQUMsSUFBSSxDQUFDLENBQUMsRUFBRSxDQUFDLEVBQUUsQ0FBQyxLQUFLLENBQUMsUUFBUSxDQUFDLENBQUM7Z0JBQ3hDLElBQUksRUFBRSxDQUFDO1lBQ1gsQ0FBQztTQUNKLENBQUM7UUFDRixLQUFLLENBQUMsTUFBTSxDQUFDLENBQUMsUUFBUSxDQUFDLEVBQUUsRUFBRSxRQUFRLENBQUMsQ0FBQztRQUNyQyxLQUFLLENBQUMsSUFBSSxFQUFFLENBQUM7SUFDakIsQ0FBQyxDQUFDLENBQUM7QUFDUCxDQUFDO0FBRUQsMkJBQTJCLE1BQWM7SUFDckMsSUFBSSxLQUFLLEdBQUcsZ0JBQWdCLENBQUM7SUFDN0IsRUFBRSxDQUFDLG9CQUFvQixFQUFFO1FBQ3JCLElBQUksS0FBSyxHQUFHLElBQUkscUJBQWEsRUFBVSxDQUFDO1FBQ3hDLElBQUksRUFBRSxHQUFHLEtBQUssQ0FBQyxNQUFNLENBQUMsQ0FBQyxLQUFLLEVBQUUsUUFBTyxDQUFDLENBQUMsQ0FBQztRQUN4QyxNQUFNLENBQUMsT0FBTyxFQUFFLENBQUMsQ0FBQyxFQUFFLENBQUMsS0FBSyxDQUFDLFFBQVEsQ0FBQyxDQUFDO0lBQ3pDLENBQUMsQ0FBQyxDQUFDO0lBQ0gsRUFBRSxDQUFDLFVBQVUsRUFBRSxDQUFDLElBQWU7UUFDM0IsSUFBSSxLQUFLLEdBQUcsSUFBSSxxQkFBYSxFQUFVLENBQUM7UUFDeEMsS0FBSyxDQUFDLE1BQU0sQ0FBQyxDQUFDLEtBQUssRUFBRSxjQUFjLElBQUksRUFBRSxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUM7UUFDOUMsS0FBSyxDQUFDLElBQUksQ0FBQyxLQUFLLENBQUMsQ0FBQztJQUN0QixDQUFDLENBQUMsQ0FBQztJQUNILEVBQUUsQ0FBQyxpQkFBaUIsRUFBRSxDQUFDLElBQWU7UUFDbEMsSUFBSSxPQUFPLEdBQUcsTUFBTSxDQUFDO1FBQ3JCLElBQUksS0FBSyxHQUFHLElBQUkscUJBQWEsRUFBVSxDQUFDO1FBQ3hDLEtBQUssQ0FBQyxNQUFNLENBQUMsQ0FBQyxPQUFPLEVBQUUsQ0FBQyxHQUFXO1lBQy9CLE1BQU0sQ0FBQyxHQUFHLENBQUMsQ0FBQyxFQUFFLENBQUMsRUFBRSxDQUFDLEtBQUssQ0FBQyxPQUFPLENBQUMsQ0FBQztZQUNqQyxJQUFJLEVBQUUsQ0FBQztRQUNYLENBQUMsQ0FBQyxDQUFDO1FBQ0gsS0FBSyxDQUFDLElBQUksQ0FBQyxPQUFPLENBQUMsQ0FBQztJQUN4QixDQUFDLENBQUMsQ0FBQztJQUNILEVBQUUsQ0FBQyxnQkFBZ0IsRUFBRSxDQUFDLElBQWU7UUFDakMsSUFBSSxLQUFLLEdBQUcsSUFBSSxxQkFBYSxFQUFVLENBQUM7UUFDeEMsSUFBSSxRQUdILENBQUM7UUFDRixRQUFRLEdBQUk7WUFDUixZQUFZLEVBQUUsSUFBSTtZQUNsQixFQUFFO2dCQUNFLElBQUksQ0FBQyxNQUFNLENBQUMsSUFBSSxDQUFDLENBQUMsRUFBRSxDQUFDLEVBQUUsQ0FBQyxLQUFLLENBQUMsUUFBUSxDQUFDLENBQUM7Z0JBQ3hDLElBQUksRUFBRSxDQUFDO1lBQ1gsQ0FBQztTQUNKLENBQUM7UUFDRixLQUFLLENBQUMsTUFBTSxDQUFDLENBQUMsS0FBSyxFQUFFLFFBQVEsQ0FBQyxFQUFFLEVBQUUsUUFBUSxDQUFDLENBQUM7UUFDNUMsS0FBSyxDQUFDLElBQUksQ0FBQyxLQUFLLENBQUMsQ0FBQztJQUN0QixDQUFDLENBQUMsQ0FBQztJQUNILEVBQUUsQ0FBQywwQkFBMEIsRUFBRTtRQUMzQixJQUFJLEtBQUssR0FBRyxJQUFJLHFCQUFhLEVBQVUsQ0FBQztRQUN4QyxLQUFLLENBQUMsTUFBTSxDQUFDLENBQUMsS0FBSyxFQUFFLGNBQWMsTUFBTSxJQUFJLEtBQUssQ0FBQyxxQkFBcUIsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUM7UUFDOUUsS0FBSyxDQUFDLElBQUksRUFBRSxDQUFDO1FBQ2IsS0FBSyxDQUFDLElBQUksQ0FBQyxLQUFLLENBQUMsQ0FBQztRQUNsQixLQUFLLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxDQUFDO0lBQ3JCLENBQUMsQ0FBQyxDQUFDO0FBQ1AsQ0FBQztBQUVELFFBQVEsQ0FBQyxlQUFlLEVBQUU7SUFDdEIsRUFBRSxDQUFDLGFBQWEsRUFBRTtRQUNkLElBQUkscUJBQWEsRUFBUSxDQUFDO0lBQzlCLENBQUMsQ0FBQyxDQUFDO0lBQ0gsUUFBUSxDQUFDLElBQUksRUFBRTtRQUNYLFlBQVksQ0FBQyxJQUFJLENBQUMsQ0FBQztRQUNuQixFQUFFLENBQUMsdUJBQXVCLEVBQUUsQ0FBQyxJQUFlO1lBQ3hDLElBQUksS0FBSyxHQUFHLElBQUkscUJBQWEsRUFBVSxDQUFDO1lBQ3hDLElBQUksUUFBUSxHQUFlLElBQUksQ0FBQztZQUNoQyxJQUFJLFFBQVEsR0FBZSxJQUFJLENBQUM7WUFDaEMsSUFBSSxRQUFRLEdBQWlCLElBQUksT0FBTyxDQUFNLENBQUMsT0FBTyxPQUFPLFFBQVEsR0FBRyxPQUFPLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQztZQUNwRixJQUFJLFFBQVEsR0FBaUIsSUFBSSxPQUFPLENBQU0sQ0FBQyxPQUFPLE9BQU8sUUFBUSxHQUFHLE9BQU8sQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDO1lBQ3BGLEtBQUssQ0FBQyxFQUFFLENBQUMsUUFBUSxDQUFDLENBQUM7WUFDbkIsS0FBSyxDQUFDLEVBQUUsQ0FBQyxRQUFRLENBQUMsQ0FBQztZQUNuQixPQUFPLENBQUMsR0FBRyxDQUFDLENBQUMsUUFBUSxFQUFFLFFBQVEsQ0FBQyxDQUFDLENBQUMsSUFBSSxDQUFDLGNBQVksSUFBSSxFQUFFLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxLQUFLLENBQUMsSUFBSSxDQUFDLENBQUM7WUFDMUUsS0FBSyxDQUFDLElBQUksRUFBRSxDQUFDO1FBQ2pCLENBQUMsQ0FBQyxDQUFDO1FBQ0gsRUFBRSxDQUFDLGdDQUFnQyxFQUFFLENBQUMsSUFBZTtZQUNqRCxJQUFJLEtBQUssR0FBRyxJQUFJLHFCQUFhLEVBQVEsQ0FBQztZQUN0QyxJQUFJLFNBQVMsR0FBRyxDQUFDLENBQUM7WUFDbEIsSUFBSSxXQUFXLEdBQUcsQ0FBQyxDQUFDO1lBQ3BCLEtBQUssQ0FBQyxFQUFFLENBQUM7Z0JBQ0wsV0FBVyxFQUFFLENBQUM7Z0JBQ2QsRUFBRSxDQUFDLENBQUMsV0FBVyxLQUFLLFNBQVMsQ0FBQztvQkFBQyxJQUFJLEVBQUUsQ0FBQztZQUMxQyxDQUFDLENBQUMsQ0FBQztZQUNILEdBQUcsQ0FBQyxDQUFDLElBQUksQ0FBQyxHQUFHLENBQUMsRUFBRSxDQUFDLEdBQUcsU0FBUyxFQUFFLENBQUMsRUFBRTtnQkFBRSxLQUFLLENBQUMsSUFBSSxFQUFFLENBQUM7UUFDckQsQ0FBQyxDQUFDLENBQUM7SUFDUCxDQUFDLENBQUMsQ0FBQztJQUVILFFBQVEsQ0FBQyxLQUFLLEVBQUU7UUFDWixFQUFFLENBQUMsWUFBWSxFQUFFO1lBQ2IsSUFBSSxLQUFLLEdBQUcsSUFBSSxxQkFBYSxFQUFRLENBQUM7WUFDdEMsSUFBSSxPQUFPLEdBQUc7Z0JBQ1YsTUFBTSxJQUFJLEtBQUssQ0FBQyx1QkFBdUIsQ0FBQyxDQUFDO1lBQzdDLENBQUMsQ0FBQztZQUVGLEtBQUssQ0FBQyxFQUFFLENBQUMsT0FBTyxDQUFDLENBQUM7WUFDbEIsS0FBSyxDQUFDLEdBQUcsQ0FBQyxPQUFPLENBQUMsQ0FBQztZQUVuQixLQUFLLENBQUMsSUFBSSxFQUFFLENBQUM7UUFDakIsQ0FBQyxDQUFDLENBQUM7UUFDSCxFQUFFLENBQUMsT0FBTyxFQUFFO1lBQ1IsSUFBSSxLQUFLLEdBQUcsSUFBSSxxQkFBYSxFQUFRLENBQUM7WUFDdEMsSUFBSSxPQUFPLEdBQUc7Z0JBQ1YsTUFBTSxJQUFJLEtBQUssQ0FBQyx1QkFBdUIsQ0FBQyxDQUFDO1lBQzdDLENBQUMsQ0FBQztZQUVGLElBQUksRUFBRSxHQUFHLEtBQUssQ0FBQyxFQUFFLENBQUMsT0FBTyxDQUFDLENBQUM7WUFDM0IsS0FBSyxDQUFDLEdBQUcsQ0FBQyxFQUFFLENBQUMsQ0FBQztZQUVkLEtBQUssQ0FBQyxJQUFJLEVBQUUsQ0FBQztRQUNqQixDQUFDLENBQUMsQ0FBQztRQUNILEVBQUUsQ0FBQyxZQUFZLEVBQUUsQ0FBQyxJQUFlO1lBQzdCLElBQUksS0FBSyxHQUFHLElBQUkscUJBQWEsRUFBUSxDQUFDO1lBQ3RDLElBQUksT0FBTyxHQUFHLEVBQUUsQ0FBQztZQUNqQixJQUFJLE9BQU8sR0FBRztnQkFDVixFQUFFLENBQUMsQ0FBQyxJQUFJLEtBQUssT0FBTyxDQUFDO29CQUNqQixNQUFNLElBQUksS0FBSyxDQUFDLHVCQUF1QixDQUFDLENBQUM7Z0JBQzdDLElBQUk7b0JBQ0EsSUFBSSxFQUFFLENBQUM7WUFDZixDQUFDLENBQUM7WUFDRixxREFBcUQ7WUFDckQsb0VBQW9FO1lBRXBFLEtBQUssQ0FBQyxFQUFFLENBQUMsT0FBTyxFQUFFLE9BQU8sQ0FBQyxDQUFDO1lBQzNCLEtBQUssQ0FBQyxFQUFFLENBQUMsT0FBTyxFQUFFLE9BQU8sQ0FBQyxDQUFDO1lBQzNCLEtBQUssQ0FBQyxFQUFFLENBQUMsT0FBTyxDQUFDLENBQUM7WUFDbEIsS0FBSyxDQUFDLEdBQUcsQ0FBQyxPQUFPLENBQUMsQ0FBQztZQUVuQixLQUFLLENBQUMsSUFBSSxFQUFFLENBQUM7UUFDakIsQ0FBQyxDQUFDLENBQUM7UUFDSCxFQUFFLENBQUMsUUFBUSxFQUFFLENBQUMsSUFBZTtZQUN6QixJQUFJLEtBQUssR0FBRyxJQUFJLHFCQUFhLEVBQVEsQ0FBQztZQUN0QyxJQUFJLE9BQU8sR0FBRztnQkFDVixFQUFFLENBQUMsQ0FBQyxJQUFJLEtBQUssT0FBTyxDQUFDO29CQUNqQixNQUFNLElBQUksS0FBSyxDQUFDLHVCQUF1QixDQUFDLENBQUM7Z0JBQzdDLElBQUk7b0JBQ0EsSUFBSSxFQUFFLENBQUM7WUFDZixDQUFDLENBQUM7WUFDRixxREFBcUQ7WUFDckQsb0VBQW9FO1lBQ3BFLEtBQUssQ0FBQyxFQUFFLENBQUMsT0FBTyxDQUFDLENBQUM7WUFDbEIsS0FBSyxDQUFDLEVBQUUsQ0FBQyxPQUFPLENBQUMsQ0FBQztZQUNsQixLQUFLLENBQUMsR0FBRyxFQUFFLENBQUM7WUFDWixVQUFVLENBQUMsSUFBSSxFQUFFLEVBQUUsQ0FBQyxDQUFDO1lBRXJCLEtBQUssQ0FBQyxJQUFJLEVBQUUsQ0FBQztRQUNqQixDQUFDLENBQUMsQ0FBQztJQUNQLENBQUMsQ0FBQyxDQUFDO0lBRUgsUUFBUSxDQUFDLE1BQU0sRUFBRTtRQUNiLFlBQVksQ0FBQyxNQUFNLENBQUMsQ0FBQztRQUNyQixFQUFFLENBQUMsZUFBZSxFQUFFO1lBQ2hCLElBQUksS0FBSyxHQUFHLElBQUkscUJBQWEsRUFBUSxDQUFDO1lBQ3RDLElBQUksT0FBTyxHQUFHLElBQUksQ0FBQztZQUNuQixLQUFLLENBQUMsSUFBSSxDQUFDO2dCQUNQLElBQUksQ0FBQyxNQUFNLENBQUMsT0FBTyxDQUFDLENBQUM7Z0JBQ3JCLE9BQU8sR0FBRyxLQUFLLENBQUM7WUFDcEIsQ0FBQyxDQUFDLENBQUM7WUFDSCxLQUFLLENBQUMsSUFBSSxFQUFFLENBQUM7WUFDYixLQUFLLENBQUMsSUFBSSxFQUFFLENBQUM7UUFDakIsQ0FBQyxDQUFDLENBQUM7SUFDUCxDQUFDLENBQUMsQ0FBQztJQUNILFFBQVEsQ0FBQyxPQUFPLEVBQUU7UUFDZCxpQkFBaUIsQ0FBQyxPQUFPLENBQUMsQ0FBQztRQUMzQixFQUFFLENBQUMscUJBQXFCLEVBQUUsQ0FBQyxJQUFlO1lBQ3RDLElBQUksS0FBSyxHQUFHLElBQUkscUJBQWEsRUFBTyxDQUFDO1lBQ3JDLEtBQUssQ0FBQyxLQUFLLENBQUMsRUFBRSxDQUFDLEVBQUUsQ0FBQyxFQUFFLENBQUMsRUFBRSxDQUFDLEVBQUUsRUFBRSxjQUFjLElBQUksRUFBRSxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUM7WUFDckQsS0FBSyxDQUFDLElBQUksQ0FBQyxFQUFFLENBQUMsRUFBRSxDQUFDLEVBQUUsQ0FBQyxFQUFFLENBQUMsRUFBRSxDQUFDLEVBQUUsQ0FBQyxFQUFFLENBQUMsRUFBRSxHQUFHLEVBQUMsQ0FBQyxDQUFDO1FBQzVDLENBQUMsQ0FBQyxDQUFDO1FBQ0gsRUFBRSxDQUFDLGdCQUFnQixFQUFFLENBQUMsSUFBZTtZQUNqQyxJQUFJLEtBQUssR0FBRyxJQUFJLHFCQUFhLEVBQU8sQ0FBQztZQUNyQyxLQUFLLENBQUMsS0FBSyxDQUFDLEVBQUUsQ0FBQyxFQUFFLEVBQUMsQ0FBQyxFQUFHLEdBQUcsRUFBQyxFQUFFLENBQUMsRUFBRSxDQUFDLENBQUMsRUFBRSxDQUFDLENBQUMsRUFBRSxFQUFFLGNBQWMsSUFBSSxFQUFFLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQztZQUNsRSxLQUFLLENBQUMsSUFBSSxDQUFDLEVBQUUsQ0FBQyxFQUFFLEVBQUMsQ0FBQyxFQUFHLEdBQUcsRUFBRSxDQUFDLEVBQUUsRUFBQyxDQUFDLEVBQUUsQ0FBQyxFQUFDLEVBQUMsRUFBRSxDQUFDLEVBQUUsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxFQUFFLEVBQUUsQ0FBQyxFQUFFLEdBQUcsRUFBQyxFQUFFLElBQUksQ0FBQyxFQUFFLENBQUMsQ0FBQztRQUN4RSxDQUFDLENBQUMsQ0FBQztRQUNILEVBQUUsQ0FBQyxnQkFBZ0IsRUFBRSxDQUFDLElBQWU7WUFDakMsSUFBSSxLQUFLLEdBQUcsSUFBSSxxQkFBYSxFQUFPLENBQUM7WUFDckMsS0FBSyxDQUFDLEtBQUssQ0FBQyxhQUFhLEVBQUUsY0FBYyxJQUFJLEVBQUUsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDO1lBQ3BELEtBQUssQ0FBQyxJQUFJLENBQUMsY0FBYyxDQUFDLENBQUM7UUFDL0IsQ0FBQyxDQUFDLENBQUM7SUFDUCxDQUFDLENBQUMsQ0FBQztJQUNILFFBQVEsQ0FBQyxXQUFXLEVBQUU7UUFDbEIsaUJBQWlCLENBQUMsV0FBVyxDQUFDLENBQUM7UUFDL0IsRUFBRSxDQUFDLGNBQWMsRUFBRTtZQUNmLElBQUksS0FBSyxHQUFHLElBQUkscUJBQWEsRUFBVSxDQUFDO1lBQ3hDLElBQUksT0FBTyxHQUFHLElBQUksQ0FBQztZQUNuQixLQUFLLENBQUMsU0FBUyxDQUFDLE9BQU8sRUFBRTtnQkFDckIsSUFBSSxDQUFDLE1BQU0sQ0FBQyxPQUFPLENBQUMsQ0FBQztnQkFDckIsT0FBTyxHQUFHLEtBQUssQ0FBQztZQUNwQixDQUFDLENBQUMsQ0FBQztZQUNILEtBQUssQ0FBQyxJQUFJLENBQUMsT0FBTyxDQUFDLENBQUM7WUFDcEIsS0FBSyxDQUFDLElBQUksQ0FBQyxPQUFPLENBQUMsQ0FBQztZQUNwQixLQUFLLENBQUMsSUFBSSxDQUFDLFNBQVMsQ0FBQyxDQUFDO1FBQzFCLENBQUMsQ0FBQyxDQUFDO0lBQ1AsQ0FBQyxDQUFDLENBQUM7SUFDSCxRQUFRLENBQUMsTUFBTSxFQUFFO1FBQ2IsRUFBRSxDQUFDLGlDQUFpQyxFQUFFLENBQUMsSUFBZTtZQUNsRCxJQUFJLFNBQVMsR0FBRyxJQUFJLHFCQUFhLEVBQVUsQ0FBQztZQUM1QyxJQUFJLE9BQU8sR0FBRyxJQUFJLHFCQUFhLEVBQVUsQ0FBQztZQUMxQyxJQUFJLE9BQU8sR0FBRyxNQUFNLENBQUM7WUFDckIsT0FBTyxDQUFDLEVBQUUsQ0FBQyxVQUFVLEdBQVc7Z0JBQzVCLE1BQU0sQ0FBQyxHQUFHLENBQUMsQ0FBQyxFQUFFLENBQUMsS0FBSyxDQUFDLE9BQU8sQ0FBQyxDQUFDO2dCQUM5QixJQUFJLEVBQUUsQ0FBQztZQUNYLENBQUMsQ0FBQyxDQUFDO1lBQ0gsSUFBSSxFQUFFLEdBQUcsU0FBUyxDQUFDLElBQUksQ0FBQyxPQUFPLENBQUMsQ0FBQztZQUNqQyxNQUFNLENBQUMsT0FBTyxFQUFFLENBQUMsQ0FBQyxFQUFFLENBQUMsS0FBSyxDQUFDLFFBQVEsQ0FBQyxDQUFDO1lBQ3JDLFNBQVMsQ0FBQyxJQUFJLENBQUMsT0FBTyxDQUFDLENBQUM7UUFDNUIsQ0FBQyxDQUFDLENBQUM7UUFDSCxFQUFFLENBQUMsY0FBYyxFQUFFO1lBQ2YsSUFBSSxTQUFTLEdBQUcsSUFBSSxxQkFBYSxFQUFRLENBQUM7WUFDMUMsSUFBSSxPQUFPLEdBQUcsSUFBSSxxQkFBYSxFQUFRLENBQUM7WUFFeEMsT0FBTyxDQUFDLEVBQUUsQ0FBQyxjQUFjLE1BQU0sSUFBSSxLQUFLLENBQUMsbUJBQW1CLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDO1lBQ2xFLElBQUksRUFBRSxHQUFHLFNBQVMsQ0FBQyxJQUFJLENBQUMsT0FBTyxDQUFDLENBQUM7WUFDakMsU0FBUyxDQUFDLEdBQUcsQ0FBQyxFQUFFLENBQUMsQ0FBQztZQUNsQixTQUFTLENBQUMsSUFBSSxFQUFFLENBQUM7UUFDckIsQ0FBQyxDQUFDLENBQUM7UUFDSCxFQUFFLENBQUMsaUJBQWlCLEVBQUU7WUFDbEIsSUFBSSxTQUFTLEdBQUcsSUFBSSxxQkFBYSxFQUFRLENBQUM7WUFDMUMsSUFBSSxPQUFPLEdBQUcsSUFBSSxxQkFBYSxFQUFRLENBQUM7WUFFeEMsT0FBTyxDQUFDLEVBQUUsQ0FBQyxjQUFjLE1BQU0sSUFBSSxLQUFLLENBQUMsbUJBQW1CLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDO1lBQ2xFLFNBQVMsQ0FBQyxJQUFJLENBQUMsT0FBTyxDQUFDLENBQUM7WUFDeEIsU0FBUyxDQUFDLEdBQUcsQ0FBQyxPQUFPLENBQUMsQ0FBQztZQUN2QixTQUFTLENBQUMsSUFBSSxFQUFFLENBQUM7UUFDckIsQ0FBQyxDQUFDLENBQUM7SUFDUCxDQUFDLENBQUMsQ0FBQztJQUNILFFBQVEsQ0FBQyxPQUFPLEVBQUU7UUFDZCxFQUFFLENBQUMsUUFBUSxFQUFFO1lBQ1QsSUFBSSxTQUFTLEdBQUcsSUFBSSxxQkFBYSxFQUFVLENBQUM7WUFDNUMsSUFBSSxPQUFPLEdBQUcsSUFBSSxxQkFBYSxFQUFVLENBQUM7WUFFMUMsT0FBTyxDQUFDLEVBQUUsQ0FBQyxVQUFVLEdBQVc7Z0JBQzVCLE1BQU0sQ0FBQyxHQUFHLENBQUMsQ0FBQyxFQUFFLENBQUMsS0FBSyxDQUFDLE1BQU0sQ0FBQyxDQUFDO1lBQ2pDLENBQUMsQ0FBQyxDQUFDO1lBQ0gsSUFBSSxFQUFFLEdBQUcsU0FBUyxDQUFDLEtBQUssQ0FBQyxNQUFNLEVBQUUsT0FBTyxDQUFDLENBQUM7WUFDMUMsTUFBTSxDQUFDLE9BQU8sRUFBRSxDQUFDLENBQUMsRUFBRSxDQUFDLEtBQUssQ0FBQyxRQUFRLENBQUMsQ0FBQztZQUNyQyxTQUFTLENBQUMsSUFBSSxDQUFDLE1BQU0sQ0FBQyxDQUFDO1lBQ3ZCLFNBQVMsQ0FBQyxJQUFJLENBQUMsUUFBUSxDQUFDLENBQUM7WUFDekIsU0FBUyxDQUFDLElBQUksQ0FBQyxLQUFLLENBQUMsQ0FBQztRQUMxQixDQUFDLENBQUMsQ0FBQztRQUNILEVBQUUsQ0FBQyxRQUFRLEVBQUU7WUFDVCxJQUFJLFNBQVMsR0FBRyxJQUFJLHFCQUFhLEVBQVUsQ0FBQztZQUM1QyxJQUFJLE9BQU8sR0FBRyxJQUFJLHFCQUFhLEVBQVUsQ0FBQztZQUMxQyxJQUFJLElBQUksR0FBRyxDQUFDLENBQUM7WUFFYixPQUFPLENBQUMsRUFBRSxDQUFDLFVBQVUsR0FBVztnQkFDNUIsSUFBSSxDQUFDLE1BQU0sQ0FBQyxjQUFjLENBQUMsSUFBSSxDQUFDLEdBQUcsQ0FBQyxDQUFDLENBQUM7Z0JBQ3RDLElBQUksQ0FBQyxNQUFNLENBQUMsQ0FBQyxFQUFFLElBQUksQ0FBQyxDQUFBO1lBQ3hCLENBQUMsQ0FBQyxDQUFDO1lBQ0gsSUFBSSxFQUFFLEdBQUcsU0FBUyxDQUFDLEtBQUssQ0FBQyxjQUFjLEVBQUUsT0FBTyxDQUFDLENBQUM7WUFDbEQsTUFBTSxDQUFDLE9BQU8sRUFBRSxDQUFDLENBQUMsRUFBRSxDQUFDLEtBQUssQ0FBQyxRQUFRLENBQUMsQ0FBQztZQUNyQyxTQUFTLENBQUMsSUFBSSxDQUFDLE9BQU8sQ0FBQyxDQUFDO1lBQ3hCLFNBQVMsQ0FBQyxJQUFJLENBQUMsUUFBUSxDQUFDLENBQUM7WUFDekIsU0FBUyxDQUFDLElBQUksQ0FBQyxNQUFNLENBQUMsQ0FBQztRQUMzQixDQUFDLENBQUMsQ0FBQztJQUNQLENBQUMsQ0FBQyxDQUFDO0lBQ0gsUUFBUSxDQUFDLE9BQU8sRUFBRTtRQUNkLEVBQUUsQ0FBQyxxQkFBcUIsRUFBRSxDQUFDLElBQWU7WUFDdEMsSUFBSSxLQUFLLEdBQUcsSUFBSSxxQkFBYSxFQUFVLENBQUM7WUFDeEMsSUFBSSxPQUFPLEdBQVcsTUFBTSxDQUFDO1lBQzdCLEtBQUssQ0FBQyxLQUFLLEVBQUUsQ0FBQyxJQUFJLENBQUMsQ0FBQyxHQUFXO2dCQUMzQixNQUFNLENBQUMsR0FBRyxDQUFDLENBQUMsRUFBRSxDQUFDLEtBQUssQ0FBQyxPQUFPLENBQUMsQ0FBQztnQkFDOUIsSUFBSSxFQUFFLENBQUM7WUFDWCxDQUFDLENBQUMsQ0FBQztZQUNILEtBQUssQ0FBQyxJQUFJLENBQUMsT0FBTyxDQUFDLENBQUM7UUFDeEIsQ0FBQyxDQUFDLENBQUM7UUFFSCxFQUFFLENBQUMsMEJBQTBCLEVBQUUsQ0FBQyxJQUFlO1lBQzNDLElBQUksS0FBSyxHQUFHLElBQUkscUJBQWEsRUFBUSxDQUFDO1lBQ3RDLEtBQUssQ0FBQyxJQUFJLEVBQUUsQ0FBQztZQUNiLEtBQUssQ0FBQyxLQUFLLEVBQUUsQ0FBQyxJQUFJLENBQUM7Z0JBQ2YsSUFBSSxFQUFFLENBQUM7WUFDWCxDQUFDLENBQUMsQ0FBQztRQUNQLENBQUMsQ0FBQyxDQUFDO0lBQ1AsQ0FBQyxDQUFDLENBQUM7SUFDSCxRQUFRLENBQUMsTUFBTSxFQUFFO1FBQ2IsRUFBRSxDQUFDLHFCQUFxQixFQUFFLENBQUMsSUFBZTtZQUN0QyxJQUFJLEtBQUssR0FBRyxJQUFJLHFCQUFhLEVBQVUsQ0FBQztZQUN4QyxJQUFJLE9BQU8sR0FBVyxNQUFNLENBQUM7WUFDN0IsS0FBSyxDQUFDLElBQUksRUFBRSxDQUFDLElBQUksQ0FBQyxDQUFDLEdBQVc7Z0JBQzFCLE1BQU0sQ0FBQyxHQUFHLENBQUMsQ0FBQyxFQUFFLENBQUMsS0FBSyxDQUFDLE9BQU8sQ0FBQyxDQUFDO2dCQUM5QixJQUFJLEVBQUUsQ0FBQztZQUNYLENBQUMsQ0FBQyxDQUFDO1lBQ0gsS0FBSyxDQUFDLElBQUksQ0FBQyxPQUFPLENBQUMsQ0FBQztRQUN4QixDQUFDLENBQUMsQ0FBQztRQUNILEVBQUUsQ0FBQyxzQkFBc0IsRUFBRSxDQUFDLElBQWU7WUFDdkMsSUFBSSxLQUFLLEdBQUcsSUFBSSxxQkFBYSxFQUFVLENBQUM7WUFDeEMsSUFBSSxRQUFRLEdBQVcsT0FBTyxDQUFDO1lBQy9CLElBQUksUUFBUSxHQUFXLE9BQU8sQ0FBQztZQUMvQixLQUFLLENBQUMsSUFBSSxFQUFFLENBQUMsSUFBSSxDQUFDLENBQUMsR0FBVztnQkFDMUIsTUFBTSxDQUFDLEdBQUcsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxLQUFLLENBQUMsUUFBUSxDQUFDLENBQUM7Z0JBQy9CLEtBQUssQ0FBQyxJQUFJLEVBQUUsQ0FBQyxJQUFJLENBQUMsQ0FBQyxHQUFXO29CQUMxQixNQUFNLENBQUMsR0FBRyxDQUFDLENBQUMsRUFBRSxDQUFDLEtBQUssQ0FBQyxRQUFRLENBQUMsQ0FBQztvQkFDL0IsS0FBSyxDQUFDLElBQUksRUFBRSxDQUFDLElBQUksQ0FBQyxDQUFDLEdBQVc7d0JBQzFCLE1BQU0sQ0FBQyxHQUFHLENBQUMsQ0FBQyxFQUFFLENBQUMsS0FBSyxDQUFDLFFBQVEsQ0FBQyxDQUFDO3dCQUMvQixJQUFJLEVBQUUsQ0FBQztvQkFDWCxDQUFDLENBQUMsQ0FBQztvQkFDSCxLQUFLLENBQUMsSUFBSSxDQUFDLFFBQVEsQ0FBQyxDQUFDO2dCQUN6QixDQUFDLENBQUMsQ0FBQztnQkFDSCxLQUFLLENBQUMsSUFBSSxDQUFDLFFBQVEsQ0FBQyxDQUFDO1lBQ3pCLENBQUMsQ0FBQyxDQUFDO1lBQ0gsS0FBSyxDQUFDLElBQUksQ0FBQyxRQUFRLENBQUMsQ0FBQztRQUN6QixDQUFDLENBQUMsQ0FBQztJQUNQLENBQUMsQ0FBQyxDQUFDO0lBQ0gsRUFBRSxDQUFDLG9CQUFvQixFQUFFLENBQUMsSUFBZTtRQUNyQztZQUdJO2dCQUNJLENBQUMsSUFBSSxDQUFDLEtBQUssRUFBRSxJQUFJLENBQUMsT0FBTyxDQUFDLEdBQUcscUJBQWEsQ0FBQyxJQUFJLEVBQVEsQ0FBQztZQUM1RCxDQUFDO1lBQ0QsSUFBSTtnQkFDQSxJQUFJLENBQUMsS0FBSyxDQUFDLElBQUksRUFBRSxDQUFDO1lBQ3RCLENBQUM7U0FDSjtRQUNELElBQUksUUFBUSxHQUFHLElBQUksSUFBSSxFQUFFLENBQUM7UUFDMUIsUUFBUSxDQUFDLE9BQU8sQ0FBQyxFQUFFLENBQUMsSUFBSSxDQUFDLENBQUM7UUFDMUIsUUFBUSxDQUFDLElBQUksRUFBRSxDQUFDO0lBQ3BCLENBQUMsQ0FBQyxDQUFDO0FBQ1AsQ0FBQyxDQUFDLENBQUMiLCJzb3VyY2VzQ29udGVudCI6WyIvLy8gPHJlZmVyZW5jZSBwYXRoPVwiLi4vLi4vdHlwaW5ncy9pbmRleC5kLnRzXCIvPlxuXG5pbXBvcnQgKiBhcyBjaGFpIGZyb20gXCJjaGFpXCI7XG5pbXBvcnQge0V2ZW50UHJvcGVydHl9IGZyb20gXCIuLi9ldmVudFwiO1xuaW1wb3J0IHthc3NlcnR9IGZyb20gXCJ+Y2hhaS9saWIvQ2hhaVwiO1xubGV0IGV4cGVjdCA9IGNoYWkuZXhwZWN0O1xuXG5mdW5jdGlvbiB0ZXN0VHJpZ2dlcnMobWV0aG9kOiBzdHJpbmcpIHtcbiAgICBpdChcInJldHVybnMgbGlzdGVuZXJJZFwiLCAoKSA9PiB7XG4gICAgICAgIGxldCBldmVudCA9IG5ldyBFdmVudFByb3BlcnR5PHZvaWQ+KCk7XG4gICAgICAgIGxldCBpZCA9IGV2ZW50W21ldGhvZF0oKCkgPT4ge30pO1xuICAgICAgICBleHBlY3QodHlwZW9mIGlkKS50by5lcXVhbChcIm51bWJlclwiKTtcbiAgICB9KTtcbiAgICBpdChcInRyaWdnZXJzXCIsIChkb25lOiBNb2NoYURvbmUpID0+IHtcbiAgICAgICAgbGV0IGV2ZW50ID0gbmV3IEV2ZW50UHJvcGVydHk8dm9pZD4oKTtcbiAgICAgICAgZXZlbnRbbWV0aG9kXShkb25lKTtcbiAgICAgICAgZXZlbnQuZW1pdCgpO1xuICAgIH0pO1xuICAgIGl0KFwicGFzc2VzIGFyZ3VtZW50XCIsIChkb25lOiBNb2NoYURvbmUpID0+IHtcbiAgICAgICAgbGV0IHRlc3RBcmcgPSBcInRlc3RcIjtcbiAgICAgICAgbGV0IGV2ZW50ID0gbmV3IEV2ZW50UHJvcGVydHk8c3RyaW5nPigpO1xuICAgICAgICBldmVudFttZXRob2RdKChhcmc6IHN0cmluZykgPT4ge1xuICAgICAgICAgICAgZXhwZWN0KGFyZykudG8uYmUuZXF1YWwodGVzdEFyZyk7XG4gICAgICAgICAgICBkb25lKCk7XG4gICAgICAgIH0pO1xuICAgICAgICBldmVudC5lbWl0KHRlc3RBcmcpO1xuICAgIH0pO1xuICAgIGl0KFwicGFzc2VzIGNvbnRleHRcIiwgKGRvbmU6IE1vY2hhRG9uZSkgPT4ge1xuICAgICAgICBsZXQgZXZlbnQgPSBuZXcgRXZlbnRQcm9wZXJ0eTx2b2lkPigpO1xuICAgICAgICBsZXQgbGlzdGVuZXI6IHtcbiAgICAgICAgICAgIGl0SXNMaXN0ZW5lcjogYm9vbGVhbjtcbiAgICAgICAgICAgIGZuOiAoKSA9PiB2b2lkO1xuICAgICAgICB9O1xuICAgICAgICBsaXN0ZW5lciAgPSB7XG4gICAgICAgICAgICBpdElzTGlzdGVuZXI6IHRydWUsXG4gICAgICAgICAgICBmbigpIHtcbiAgICAgICAgICAgICAgICBjaGFpLmV4cGVjdCh0aGlzKS50by5iZS5lcXVhbChsaXN0ZW5lcik7XG4gICAgICAgICAgICAgICAgZG9uZSgpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9O1xuICAgICAgICBldmVudFttZXRob2RdKGxpc3RlbmVyLmZuLCBsaXN0ZW5lcik7XG4gICAgICAgIGV2ZW50LmVtaXQoKTtcbiAgICB9KTtcbn1cblxuZnVuY3Rpb24gdGVzdE1hdGNoVHJpZ2dlcnMobWV0aG9kOiBzdHJpbmcpIHtcbiAgICBsZXQgbWF0Y2ggPSBcInRlc3RNYXRjaFZhbHVlXCI7XG4gICAgaXQoXCJyZXR1cm5zIGxpc3RlbmVySWRcIiwgKCkgPT4ge1xuICAgICAgICBsZXQgZXZlbnQgPSBuZXcgRXZlbnRQcm9wZXJ0eTxzdHJpbmc+KCk7XG4gICAgICAgIGxldCBpZCA9IGV2ZW50W21ldGhvZF0obWF0Y2gsICgpID0+IHt9KTtcbiAgICAgICAgZXhwZWN0KHR5cGVvZiBpZCkudG8uZXF1YWwoXCJudW1iZXJcIik7XG4gICAgfSk7XG4gICAgaXQoXCJ0cmlnZ2Vyc1wiLCAoZG9uZTogTW9jaGFEb25lKSA9PiB7XG4gICAgICAgIGxldCBldmVudCA9IG5ldyBFdmVudFByb3BlcnR5PHN0cmluZz4oKTtcbiAgICAgICAgZXZlbnRbbWV0aG9kXShtYXRjaCwgZnVuY3Rpb24gKCkgeyBkb25lKCk7IH0pO1xuICAgICAgICBldmVudC5lbWl0KG1hdGNoKTtcbiAgICB9KTtcbiAgICBpdChcInBhc3NlcyBhcmd1bWVudFwiLCAoZG9uZTogTW9jaGFEb25lKSA9PiB7XG4gICAgICAgIGxldCB0ZXN0QXJnID0gXCJ0ZXN0XCI7XG4gICAgICAgIGxldCBldmVudCA9IG5ldyBFdmVudFByb3BlcnR5PHN0cmluZz4oKTtcbiAgICAgICAgZXZlbnRbbWV0aG9kXSh0ZXN0QXJnLCAoYXJnOiBzdHJpbmcpID0+IHtcbiAgICAgICAgICAgIGV4cGVjdChhcmcpLnRvLmJlLmVxdWFsKHRlc3RBcmcpO1xuICAgICAgICAgICAgZG9uZSgpO1xuICAgICAgICB9KTtcbiAgICAgICAgZXZlbnQuZW1pdCh0ZXN0QXJnKTtcbiAgICB9KTtcbiAgICBpdChcInBhc3NlcyBjb250ZXh0XCIsIChkb25lOiBNb2NoYURvbmUpID0+IHtcbiAgICAgICAgbGV0IGV2ZW50ID0gbmV3IEV2ZW50UHJvcGVydHk8c3RyaW5nPigpO1xuICAgICAgICBsZXQgbGlzdGVuZXI6IHtcbiAgICAgICAgICAgIGl0SXNMaXN0ZW5lcjogYm9vbGVhbjtcbiAgICAgICAgICAgIGZuOiAoKSA9PiB2b2lkO1xuICAgICAgICB9O1xuICAgICAgICBsaXN0ZW5lciAgPSB7XG4gICAgICAgICAgICBpdElzTGlzdGVuZXI6IHRydWUsXG4gICAgICAgICAgICBmbigpIHtcbiAgICAgICAgICAgICAgICBjaGFpLmV4cGVjdCh0aGlzKS50by5iZS5lcXVhbChsaXN0ZW5lcik7XG4gICAgICAgICAgICAgICAgZG9uZSgpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9O1xuICAgICAgICBldmVudFttZXRob2RdKG1hdGNoLCBsaXN0ZW5lci5mbiwgbGlzdGVuZXIpO1xuICAgICAgICBldmVudC5lbWl0KG1hdGNoKTtcbiAgICB9KTtcbiAgICBpdChcImlnbm9yZXMgaXJyZWxldmFudCBlbWl0c1wiLCAoKSA9PiB7XG4gICAgICAgIGxldCBldmVudCA9IG5ldyBFdmVudFByb3BlcnR5PHN0cmluZz4oKTtcbiAgICAgICAgZXZlbnRbbWV0aG9kXShtYXRjaCwgZnVuY3Rpb24gKCkgeyB0aHJvdyBuZXcgRXJyb3IoXCJNdXN0IG5vdCBiZSBpbnZva2VkXCIpOyB9KTtcbiAgICAgICAgZXZlbnQuZW1pdCgpO1xuICAgICAgICBldmVudC5lbWl0KFwiYWJjXCIpO1xuICAgICAgICBldmVudC5lbWl0KG51bGwpO1xuICAgIH0pO1xufVxuXG5kZXNjcmliZShcIkV2ZW50UHJvcGVydHlcIiwgKCkgPT4ge1xuICAgIGl0KFwiY29uc3RydWN0b3JcIiwgKCkgPT4ge1xuICAgICAgICBuZXcgRXZlbnRQcm9wZXJ0eTx2b2lkPigpO1xuICAgIH0pO1xuICAgIGRlc2NyaWJlKFwib25cIiwgKCkgPT4ge1xuICAgICAgICB0ZXN0VHJpZ2dlcnMoXCJvblwiKTtcbiAgICAgICAgaXQoXCJpbnZva2VzIGFsbCBsaXN0ZW5lcnNcIiwgKGRvbmU6IE1vY2hhRG9uZSkgPT4ge1xuICAgICAgICAgICAgbGV0IGV2ZW50ID0gbmV3IEV2ZW50UHJvcGVydHk8c3RyaW5nPigpO1xuICAgICAgICAgICAgbGV0IHJlc29sdmUxOiAoKSA9PiB2b2lkID0gbnVsbDtcbiAgICAgICAgICAgIGxldCByZXNvbHZlMjogKCkgPT4gdm9pZCA9IG51bGw7XG4gICAgICAgICAgICBsZXQgcHJvbWlzZTE6IFByb21pc2U8YW55PiA9IG5ldyBQcm9taXNlPGFueT4oKHJlc29sdmUpID0+IHsgcmVzb2x2ZTEgPSByZXNvbHZlOyB9KTtcbiAgICAgICAgICAgIGxldCBwcm9taXNlMjogUHJvbWlzZTxhbnk+ID0gbmV3IFByb21pc2U8YW55PigocmVzb2x2ZSkgPT4geyByZXNvbHZlMiA9IHJlc29sdmU7IH0pO1xuICAgICAgICAgICAgZXZlbnQub24ocmVzb2x2ZTEpO1xuICAgICAgICAgICAgZXZlbnQub24ocmVzb2x2ZTIpO1xuICAgICAgICAgICAgUHJvbWlzZS5hbGwoW3Byb21pc2UxLCBwcm9taXNlMl0pLnRoZW4oZnVuY3Rpb24oKXsgZG9uZSgpOyB9KS5jYXRjaChkb25lKTtcbiAgICAgICAgICAgIGV2ZW50LmVtaXQoKTtcbiAgICAgICAgfSk7XG4gICAgICAgIGl0KFwiaW52b2tlcyBsaXN0ZW5lcnMgb24gZWFjaCBlbWl0XCIsIChkb25lOiBNb2NoYURvbmUpID0+IHtcbiAgICAgICAgICAgIGxldCBldmVudCA9IG5ldyBFdmVudFByb3BlcnR5PHZvaWQ+KCk7XG4gICAgICAgICAgICBsZXQgbkV4cGVjdGVkID0gNTtcbiAgICAgICAgICAgIGxldCBuUmVnaXN0ZXJlZCA9IDA7XG4gICAgICAgICAgICBldmVudC5vbigoKSA9PiB7XG4gICAgICAgICAgICAgICAgblJlZ2lzdGVyZWQrKztcbiAgICAgICAgICAgICAgICBpZiAoblJlZ2lzdGVyZWQgPT09IG5FeHBlY3RlZCkgZG9uZSgpO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IG5FeHBlY3RlZDsgaSsrKSBldmVudC5lbWl0KCk7XG4gICAgICAgIH0pO1xuICAgIH0pO1xuXG4gICAgZGVzY3JpYmUoXCJvZmZcIiwgKCkgPT4ge1xuICAgICAgICBpdChcImJ5IGhhbmRsZXJcIiwgKCkgPT4ge1xuICAgICAgICAgICAgbGV0IGV2ZW50ID0gbmV3IEV2ZW50UHJvcGVydHk8dm9pZD4oKTtcbiAgICAgICAgICAgIGxldCBoYW5kbGVyID0gKCkgPT4ge1xuICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihcIlNob3VsZCBub3QgYmUgaW52b2tlZFwiKTtcbiAgICAgICAgICAgIH07XG5cbiAgICAgICAgICAgIGV2ZW50Lm9uKGhhbmRsZXIpO1xuICAgICAgICAgICAgZXZlbnQub2ZmKGhhbmRsZXIpO1xuXG4gICAgICAgICAgICBldmVudC5lbWl0KCk7XG4gICAgICAgIH0pO1xuICAgICAgICBpdChcImJ5IGlkXCIsICgpID0+IHtcbiAgICAgICAgICAgIGxldCBldmVudCA9IG5ldyBFdmVudFByb3BlcnR5PHZvaWQ+KCk7XG4gICAgICAgICAgICBsZXQgaGFuZGxlciA9ICgpID0+IHtcbiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXCJTaG91bGQgbm90IGJlIGludm9rZWRcIik7XG4gICAgICAgICAgICB9O1xuXG4gICAgICAgICAgICBsZXQgaWQgPSBldmVudC5vbihoYW5kbGVyKTtcbiAgICAgICAgICAgIGV2ZW50Lm9mZihpZCk7XG5cbiAgICAgICAgICAgIGV2ZW50LmVtaXQoKTtcbiAgICAgICAgfSk7XG4gICAgICAgIGl0KFwiYnkgY29udGV4dFwiLCAoZG9uZTogTW9jaGFEb25lKSA9PiB7XG4gICAgICAgICAgICBsZXQgZXZlbnQgPSBuZXcgRXZlbnRQcm9wZXJ0eTx2b2lkPigpO1xuICAgICAgICAgICAgbGV0IGNvbnRleHQgPSB7fTtcbiAgICAgICAgICAgIGxldCBoYW5kbGVyID0gZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgaWYgKHRoaXMgPT09IGNvbnRleHQpXG4gICAgICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihcIlNob3VsZCBub3QgYmUgaW52b2tlZFwiKTtcbiAgICAgICAgICAgICAgICBlbHNlXG4gICAgICAgICAgICAgICAgICAgIGRvbmUoKTtcbiAgICAgICAgICAgIH07XG4gICAgICAgICAgICAvLyBPZmYgYnkgY29udGV4dCBzaG91bGQgcmVtb3ZlIGFsbCBoYW5kbGVycyB3aXRoIHRoZVxuICAgICAgICAgICAgLy8gY29udGV4dCBidXQgc2hvdWxkIG5vdCBhZmZlY3QgdGhlIGhhbmRsZXJzIHBhc3NlZCB3aXRob3V0IGNvbnRleHRcblxuICAgICAgICAgICAgZXZlbnQub24oaGFuZGxlciwgY29udGV4dCk7XG4gICAgICAgICAgICBldmVudC5vbihoYW5kbGVyLCBjb250ZXh0KTtcbiAgICAgICAgICAgIGV2ZW50Lm9uKGhhbmRsZXIpO1xuICAgICAgICAgICAgZXZlbnQub2ZmKGNvbnRleHQpO1xuXG4gICAgICAgICAgICBldmVudC5lbWl0KCk7XG4gICAgICAgIH0pO1xuICAgICAgICBpdChcImNsZWFyc1wiLCAoZG9uZTogTW9jaGFEb25lKSA9PiB7XG4gICAgICAgICAgICBsZXQgZXZlbnQgPSBuZXcgRXZlbnRQcm9wZXJ0eTx2b2lkPigpO1xuICAgICAgICAgICAgbGV0IGhhbmRsZXIgPSBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICBpZiAodGhpcyA9PT0gY29udGV4dClcbiAgICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKFwiU2hvdWxkIG5vdCBiZSBpbnZva2VkXCIpO1xuICAgICAgICAgICAgICAgIGVsc2VcbiAgICAgICAgICAgICAgICAgICAgZG9uZSgpO1xuICAgICAgICAgICAgfTtcbiAgICAgICAgICAgIC8vIE9mZiBieSBjb250ZXh0IHNob3VsZCByZW1vdmUgYWxsIGhhbmRsZXJzIHdpdGggdGhlXG4gICAgICAgICAgICAvLyBjb250ZXh0IGJ1dCBzaG91bGQgbm90IGFmZmVjdCB0aGUgaGFuZGxlcnMgcGFzc2VkIHdpdGhvdXQgY29udGV4dFxuICAgICAgICAgICAgZXZlbnQub24oaGFuZGxlcik7XG4gICAgICAgICAgICBldmVudC5vbihoYW5kbGVyKTtcbiAgICAgICAgICAgIGV2ZW50Lm9mZigpO1xuICAgICAgICAgICAgc2V0VGltZW91dChkb25lLCAxMCk7XG5cbiAgICAgICAgICAgIGV2ZW50LmVtaXQoKTtcbiAgICAgICAgfSk7XG4gICAgfSk7XG5cbiAgICBkZXNjcmliZShcIm9uY2VcIiwgKCkgPT4ge1xuICAgICAgICB0ZXN0VHJpZ2dlcnMoXCJvbmNlXCIpO1xuICAgICAgICBpdChcInRyaWdnZXJzIG9uY2VcIiwgKCkgPT4ge1xuICAgICAgICAgICAgbGV0IGV2ZW50ID0gbmV3IEV2ZW50UHJvcGVydHk8dm9pZD4oKTtcbiAgICAgICAgICAgIGxldCBpc0ZpcnN0ID0gdHJ1ZTtcbiAgICAgICAgICAgIGV2ZW50Lm9uY2UoZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgIGNoYWkuYXNzZXJ0KGlzRmlyc3QpO1xuICAgICAgICAgICAgICAgIGlzRmlyc3QgPSBmYWxzZTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgZXZlbnQuZW1pdCgpO1xuICAgICAgICAgICAgZXZlbnQuZW1pdCgpO1xuICAgICAgICB9KTtcbiAgICB9KTtcbiAgICBkZXNjcmliZShcIm1hdGNoXCIsICgpID0+IHtcbiAgICAgICAgdGVzdE1hdGNoVHJpZ2dlcnMoXCJtYXRjaFwiKTtcbiAgICAgICAgaXQoXCJtYXRjaGVzIG9iamVjdCBwYXJ0XCIsIChkb25lOiBNb2NoYURvbmUpID0+IHtcbiAgICAgICAgICAgIGxldCBldmVudCA9IG5ldyBFdmVudFByb3BlcnR5PGFueT4oKTtcbiAgICAgICAgICAgIGV2ZW50Lm1hdGNoKHsgYTogMSwgYjogMiB9LCBmdW5jdGlvbiAoKSB7IGRvbmUoKTsgfSk7XG4gICAgICAgICAgICBldmVudC5lbWl0KHsgYTogMSwgYjogMiwgYzogMywgZDogXCJ4XCJ9KTtcbiAgICAgICAgfSk7XG4gICAgICAgIGl0KFwibWF0Y2hlcyBkZWVwZXJcIiwgKGRvbmU6IE1vY2hhRG9uZSkgPT4ge1xuICAgICAgICAgICAgbGV0IGV2ZW50ID0gbmV3IEV2ZW50UHJvcGVydHk8YW55PigpO1xuICAgICAgICAgICAgZXZlbnQubWF0Y2goeyBhOiB7eCA6IFwieVwifSwgYzogWzEsIDJdIH0sIGZ1bmN0aW9uICgpIHsgZG9uZSgpOyB9KTtcbiAgICAgICAgICAgIGV2ZW50LmVtaXQoeyBhOiB7eCA6IFwieVwiLCB6OiB7cjogMX19LCBjOiBbMSwgMiwgeyB4OiBcIj9cIn0sIG51bGxdIH0pO1xuICAgICAgICB9KTtcbiAgICAgICAgaXQoXCJtYXRjaGVzIHJlZ2V4cFwiLCAoZG9uZTogTW9jaGFEb25lKSA9PiB7XG4gICAgICAgICAgICBsZXQgZXZlbnQgPSBuZXcgRXZlbnRQcm9wZXJ0eTxhbnk+KCk7XG4gICAgICAgICAgICBldmVudC5tYXRjaCgvdGVzdFsxMjNdK3gvLCBmdW5jdGlvbiAoKSB7IGRvbmUoKTsgfSk7XG4gICAgICAgICAgICBldmVudC5lbWl0KFwidGVzdC10ZXN0MnhzXCIpO1xuICAgICAgICB9KTtcbiAgICB9KTtcbiAgICBkZXNjcmliZShcIm1hdGNoT25jZVwiLCAoKSA9PiB7XG4gICAgICAgIHRlc3RNYXRjaFRyaWdnZXJzKFwibWF0Y2hPbmNlXCIpO1xuICAgICAgICBpdChcIm1hdGNoZXMgb25jZVwiLCAoKSA9PiB7XG4gICAgICAgICAgICBsZXQgZXZlbnQgPSBuZXcgRXZlbnRQcm9wZXJ0eTxzdHJpbmc+KCk7XG4gICAgICAgICAgICBsZXQgaXNGaXJzdCA9IHRydWU7XG4gICAgICAgICAgICBldmVudC5tYXRjaE9uY2UoXCJtYXRjaFwiLCBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgY2hhaS5hc3NlcnQoaXNGaXJzdCk7XG4gICAgICAgICAgICAgICAgaXNGaXJzdCA9IGZhbHNlO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICBldmVudC5lbWl0KFwibWF0Y2hcIik7XG4gICAgICAgICAgICBldmVudC5lbWl0KFwibWF0Y2hcIik7XG4gICAgICAgICAgICBldmVudC5lbWl0KFwidW5tYXRjaFwiKTtcbiAgICAgICAgfSk7XG4gICAgfSk7XG4gICAgZGVzY3JpYmUoXCJwaXBlXCIsICgpID0+IHtcbiAgICAgICAgaXQoXCJwYXNzZXMgYXJndW1lbnQsIGdldCBsaXN0ZW5lcklkXCIsIChkb25lOiBNb2NoYURvbmUpID0+IHtcbiAgICAgICAgICAgIGxldCBldmVudEZyb20gPSBuZXcgRXZlbnRQcm9wZXJ0eTxzdHJpbmc+KCk7XG4gICAgICAgICAgICBsZXQgZXZlbnRUbyA9IG5ldyBFdmVudFByb3BlcnR5PHN0cmluZz4oKTtcbiAgICAgICAgICAgIGxldCB0ZXN0QXJnID0gXCJ0ZXN0XCI7XG4gICAgICAgICAgICBldmVudFRvLm9uKGZ1bmN0aW9uIChhcmc6IHN0cmluZykge1xuICAgICAgICAgICAgICAgIGV4cGVjdChhcmcpLnRvLmVxdWFsKHRlc3RBcmcpO1xuICAgICAgICAgICAgICAgIGRvbmUoKTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgbGV0IGlkID0gZXZlbnRGcm9tLnBpcGUoZXZlbnRUbyk7XG4gICAgICAgICAgICBleHBlY3QodHlwZW9mIGlkKS50by5lcXVhbChcIm51bWJlclwiKTtcbiAgICAgICAgICAgIGV2ZW50RnJvbS5lbWl0KHRlc3RBcmcpO1xuICAgICAgICB9KTtcbiAgICAgICAgaXQoXCJvZmZzIHdpdGggaWRcIiwgKCkgPT4ge1xuICAgICAgICAgICAgbGV0IGV2ZW50RnJvbSA9IG5ldyBFdmVudFByb3BlcnR5PHZvaWQ+KCk7XG4gICAgICAgICAgICBsZXQgZXZlbnRUbyA9IG5ldyBFdmVudFByb3BlcnR5PHZvaWQ+KCk7XG5cbiAgICAgICAgICAgIGV2ZW50VG8ub24oZnVuY3Rpb24gKCkgeyB0aHJvdyBuZXcgRXJyb3IoXCJTaG91bGQgbm90IGhhcHBlblwiKTsgfSk7XG4gICAgICAgICAgICBsZXQgaWQgPSBldmVudEZyb20ucGlwZShldmVudFRvKTtcbiAgICAgICAgICAgIGV2ZW50RnJvbS5vZmYoaWQpO1xuICAgICAgICAgICAgZXZlbnRGcm9tLmVtaXQoKTtcbiAgICAgICAgfSk7XG4gICAgICAgIGl0KFwib2ZmcyB3aXRoIGV2ZW50XCIsICgpID0+IHtcbiAgICAgICAgICAgIGxldCBldmVudEZyb20gPSBuZXcgRXZlbnRQcm9wZXJ0eTx2b2lkPigpO1xuICAgICAgICAgICAgbGV0IGV2ZW50VG8gPSBuZXcgRXZlbnRQcm9wZXJ0eTx2b2lkPigpO1xuXG4gICAgICAgICAgICBldmVudFRvLm9uKGZ1bmN0aW9uICgpIHsgdGhyb3cgbmV3IEVycm9yKFwiU2hvdWxkIG5vdCBoYXBwZW5cIik7IH0pO1xuICAgICAgICAgICAgZXZlbnRGcm9tLnBpcGUoZXZlbnRUbyk7XG4gICAgICAgICAgICBldmVudEZyb20ub2ZmKGV2ZW50VG8pO1xuICAgICAgICAgICAgZXZlbnRGcm9tLmVtaXQoKTtcbiAgICAgICAgfSk7XG4gICAgfSk7XG4gICAgZGVzY3JpYmUoXCJyb3V0ZVwiLCAoKSA9PiB7XG4gICAgICAgIGl0KFwic3RyaW5nXCIsICgpID0+IHtcbiAgICAgICAgICAgIGxldCBldmVudEZyb20gPSBuZXcgRXZlbnRQcm9wZXJ0eTxzdHJpbmc+KCk7XG4gICAgICAgICAgICBsZXQgZXZlbnRUbyA9IG5ldyBFdmVudFByb3BlcnR5PHN0cmluZz4oKTtcblxuICAgICAgICAgICAgZXZlbnRUby5vbihmdW5jdGlvbiAoYXJnOiBzdHJpbmcpIHtcbiAgICAgICAgICAgICAgICBleHBlY3QoYXJnKS50by5lcXVhbChcInRlc3RcIik7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIGxldCBpZCA9IGV2ZW50RnJvbS5yb3V0ZShcInRlc3RcIiwgZXZlbnRUbyk7XG4gICAgICAgICAgICBleHBlY3QodHlwZW9mIGlkKS50by5lcXVhbChcIm51bWJlclwiKTtcbiAgICAgICAgICAgIGV2ZW50RnJvbS5lbWl0KFwidGVzdFwiKTtcbiAgICAgICAgICAgIGV2ZW50RnJvbS5lbWl0KFwicmFuZG9tXCIpO1xuICAgICAgICAgICAgZXZlbnRGcm9tLmVtaXQoXCJhbnlcIik7XG4gICAgICAgIH0pO1xuICAgICAgICBpdChcInJlZ2V4cFwiLCAoKSA9PiB7XG4gICAgICAgICAgICBsZXQgZXZlbnRGcm9tID0gbmV3IEV2ZW50UHJvcGVydHk8c3RyaW5nPigpO1xuICAgICAgICAgICAgbGV0IGV2ZW50VG8gPSBuZXcgRXZlbnRQcm9wZXJ0eTxzdHJpbmc+KCk7XG4gICAgICAgICAgICBsZXQgcGFzcyA9IDE7XG5cbiAgICAgICAgICAgIGV2ZW50VG8ub24oZnVuY3Rpb24gKGFyZzogc3RyaW5nKSB7XG4gICAgICAgICAgICAgICAgY2hhaS5hc3NlcnQoL15cXC9bYS16QS1aXSovLnRlc3QoYXJnKSk7XG4gICAgICAgICAgICAgICAgY2hhaS5hc3NlcnQoIS0tcGFzcylcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgbGV0IGlkID0gZXZlbnRGcm9tLnJvdXRlKC9eXFwvW2EtekEtWl0rLywgZXZlbnRUbyk7XG4gICAgICAgICAgICBleHBlY3QodHlwZW9mIGlkKS50by5lcXVhbChcIm51bWJlclwiKTtcbiAgICAgICAgICAgIGV2ZW50RnJvbS5lbWl0KFwiL3Jvb3RcIik7XG4gICAgICAgICAgICBldmVudEZyb20uZW1pdChcInJhbmRvbVwiKTtcbiAgICAgICAgICAgIGV2ZW50RnJvbS5lbWl0KFwiLzM0L1wiKTtcbiAgICAgICAgfSk7XG4gICAgfSk7XG4gICAgZGVzY3JpYmUoXCJmaXJzdFwiLCAoKSA9PiB7XG4gICAgICAgIGl0KFwicmVzb2x2ZXMgd2l0aCB2YWx1ZVwiLCAoZG9uZTogTW9jaGFEb25lKSA9PiB7XG4gICAgICAgICAgICBsZXQgZXZlbnQgPSBuZXcgRXZlbnRQcm9wZXJ0eTxzdHJpbmc+KCk7XG4gICAgICAgICAgICBsZXQgdGVzdEFyZzogc3RyaW5nID0gXCJ0ZXN0XCI7XG4gICAgICAgICAgICBldmVudC5maXJzdCgpLnRoZW4oKGFyZzogc3RyaW5nKSA9PiB7XG4gICAgICAgICAgICAgICAgZXhwZWN0KGFyZykudG8uZXF1YWwodGVzdEFyZyk7XG4gICAgICAgICAgICAgICAgZG9uZSgpO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICBldmVudC5lbWl0KHRlc3RBcmcpO1xuICAgICAgICB9KTtcblxuICAgICAgICBpdChcImNhbiBiZSBjYXVnaHQgYWZ0ZXIgZW1pdFwiLCAoZG9uZTogTW9jaGFEb25lKSA9PiB7XG4gICAgICAgICAgICBsZXQgZXZlbnQgPSBuZXcgRXZlbnRQcm9wZXJ0eTx2b2lkPigpO1xuICAgICAgICAgICAgZXZlbnQuZW1pdCgpO1xuICAgICAgICAgICAgZXZlbnQuZmlyc3QoKS50aGVuKCgpID0+IHtcbiAgICAgICAgICAgICAgICBkb25lKCk7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfSk7XG4gICAgfSk7XG4gICAgZGVzY3JpYmUoXCJuZXh0XCIsICgpID0+IHtcbiAgICAgICAgaXQoXCJyZXNvbHZlcyB3aXRoIHZhbHVlXCIsIChkb25lOiBNb2NoYURvbmUpID0+IHtcbiAgICAgICAgICAgIGxldCBldmVudCA9IG5ldyBFdmVudFByb3BlcnR5PHN0cmluZz4oKTtcbiAgICAgICAgICAgIGxldCB0ZXN0QXJnOiBzdHJpbmcgPSBcInRlc3RcIjtcbiAgICAgICAgICAgIGV2ZW50Lm5leHQoKS50aGVuKChhcmc6IHN0cmluZykgPT4ge1xuICAgICAgICAgICAgICAgIGV4cGVjdChhcmcpLnRvLmVxdWFsKHRlc3RBcmcpO1xuICAgICAgICAgICAgICAgIGRvbmUoKTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgZXZlbnQuZW1pdCh0ZXN0QXJnKTtcbiAgICAgICAgfSk7XG4gICAgICAgIGl0KFwiY3JlYXRlcyBuZXcgcHJvbWlzZXNcIiwgKGRvbmU6IE1vY2hhRG9uZSkgPT4ge1xuICAgICAgICAgICAgbGV0IGV2ZW50ID0gbmV3IEV2ZW50UHJvcGVydHk8c3RyaW5nPigpO1xuICAgICAgICAgICAgbGV0IHRlc3RBcmcxOiBzdHJpbmcgPSBcInRlc3QxXCI7XG4gICAgICAgICAgICBsZXQgdGVzdEFyZzI6IHN0cmluZyA9IFwidGVzdDJcIjtcbiAgICAgICAgICAgIGV2ZW50Lm5leHQoKS50aGVuKChhcmc6IHN0cmluZykgPT4ge1xuICAgICAgICAgICAgICAgIGV4cGVjdChhcmcpLnRvLmVxdWFsKHRlc3RBcmcxKTtcbiAgICAgICAgICAgICAgICBldmVudC5uZXh0KCkudGhlbigoYXJnOiBzdHJpbmcpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgZXhwZWN0KGFyZykudG8uZXF1YWwodGVzdEFyZzIpO1xuICAgICAgICAgICAgICAgICAgICBldmVudC5uZXh0KCkudGhlbigoYXJnOiBzdHJpbmcpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGV4cGVjdChhcmcpLnRvLmVxdWFsKHRlc3RBcmcxKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGRvbmUoKTtcbiAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgICAgIGV2ZW50LmVtaXQodGVzdEFyZzEpO1xuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIGV2ZW50LmVtaXQodGVzdEFyZzIpO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICBldmVudC5lbWl0KHRlc3RBcmcxKTtcbiAgICAgICAgfSk7XG4gICAgfSk7XG4gICAgaXQoXCJFdmVudFByb3BlcnR5Lm1ha2VcIiwgKGRvbmU6IE1vY2hhRG9uZSkgPT4ge1xuICAgICAgICBjbGFzcyBUZXN0IHtcbiAgICAgICAgICAgIHByaXZhdGUgZXZlbnQ6IEV2ZW50UHJvcGVydHk8dm9pZD47XG4gICAgICAgICAgICBwdWJsaWMgZW1pdHRlcjogRXZlbnRQcm9wZXJ0eS5FbWl0dGVyPHZvaWQ+O1xuICAgICAgICAgICAgY29uc3RydWN0b3IoKSB7XG4gICAgICAgICAgICAgICAgW3RoaXMuZXZlbnQsIHRoaXMuZW1pdHRlcl0gPSBFdmVudFByb3BlcnR5Lm1ha2U8dm9pZD4oKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHRlc3QoKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5ldmVudC5lbWl0KCk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgbGV0IGluc3RhbmNlID0gbmV3IFRlc3QoKTtcbiAgICAgICAgaW5zdGFuY2UuZW1pdHRlci5vbihkb25lKTtcbiAgICAgICAgaW5zdGFuY2UudGVzdCgpO1xuICAgIH0pO1xufSk7Il19