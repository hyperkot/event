/// <reference path="../../typings/index.d.ts"/>
Object.defineProperty(exports, "__esModule", { value: true });
const chai = require("chai");
const event_1 = require("../event");
let expect = chai.expect;
describe("EventProperty", () => {
    it("constructor", () => {
        new event_1.EventProperty();
    });
    describe("on", () => {
        testTriggers("on");
        it("invokes all listeners", (done) => {
            let event = new event_1.EventProperty.Void();
            let resolve1 = null;
            let resolve2 = null;
            let promise1 = new Promise((resolve) => { resolve1 = resolve; });
            let promise2 = new Promise((resolve) => { resolve2 = resolve; });
            event.on(resolve1);
            event.on(resolve2);
            Promise.all([promise1, promise2]).then(function () { done(); }).catch(done);
            event.emit();
        });
        it("invokes listeners on each emit", (done) => {
            let event = new event_1.EventProperty.Void();
            let nExpected = 5;
            let nRegistered = 0;
            event.on(() => {
                nRegistered++;
                if (nRegistered === nExpected)
                    done();
            });
            for (let i = 0; i < nExpected; i++)
                event.emit();
        });
    });
    describe("off", () => {
        it("by handler", () => {
            let event = new event_1.EventProperty.Void();
            let handler = () => {
                throw new Error("Should not be invoked");
            };
            event.on(handler);
            event.off(handler);
            event.emit();
        });
        it("by id", () => {
            let event = new event_1.EventProperty.Void();
            let handler = () => {
                throw new Error("Should not be invoked");
            };
            let id = event.on(handler);
            event.off(id);
            event.emit();
        });
        it("by context", (done) => {
            let event = new event_1.EventProperty.Void();
            let context = {};
            let handler = function () {
                if (this === context)
                    throw new Error("Should not be invoked");
                else
                    done();
            };
            // Off by context should remove all handlers with the
            // context but should not affect the handlers passed without context
            event.on(handler, context);
            event.on(handler, context);
            event.on(handler);
            event.off(context);
            event.emit();
        });
        it("clears", (done) => {
            let event = new event_1.EventProperty.Void();
            let handler = function () {
                if (this === context)
                    throw new Error("Should not be invoked");
                else
                    done();
            };
            // Off by context should remove all handlers with the
            // context but should not affect the handlers passed without context
            event.on(handler);
            event.on(handler);
            event.off();
            setTimeout(done, 10);
            event.emit();
        });
    });
    describe("once", () => {
        testTriggers("once");
        it("triggers once", () => {
            let event = new event_1.EventProperty.Void();
            let isFirst = true;
            event.once(function () {
                chai.assert(isFirst);
                isFirst = false;
            });
            event.emit();
            event.emit();
        });
    });
    describe("match", () => {
        testMatchTriggers("match");
        it("matches object part", (done) => {
            let event = new event_1.EventProperty();
            event.match({ a: 1, b: 2 }, function () { done(); });
            event.emit({ a: 1, b: 2, c: 3, d: "x" });
        });
        it("matches deeper", (done) => {
            let event = new event_1.EventProperty();
            event.match({ a: { x: "y" }, c: [1, 2] }, function () { done(); });
            event.emit({ a: { x: "y", z: { r: 1 } }, c: [1, 2, { x: "?" }, null] });
        });
        it("matches regexp", (done) => {
            let event = new event_1.EventProperty();
            event.match(/test[123]+x/, function () { done(); });
            event.emit("test-test2xs");
        });
    });
    describe("matchOnce", () => {
        testMatchTriggers("matchOnce");
        it("matches once", () => {
            let event = new event_1.EventProperty();
            let isFirst = true;
            event.matchOnce("match", function () {
                chai.assert(isFirst);
                isFirst = false;
            });
            event.emit("match");
            event.emit("match");
            event.emit("unmatch");
        });
    });
    describe("pipe", () => {
        it("passes argument, get listenerId", (done) => {
            let eventFrom = new event_1.EventProperty();
            let eventTo = new event_1.EventProperty();
            let testArg = "test";
            eventTo.on(function (arg) {
                expect(arg).to.equal(testArg);
                done();
            });
            let id = eventFrom.pipe(eventTo);
            expect(typeof id).to.equal("number");
            eventFrom.emit(testArg);
        });
        it("offs with id", () => {
            let eventFrom = new event_1.EventProperty.Void();
            let eventTo = new event_1.EventProperty.Void();
            eventTo.on(function () { throw new Error("Should not happen"); });
            let id = eventFrom.pipe(eventTo);
            eventFrom.off(id);
            eventFrom.emit();
        });
        it("offs with event", () => {
            let eventFrom = new event_1.EventProperty.Void();
            let eventTo = new event_1.EventProperty.Void();
            eventTo.on(function () { throw new Error("Should not happen"); });
            eventFrom.pipe(eventTo);
            eventFrom.off(eventTo);
            eventFrom.emit();
        });
    });
    describe("route", () => {
        it("string", () => {
            let eventFrom = new event_1.EventProperty();
            let eventTo = new event_1.EventProperty();
            eventTo.on(function (arg) {
                expect(arg).to.equal("test");
            });
            let id = eventFrom.route("test", eventTo);
            expect(typeof id).to.equal("number");
            eventFrom.emit("test");
            eventFrom.emit("random");
            eventFrom.emit("any");
        });
        it("regexp", () => {
            let eventFrom = new event_1.EventProperty();
            let eventTo = new event_1.EventProperty();
            let pass = 1;
            eventTo.on(function (arg) {
                chai.assert(/^\/[a-zA-Z]*/.test(arg));
                chai.assert(!--pass);
            });
            let id = eventFrom.route(/^\/[a-zA-Z]+/, eventTo);
            expect(typeof id).to.equal("number");
            eventFrom.emit("/root");
            eventFrom.emit("random");
            eventFrom.emit("/34/");
        });
    });
    describe("first", () => {
        it("resolves with value", (done) => {
            let event = new event_1.EventProperty();
            let testArg = "test";
            event.first.then((arg) => {
                expect(arg).to.equal(testArg);
                done();
            });
            event.emit(testArg);
        });
        it("can be caught after emit", (done) => {
            let event = new event_1.EventProperty.Void();
            event.emit();
            event.first.then(() => {
                done();
            });
        });
    });
    describe("next", () => {
        it("resolves with value", (done) => {
            let event = new event_1.EventProperty();
            let testArg = "test";
            event.next().then((arg) => {
                expect(arg).to.equal(testArg);
                done();
            });
            event.emit(testArg);
        });
        it("creates new promises", (done) => {
            let event = new event_1.EventProperty();
            let testArg1 = "test1";
            let testArg2 = "test2";
            event.next().then((arg) => {
                expect(arg).to.equal(testArg1);
                event.next().then((arg) => {
                    expect(arg).to.equal(testArg2);
                    event.next().then((arg) => {
                        expect(arg).to.equal(testArg1);
                        done();
                    });
                    event.emit(testArg1);
                });
                event.emit(testArg2);
            });
            event.emit(testArg1);
        });
    });
    it("EventProperty.make", (done) => {
        class Test {
            constructor() {
                [this.event, this.emitter] = event_1.EventProperty.make();
            }
            test() {
                this.event.emit("test");
            }
        }
        let instance = new Test();
        instance.emitter.on(() => done());
        instance.test();
    });
});
function testTriggers(method) {
    it("returns listenerId", () => {
        let event = new event_1.EventProperty();
        let id = event[method](() => { });
        expect(typeof id).to.equal("number");
    });
    it("triggers", (done) => {
        let event = new event_1.EventProperty.Void();
        event[method](done);
        event.emit();
    });
    it("passes argument", (done) => {
        let testArg = "test";
        let event = new event_1.EventProperty();
        event[method]((arg) => {
            expect(arg).to.be.equal(testArg);
            done();
        });
        event.emit(testArg);
    });
    it("passes context", (done) => {
        let event = new event_1.EventProperty.Void();
        let listener;
        listener = {
            itIsListener: true,
            fn() {
                chai.expect(this).to.be.equal(listener);
                done();
            }
        };
        event[method](listener.fn, listener);
        event.emit();
    });
}
function testMatchTriggers(method) {
    let match = "testMatchValue";
    it("returns listenerId", () => {
        let event = new event_1.EventProperty();
        let id = event[method](match, () => { });
        expect(typeof id).to.equal("number");
    });
    it("triggers", (done) => {
        let event = new event_1.EventProperty();
        event[method](match, function () { done(); });
        event.emit(match);
    });
    it("passes argument", (done) => {
        let testArg = "test";
        let event = new event_1.EventProperty();
        event[method](testArg, (arg) => {
            expect(arg).to.be.equal(testArg);
            done();
        });
        event.emit(testArg);
    });
    it("passes context", (done) => {
        let event = new event_1.EventProperty();
        let listener;
        listener = {
            itIsListener: true,
            fn() {
                chai.expect(this).to.be.equal(listener);
                done();
            }
        };
        event[method](match, listener.fn, listener);
        event.emit(match);
    });
    it("ignores irrelevant emits", () => {
        let event = new event_1.EventProperty();
        event[method](match, function () { throw new Error("Must not be invoked"); });
        event.emit("");
        event.emit("abc");
        event.emit(null);
    });
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZXZlbnQuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi9zcmMvdGVzdC9ldmVudC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQSxnREFBZ0Q7O0FBRWhELDZCQUE2QjtBQUM3QixvQ0FBdUM7QUFFdkMsSUFBSSxNQUFNLEdBQUcsSUFBSSxDQUFDLE1BQU0sQ0FBQztBQUV6QixRQUFRLENBQUMsZUFBZSxFQUFFO0lBQ3RCLEVBQUUsQ0FBQyxhQUFhLEVBQUU7UUFDZCxJQUFJLHFCQUFhLEVBQVEsQ0FBQztJQUM5QixDQUFDLENBQUMsQ0FBQztJQUNILFFBQVEsQ0FBQyxJQUFJLEVBQUU7UUFDWCxZQUFZLENBQUMsSUFBSSxDQUFDLENBQUM7UUFFbkIsRUFBRSxDQUFDLHVCQUF1QixFQUFFLENBQUMsSUFBZTtZQUN4QyxJQUFJLEtBQUssR0FBRyxJQUFJLHFCQUFhLENBQUMsSUFBSSxFQUFFLENBQUM7WUFDckMsSUFBSSxRQUFRLEdBQWUsSUFBSSxDQUFDO1lBQ2hDLElBQUksUUFBUSxHQUFlLElBQUksQ0FBQztZQUNoQyxJQUFJLFFBQVEsR0FBaUIsSUFBSSxPQUFPLENBQU0sQ0FBQyxPQUFPLE9BQU8sUUFBUSxHQUFHLE9BQU8sQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDO1lBQ3BGLElBQUksUUFBUSxHQUFpQixJQUFJLE9BQU8sQ0FBTSxDQUFDLE9BQU8sT0FBTyxRQUFRLEdBQUcsT0FBTyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUM7WUFDcEYsS0FBSyxDQUFDLEVBQUUsQ0FBQyxRQUFRLENBQUMsQ0FBQztZQUNuQixLQUFLLENBQUMsRUFBRSxDQUFDLFFBQVEsQ0FBQyxDQUFDO1lBQ25CLE9BQU8sQ0FBQyxHQUFHLENBQUMsQ0FBQyxRQUFRLEVBQUUsUUFBUSxDQUFDLENBQUMsQ0FBQyxJQUFJLENBQUMsY0FBWSxJQUFJLEVBQUUsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLEtBQUssQ0FBQyxJQUFJLENBQUMsQ0FBQztZQUMx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O1FBQ0YsS0FBSyxDQUFDLE1BQU0sQ0FBQyxDQUFDLEtBQUssRUFBRSxRQUFRLENBQUMsRUFBRSxFQUFFLFFBQVEsQ0FBQyxDQUFDO1FBQzVDLEtBQUssQ0FBQyxJQUFJLENBQUMsS0FBSyxDQUFDLENBQUM7SUFDdEIsQ0FBQyxDQUFDLENBQUM7SUFDSCxFQUFFLENBQUMsMEJBQTBCLEVBQUU7UUFDM0IsSUFBSSxLQUFLLEdBQUcsSUFBSSxxQkFBYSxFQUFVLENBQUM7UUFDeEMsS0FBSyxDQUFDLE1BQU0sQ0FBQyxDQUFDLEtBQUssRUFBRSxjQUFjLE1BQU0sSUFBSSxLQUFLLENBQUMscUJBQXFCLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDO1FBQzlFLEtBQUssQ0FBQyxJQUFJLENBQUMsRUFBRSxDQUFDLENBQUM7UUFDZixLQUFLLENBQUMsSUFBSSxDQUFDLEtBQUssQ0FBQyxDQUFDO1FBQ2xCLEtBQUssQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLENBQUM7SUFDckIsQ0FBQyxDQUFDLENBQUM7QUFDUCxDQUFDIiwic291cmNlc0NvbnRlbnQiOlsiLy8vIDxyZWZlcmVuY2UgcGF0aD1cIi4uLy4uL3R5cGluZ3MvaW5kZXguZC50c1wiLz5cblxuaW1wb3J0ICogYXMgY2hhaSBmcm9tIFwiY2hhaVwiO1xuaW1wb3J0IHtFdmVudFByb3BlcnR5fSBmcm9tIFwiLi4vZXZlbnRcIjtcbmltcG9ydCB7YXNzZXJ0fSBmcm9tIFwifmNoYWkvbGliL0NoYWlcIjtcbmxldCBleHBlY3QgPSBjaGFpLmV4cGVjdDtcblxuZGVzY3JpYmUoXCJFdmVudFByb3BlcnR5XCIsICgpID0+IHtcbiAgICBpdChcImNvbnN0cnVjdG9yXCIsICgpID0+IHtcbiAgICAgICAgbmV3IEV2ZW50UHJvcGVydHk8dm9pZD4oKTtcbiAgICB9KTtcbiAgICBkZXNjcmliZShcIm9uXCIsICgpID0+IHtcbiAgICAgICAgdGVzdFRyaWdnZXJzKFwib25cIik7XG5cbiAgICAgICAgaXQoXCJpbnZva2VzIGFsbCBsaXN0ZW5lcnNcIiwgKGRvbmU6IE1vY2hhRG9uZSkgPT4ge1xuICAgICAgICAgICAgbGV0IGV2ZW50ID0gbmV3IEV2ZW50UHJvcGVydHkuVm9pZCgpO1xuICAgICAgICAgICAgbGV0IHJlc29sdmUxOiAoKSA9PiB2b2lkID0gbnVsbDtcbiAgICAgICAgICAgIGxldCByZXNvbHZlMjogKCkgPT4gdm9pZCA9IG51bGw7XG4gICAgICAgICAgICBsZXQgcHJvbWlzZTE6IFByb21pc2U8YW55PiA9IG5ldyBQcm9taXNlPGFueT4oKHJlc29sdmUpID0+IHsgcmVzb2x2ZTEgPSByZXNvbHZlOyB9KTtcbiAgICAgICAgICAgIGxldCBwcm9taXNlMjogUHJvbWlzZTxhbnk+ID0gbmV3IFByb21pc2U8YW55PigocmVzb2x2ZSkgPT4geyByZXNvbHZlMiA9IHJlc29sdmU7IH0pO1xuICAgICAgICAgICAgZXZlbnQub24ocmVzb2x2ZTEpO1xuICAgICAgICAgICAgZXZlbnQub24ocmVzb2x2ZTIpO1xuICAgICAgICAgICAgUHJvbWlzZS5hbGwoW3Byb21pc2UxLCBwcm9taXNlMl0pLnRoZW4oZnVuY3Rpb24oKXsgZG9uZSgpOyB9KS5jYXRjaChkb25lKTtcbiAgICAgICAgICAgIGV2ZW50LmVtaXQoKTtcbiAgICAgICAgfSk7XG4gICAgICAgIGl0KFwiaW52b2tlcyBsaXN0ZW5lcnMgb24gZWFjaCBlbWl0XCIsIChkb25lOiBNb2NoYURvbmUpID0+IHtcbiAgICAgICAgICAgIGxldCBldmVudCA9IG5ldyBFdmVudFByb3BlcnR5LlZvaWQoKTtcbiAgICAgICAgICAgIGxldCBuRXhwZWN0ZWQgPSA1O1xuICAgICAgICAgICAgbGV0IG5SZWdpc3RlcmVkID0gMDtcbiAgICAgICAgICAgIGV2ZW50Lm9uKCgpID0+IHtcbiAgICAgICAgICAgICAgICBuUmVnaXN0ZXJlZCsrO1xuICAgICAgICAgICAgICAgIGlmIChuUmVnaXN0ZXJlZCA9PT0gbkV4cGVjdGVkKSBkb25lKCk7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgbkV4cGVjdGVkOyBpKyspIGV2ZW50LmVtaXQoKTtcbiAgICAgICAgfSk7XG4gICAgfSk7XG5cbiAgICBkZXNjcmliZShcIm9mZlwiLCAoKSA9PiB7XG4gICAgICAgIGl0KFwiYnkgaGFuZGxlclwiLCAoKSA9PiB7XG4gICAgICAgICAgICBsZXQgZXZlbnQgPSBuZXcgRXZlbnRQcm9wZXJ0eS5Wb2lkKCk7XG4gICAgICAgICAgICBsZXQgaGFuZGxlciA9ICgpID0+IHtcbiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXCJTaG91bGQgbm90IGJlIGludm9rZWRcIik7XG4gICAgICAgICAgICB9O1xuXG4gICAgICAgICAgICBldmVudC5vbihoYW5kbGVyKTtcbiAgICAgICAgICAgIGV2ZW50Lm9mZihoYW5kbGVyKTtcblxuICAgICAgICAgICAgZXZlbnQuZW1pdCgpO1xuICAgICAgICB9KTtcbiAgICAgICAgaXQoXCJieSBpZFwiLCAoKSA9PiB7XG4gICAgICAgICAgICBsZXQgZXZlbnQgPSBuZXcgRXZlbnRQcm9wZXJ0eS5Wb2lkKCk7XG4gICAgICAgICAgICBsZXQgaGFuZGxlciA9ICgpID0+IHtcbiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXCJTaG91bGQgbm90IGJlIGludm9rZWRcIik7XG4gICAgICAgICAgICB9O1xuXG4gICAgICAgICAgICBsZXQgaWQgPSBldmVudC5vbihoYW5kbGVyKTtcbiAgICAgICAgICAgIGV2ZW50Lm9mZihpZCk7XG5cbiAgICAgICAgICAgIGV2ZW50LmVtaXQoKTtcbiAgICAgICAgfSk7XG4gICAgICAgIGl0KFwiYnkgY29udGV4dFwiLCAoZG9uZTogTW9jaGFEb25lKSA9PiB7XG4gICAgICAgICAgICBsZXQgZXZlbnQgPSBuZXcgRXZlbnRQcm9wZXJ0eS5Wb2lkKCk7XG4gICAgICAgICAgICBsZXQgY29udGV4dCA9IHt9O1xuICAgICAgICAgICAgbGV0IGhhbmRsZXIgPSBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICBpZiAodGhpcyA9PT0gY29udGV4dClcbiAgICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKFwiU2hvdWxkIG5vdCBiZSBpbnZva2VkXCIpO1xuICAgICAgICAgICAgICAgIGVsc2VcbiAgICAgICAgICAgICAgICAgICAgZG9uZSgpO1xuICAgICAgICAgICAgfTtcbiAgICAgICAgICAgIC8vIE9mZiBieSBjb250ZXh0IHNob3VsZCByZW1vdmUgYWxsIGhhbmRsZXJzIHdpdGggdGhlXG4gICAgICAgICAgICAvLyBjb250ZXh0IGJ1dCBzaG91bGQgbm90IGFmZmVjdCB0aGUgaGFuZGxlcnMgcGFzc2VkIHdpdGhvdXQgY29udGV4dFxuXG4gICAgICAgICAgICBldmVudC5vbihoYW5kbGVyLCBjb250ZXh0KTtcbiAgICAgICAgICAgIGV2ZW50Lm9uKGhhbmRsZXIsIGNvbnRleHQpO1xuICAgICAgICAgICAgZXZlbnQub24oaGFuZGxlcik7XG4gICAgICAgICAgICBldmVudC5vZmYoY29udGV4dCk7XG5cbiAgICAgICAgICAgIGV2ZW50LmVtaXQoKTtcbiAgICAgICAgfSk7XG4gICAgICAgIGl0KFwiY2xlYXJzXCIsIChkb25lOiBNb2NoYURvbmUpID0+IHtcbiAgICAgICAgICAgIGxldCBldmVudCA9IG5ldyBFdmVudFByb3BlcnR5LlZvaWQoKTtcbiAgICAgICAgICAgIGxldCBoYW5kbGVyID0gZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgaWYgKHRoaXMgPT09IGNvbnRleHQpXG4gICAgICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihcIlNob3VsZCBub3QgYmUgaW52b2tlZFwiKTtcbiAgICAgICAgICAgICAgICBlbHNlXG4gICAgICAgICAgICAgICAgICAgIGRvbmUoKTtcbiAgICAgICAgICAgIH07XG4gICAgICAgICAgICAvLyBPZmYgYnkgY29udGV4dCBzaG91bGQgcmVtb3ZlIGFsbCBoYW5kbGVycyB3aXRoIHRoZVxuICAgICAgICAgICAgLy8gY29udGV4dCBidXQgc2hvdWxkIG5vdCBhZmZlY3QgdGhlIGhhbmRsZXJzIHBhc3NlZCB3aXRob3V0IGNvbnRleHRcbiAgICAgICAgICAgIGV2ZW50Lm9uKGhhbmRsZXIpO1xuICAgICAgICAgICAgZXZlbnQub24oaGFuZGxlcik7XG4gICAgICAgICAgICBldmVudC5vZmYoKTtcbiAgICAgICAgICAgIHNldFRpbWVvdXQoZG9uZSwgMTApO1xuXG4gICAgICAgICAgICBldmVudC5lbWl0KCk7XG4gICAgICAgIH0pO1xuICAgIH0pO1xuXG4gICAgZGVzY3JpYmUoXCJvbmNlXCIsICgpID0+IHtcbiAgICAgICAgdGVzdFRyaWdnZXJzKFwib25jZVwiKTtcblxuICAgICAgICBpdChcInRyaWdnZXJzIG9uY2VcIiwgKCkgPT4ge1xuICAgICAgICAgICAgbGV0IGV2ZW50ID0gbmV3IEV2ZW50UHJvcGVydHkuVm9pZCgpO1xuICAgICAgICAgICAgbGV0IGlzRmlyc3QgPSB0cnVlO1xuICAgICAgICAgICAgZXZlbnQub25jZShmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgY2hhaS5hc3NlcnQoaXNGaXJzdCk7XG4gICAgICAgICAgICAgICAgaXNGaXJzdCA9IGZhbHNlO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICBldmVudC5lbWl0KCk7XG4gICAgICAgICAgICBldmVudC5lbWl0KCk7XG4gICAgICAgIH0pO1xuICAgIH0pO1xuICAgIGRlc2NyaWJlKFwibWF0Y2hcIiwgKCkgPT4ge1xuICAgICAgICB0ZXN0TWF0Y2hUcmlnZ2VycyhcIm1hdGNoXCIpO1xuXG4gICAgICAgIGl0KFwibWF0Y2hlcyBvYmplY3QgcGFydFwiLCAoZG9uZTogTW9jaGFEb25lKSA9PiB7XG4gICAgICAgICAgICBsZXQgZXZlbnQgPSBuZXcgRXZlbnRQcm9wZXJ0eTxhbnk+KCk7XG4gICAgICAgICAgICBldmVudC5tYXRjaCh7IGE6IDEsIGI6IDIgfSwgZnVuY3Rpb24gKCkgeyBkb25lKCk7IH0pO1xuICAgICAgICAgICAgZXZlbnQuZW1pdCh7IGE6IDEsIGI6IDIsIGM6IDMsIGQ6IFwieFwifSk7XG4gICAgICAgIH0pO1xuICAgICAgICBpdChcIm1hdGNoZXMgZGVlcGVyXCIsIChkb25lOiBNb2NoYURvbmUpID0+IHtcbiAgICAgICAgICAgIGxldCBldmVudCA9IG5ldyBFdmVudFByb3BlcnR5PGFueT4oKTtcbiAgICAgICAgICAgIGV2ZW50Lm1hdGNoKHsgYToge3ggOiBcInlcIn0sIGM6IFsxLCAyXSB9LCBmdW5jdGlvbiAoKSB7IGRvbmUoKTsgfSk7XG4gICAgICAgICAgICBldmVudC5lbWl0KHsgYToge3ggOiBcInlcIiwgejoge3I6IDF9fSwgYzogWzEsIDIsIHsgeDogXCI/XCJ9LCBudWxsXSB9KTtcbiAgICAgICAgfSk7XG4gICAgICAgIGl0KFwibWF0Y2hlcyByZWdleHBcIiwgKGRvbmU6IE1vY2hhRG9uZSkgPT4ge1xuICAgICAgICAgICAgbGV0IGV2ZW50ID0gbmV3IEV2ZW50UHJvcGVydHk8YW55PigpO1xuICAgICAgICAgICAgZXZlbnQubWF0Y2goL3Rlc3RbMTIzXSt4LywgZnVuY3Rpb24gKCkgeyBkb25lKCk7IH0pO1xuICAgICAgICAgICAgZXZlbnQuZW1pdChcInRlc3QtdGVzdDJ4c1wiKTtcbiAgICAgICAgfSk7XG4gICAgfSk7XG4gICAgZGVzY3JpYmUoXCJtYXRjaE9uY2VcIiwgKCkgPT4ge1xuICAgICAgICB0ZXN0TWF0Y2hUcmlnZ2VycyhcIm1hdGNoT25jZVwiKTtcblxuICAgICAgICBpdChcIm1hdGNoZXMgb25jZVwiLCAoKSA9PiB7XG4gICAgICAgICAgICBsZXQgZXZlbnQgPSBuZXcgRXZlbnRQcm9wZXJ0eTxzdHJpbmc+KCk7XG4gICAgICAgICAgICBsZXQgaXNGaXJzdCA9IHRydWU7XG4gICAgICAgICAgICBldmVudC5tYXRjaE9uY2UoXCJtYXRjaFwiLCBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgY2hhaS5hc3NlcnQoaXNGaXJzdCk7XG4gICAgICAgICAgICAgICAgaXNGaXJzdCA9IGZhbHNlO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICBldmVudC5lbWl0KFwibWF0Y2hcIik7XG4gICAgICAgICAgICBldmVudC5lbWl0KFwibWF0Y2hcIik7XG4gICAgICAgICAgICBldmVudC5lbWl0KFwidW5tYXRjaFwiKTtcbiAgICAgICAgfSk7XG4gICAgfSk7XG4gICAgZGVzY3JpYmUoXCJwaXBlXCIsICgpID0+IHtcbiAgICAgICAgaXQoXCJwYXNzZXMgYXJndW1lbnQsIGdldCBsaXN0ZW5lcklkXCIsIChkb25lOiBNb2NoYURvbmUpID0+IHtcbiAgICAgICAgICAgIGxldCBldmVudEZyb20gPSBuZXcgRXZlbnRQcm9wZXJ0eTxzdHJpbmc+KCk7XG4gICAgICAgICAgICBsZXQgZXZlbnRUbyA9IG5ldyBFdmVudFByb3BlcnR5PHN0cmluZz4oKTtcbiAgICAgICAgICAgIGxldCB0ZXN0QXJnID0gXCJ0ZXN0XCI7XG4gICAgICAgICAgICBldmVudFRvLm9uKGZ1bmN0aW9uIChhcmc6IHN0cmluZykge1xuICAgICAgICAgICAgICAgIGV4cGVjdChhcmcpLnRvLmVxdWFsKHRlc3RBcmcpO1xuICAgICAgICAgICAgICAgIGRvbmUoKTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgbGV0IGlkID0gZXZlbnRGcm9tLnBpcGUoZXZlbnRUbyk7XG4gICAgICAgICAgICBleHBlY3QodHlwZW9mIGlkKS50by5lcXVhbChcIm51bWJlclwiKTtcbiAgICAgICAgICAgIGV2ZW50RnJvbS5lbWl0KHRlc3RBcmcpO1xuICAgICAgICB9KTtcbiAgICAgICAgaXQoXCJvZmZzIHdpdGggaWRcIiwgKCkgPT4ge1xuICAgICAgICAgICAgbGV0IGV2ZW50RnJvbSA9IG5ldyBFdmVudFByb3BlcnR5LlZvaWQoKTtcbiAgICAgICAgICAgIGxldCBldmVudFRvID0gbmV3IEV2ZW50UHJvcGVydHkuVm9pZCgpO1xuXG4gICAgICAgICAgICBldmVudFRvLm9uKGZ1bmN0aW9uICgpIHsgdGhyb3cgbmV3IEVycm9yKFwiU2hvdWxkIG5vdCBoYXBwZW5cIik7IH0pO1xuICAgICAgICAgICAgbGV0IGlkID0gZXZlbnRGcm9tLnBpcGUoZXZlbnRUbyk7XG4gICAgICAgICAgICBldmVudEZyb20ub2ZmKGlkKTtcbiAgICAgICAgICAgIGV2ZW50RnJvbS5lbWl0KCk7XG4gICAgICAgIH0pO1xuICAgICAgICBpdChcIm9mZnMgd2l0aCBldmVudFwiLCAoKSA9PiB7XG4gICAgICAgICAgICBsZXQgZXZlbnRGcm9tID0gbmV3IEV2ZW50UHJvcGVydHkuVm9pZCgpO1xuICAgICAgICAgICAgbGV0IGV2ZW50VG8gPSBuZXcgRXZlbnRQcm9wZXJ0eS5Wb2lkKCk7XG5cbiAgICAgICAgICAgIGV2ZW50VG8ub24oZnVuY3Rpb24gKCkgeyB0aHJvdyBuZXcgRXJyb3IoXCJTaG91bGQgbm90IGhhcHBlblwiKTsgfSk7XG4gICAgICAgICAgICBldmVudEZyb20ucGlwZShldmVudFRvKTtcbiAgICAgICAgICAgIGV2ZW50RnJvbS5vZmYoZXZlbnRUbyk7XG4gICAgICAgICAgICBldmVudEZyb20uZW1pdCgpO1xuICAgICAgICB9KTtcbiAgICB9KTtcbiAgICBkZXNjcmliZShcInJvdXRlXCIsICgpID0+IHtcbiAgICAgICAgaXQoXCJzdHJpbmdcIiwgKCkgPT4ge1xuICAgICAgICAgICAgbGV0IGV2ZW50RnJvbSA9IG5ldyBFdmVudFByb3BlcnR5PHN0cmluZz4oKTtcbiAgICAgICAgICAgIGxldCBldmVudFRvID0gbmV3IEV2ZW50UHJvcGVydHk8c3RyaW5nPigpO1xuXG4gICAgICAgICAgICBldmVudFRvLm9uKGZ1bmN0aW9uIChhcmc6IHN0cmluZykge1xuICAgICAgICAgICAgICAgIGV4cGVjdChhcmcpLnRvLmVxdWFsKFwidGVzdFwiKTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgbGV0IGlkID0gZXZlbnRGcm9tLnJvdXRlKFwidGVzdFwiLCBldmVudFRvKTtcbiAgICAgICAgICAgIGV4cGVjdCh0eXBlb2YgaWQpLnRvLmVxdWFsKFwibnVtYmVyXCIpO1xuICAgICAgICAgICAgZXZlbnRGcm9tLmVtaXQoXCJ0ZXN0XCIpO1xuICAgICAgICAgICAgZXZlbnRGcm9tLmVtaXQoXCJyYW5kb21cIik7XG4gICAgICAgICAgICBldmVudEZyb20uZW1pdChcImFueVwiKTtcbiAgICAgICAgfSk7XG4gICAgICAgIGl0KFwicmVnZXhwXCIsICgpID0+IHtcbiAgICAgICAgICAgIGxldCBldmVudEZyb20gPSBuZXcgRXZlbnRQcm9wZXJ0eTxzdHJpbmc+KCk7XG4gICAgICAgICAgICBsZXQgZXZlbnRUbyA9IG5ldyBFdmVudFByb3BlcnR5PHN0cmluZz4oKTtcbiAgICAgICAgICAgIGxldCBwYXNzID0gMTtcblxuICAgICAgICAgICAgZXZlbnRUby5vbihmdW5jdGlvbiAoYXJnOiBzdHJpbmcpIHtcbiAgICAgICAgICAgICAgICBjaGFpLmFzc2VydCgvXlxcL1thLXpBLVpdKi8udGVzdChhcmcpKTtcbiAgICAgICAgICAgICAgICBjaGFpLmFzc2VydCghLS1wYXNzKTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgbGV0IGlkID0gZXZlbnRGcm9tLnJvdXRlKC9eXFwvW2EtekEtWl0rLywgZXZlbnRUbyk7XG4gICAgICAgICAgICBleHBlY3QodHlwZW9mIGlkKS50by5lcXVhbChcIm51bWJlclwiKTtcbiAgICAgICAgICAgIGV2ZW50RnJvbS5lbWl0KFwiL3Jvb3RcIik7XG4gICAgICAgICAgICBldmVudEZyb20uZW1pdChcInJhbmRvbVwiKTtcbiAgICAgICAgICAgIGV2ZW50RnJvbS5lbWl0KFwiLzM0L1wiKTtcbiAgICAgICAgfSk7XG4gICAgfSk7XG4gICAgZGVzY3JpYmUoXCJmaXJzdFwiLCAoKSA9PiB7XG4gICAgICAgIGl0KFwicmVzb2x2ZXMgd2l0aCB2YWx1ZVwiLCAoZG9uZTogTW9jaGFEb25lKSA9PiB7XG4gICAgICAgICAgICBsZXQgZXZlbnQgPSBuZXcgRXZlbnRQcm9wZXJ0eTxzdHJpbmc+KCk7XG4gICAgICAgICAgICBsZXQgdGVzdEFyZzogc3RyaW5nID0gXCJ0ZXN0XCI7XG4gICAgICAgICAgICBldmVudC5maXJzdC50aGVuKChhcmc6IHN0cmluZykgPT4ge1xuICAgICAgICAgICAgICAgIGV4cGVjdChhcmcpLnRvLmVxdWFsKHRlc3RBcmcpO1xuICAgICAgICAgICAgICAgIGRvbmUoKTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgZXZlbnQuZW1pdCh0ZXN0QXJnKTtcbiAgICAgICAgfSk7XG5cbiAgICAgICAgaXQoXCJjYW4gYmUgY2F1Z2h0IGFmdGVyIGVtaXRcIiwgKGRvbmU6IE1vY2hhRG9uZSkgPT4ge1xuICAgICAgICAgICAgbGV0IGV2ZW50ID0gbmV3IEV2ZW50UHJvcGVydHkuVm9pZCgpO1xuICAgICAgICAgICAgZXZlbnQuZW1pdCgpO1xuICAgICAgICAgICAgZXZlbnQuZmlyc3QudGhlbigoKSA9PiB7XG4gICAgICAgICAgICAgICAgZG9uZSgpO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgIH0pO1xuICAgIH0pO1xuICAgIGRlc2NyaWJlKFwibmV4dFwiLCAoKSA9PiB7XG4gICAgICAgIGl0KFwicmVzb2x2ZXMgd2l0aCB2YWx1ZVwiLCAoZG9uZTogTW9jaGFEb25lKSA9PiB7XG4gICAgICAgICAgICBsZXQgZXZlbnQgPSBuZXcgRXZlbnRQcm9wZXJ0eTxzdHJpbmc+KCk7XG4gICAgICAgICAgICBsZXQgdGVzdEFyZzogc3RyaW5nID0gXCJ0ZXN0XCI7XG4gICAgICAgICAgICBldmVudC5uZXh0KCkudGhlbigoYXJnOiBzdHJpbmcpID0+IHtcbiAgICAgICAgICAgICAgICBleHBlY3QoYXJnKS50by5lcXVhbCh0ZXN0QXJnKTtcbiAgICAgICAgICAgICAgICBkb25lKCk7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIGV2ZW50LmVtaXQodGVzdEFyZyk7XG4gICAgICAgIH0pO1xuICAgICAgICBpdChcImNyZWF0ZXMgbmV3IHByb21pc2VzXCIsIChkb25lOiBNb2NoYURvbmUpID0+IHtcbiAgICAgICAgICAgIGxldCBldmVudCA9IG5ldyBFdmVudFByb3BlcnR5PHN0cmluZz4oKTtcbiAgICAgICAgICAgIGxldCB0ZXN0QXJnMTogc3RyaW5nID0gXCJ0ZXN0MVwiO1xuICAgICAgICAgICAgbGV0IHRlc3RBcmcyOiBzdHJpbmcgPSBcInRlc3QyXCI7XG4gICAgICAgICAgICBldmVudC5uZXh0KCkudGhlbigoYXJnOiBzdHJpbmcpID0+IHtcbiAgICAgICAgICAgICAgICBleHBlY3QoYXJnKS50by5lcXVhbCh0ZXN0QXJnMSk7XG4gICAgICAgICAgICAgICAgZXZlbnQubmV4dCgpLnRoZW4oKGFyZzogc3RyaW5nKSA9PiB7XG4gICAgICAgICAgICAgICAgICAgIGV4cGVjdChhcmcpLnRvLmVxdWFsKHRlc3RBcmcyKTtcbiAgICAgICAgICAgICAgICAgICAgZXZlbnQubmV4dCgpLnRoZW4oKGFyZzogc3RyaW5nKSA9PiB7XG4gICAgICAgICAgICAgICAgICAgICAgICBleHBlY3QoYXJnKS50by5lcXVhbCh0ZXN0QXJnMSk7XG4gICAgICAgICAgICAgICAgICAgICAgICBkb25lKCk7XG4gICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICAgICBldmVudC5lbWl0KHRlc3RBcmcxKTtcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICBldmVudC5lbWl0KHRlc3RBcmcyKTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgZXZlbnQuZW1pdCh0ZXN0QXJnMSk7XG4gICAgICAgIH0pO1xuICAgIH0pO1xuICAgIGl0KFwiRXZlbnRQcm9wZXJ0eS5tYWtlXCIsIChkb25lOiBNb2NoYURvbmUpID0+IHtcbiAgICAgICAgY2xhc3MgVGVzdCB7XG4gICAgICAgICAgICBwcml2YXRlIGV2ZW50OiBFdmVudFByb3BlcnR5PHN0cmluZz47XG4gICAgICAgICAgICBwdWJsaWMgZW1pdHRlcjogRXZlbnRQcm9wZXJ0eS5FbWl0dGVyPHN0cmluZz47XG4gICAgICAgICAgICBjb25zdHJ1Y3RvcigpIHtcbiAgICAgICAgICAgICAgICBbdGhpcy5ldmVudCwgdGhpcy5lbWl0dGVyXSA9IEV2ZW50UHJvcGVydHkubWFrZTxzdHJpbmc+KCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICB0ZXN0KCkge1xuICAgICAgICAgICAgICAgIHRoaXMuZXZlbnQuZW1pdChcInRlc3RcIik7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgbGV0IGluc3RhbmNlID0gbmV3IFRlc3QoKTtcbiAgICAgICAgaW5zdGFuY2UuZW1pdHRlci5vbigoKSA9PiBkb25lKCkpO1xuICAgICAgICBpbnN0YW5jZS50ZXN0KCk7XG4gICAgfSk7XG59KTtcblxuXG5mdW5jdGlvbiB0ZXN0VHJpZ2dlcnMobWV0aG9kOiBzdHJpbmcpIHtcbiAgICBpdChcInJldHVybnMgbGlzdGVuZXJJZFwiLCAoKSA9PiB7XG4gICAgICAgIGxldCBldmVudCA9IG5ldyBFdmVudFByb3BlcnR5PHZvaWQ+KCk7XG4gICAgICAgIGxldCBpZCA9IGV2ZW50W21ldGhvZF0oKCkgPT4ge30pO1xuICAgICAgICBleHBlY3QodHlwZW9mIGlkKS50by5lcXVhbChcIm51bWJlclwiKTtcbiAgICB9KTtcbiAgICBpdChcInRyaWdnZXJzXCIsIChkb25lOiBNb2NoYURvbmUpID0+IHtcbiAgICAgICAgbGV0IGV2ZW50ID0gbmV3IEV2ZW50UHJvcGVydHkuVm9pZCgpO1xuICAgICAgICBldmVudFttZXRob2RdKGRvbmUpO1xuICAgICAgICBldmVudC5lbWl0KCk7XG4gICAgfSk7XG4gICAgaXQoXCJwYXNzZXMgYXJndW1lbnRcIiwgKGRvbmU6IE1vY2hhRG9uZSkgPT4ge1xuICAgICAgICBsZXQgdGVzdEFyZyA9IFwidGVzdFwiO1xuICAgICAgICBsZXQgZXZlbnQgPSBuZXcgRXZlbnRQcm9wZXJ0eTxzdHJpbmc+KCk7XG4gICAgICAgIGV2ZW50W21ldGhvZF0oKGFyZzogc3RyaW5nKSA9PiB7XG4gICAgICAgICAgICBleHBlY3QoYXJnKS50by5iZS5lcXVhbCh0ZXN0QXJnKTtcbiAgICAgICAgICAgIGRvbmUoKTtcbiAgICAgICAgfSk7XG4gICAgICAgIGV2ZW50LmVtaXQodGVzdEFyZyk7XG4gICAgfSk7XG4gICAgaXQoXCJwYXNzZXMgY29udGV4dFwiLCAoZG9uZTogTW9jaGFEb25lKSA9PiB7XG4gICAgICAgIGxldCBldmVudCA9IG5ldyBFdmVudFByb3BlcnR5LlZvaWQoKTtcbiAgICAgICAgbGV0IGxpc3RlbmVyOiB7XG4gICAgICAgICAgICBpdElzTGlzdGVuZXI6IGJvb2xlYW47XG4gICAgICAgICAgICBmbjogKCkgPT4gdm9pZDtcbiAgICAgICAgfTtcbiAgICAgICAgbGlzdGVuZXIgID0ge1xuICAgICAgICAgICAgaXRJc0xpc3RlbmVyOiB0cnVlLFxuICAgICAgICAgICAgZm4oKSB7XG4gICAgICAgICAgICAgICAgY2hhaS5leHBlY3QodGhpcykudG8uYmUuZXF1YWwobGlzdGVuZXIpO1xuICAgICAgICAgICAgICAgIGRvbmUoKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfTtcbiAgICAgICAgZXZlbnRbbWV0aG9kXShsaXN0ZW5lci5mbiwgbGlzdGVuZXIpO1xuICAgICAgICBldmVudC5lbWl0KCk7XG4gICAgfSk7XG59XG5cbmZ1bmN0aW9uIHRlc3RNYXRjaFRyaWdnZXJzKG1ldGhvZDogc3RyaW5nKSB7XG4gICAgbGV0IG1hdGNoID0gXCJ0ZXN0TWF0Y2hWYWx1ZVwiO1xuICAgIGl0KFwicmV0dXJucyBsaXN0ZW5lcklkXCIsICgpID0+IHtcbiAgICAgICAgbGV0IGV2ZW50ID0gbmV3IEV2ZW50UHJvcGVydHk8c3RyaW5nPigpO1xuICAgICAgICBsZXQgaWQgPSBldmVudFttZXRob2RdKG1hdGNoLCAoKSA9PiB7fSk7XG4gICAgICAgIGV4cGVjdCh0eXBlb2YgaWQpLnRvLmVxdWFsKFwibnVtYmVyXCIpO1xuICAgIH0pO1xuICAgIGl0KFwidHJpZ2dlcnNcIiwgKGRvbmU6IE1vY2hhRG9uZSkgPT4ge1xuICAgICAgICBsZXQgZXZlbnQgPSBuZXcgRXZlbnRQcm9wZXJ0eTxzdHJpbmc+KCk7XG4gICAgICAgIGV2ZW50W21ldGhvZF0obWF0Y2gsIGZ1bmN0aW9uICgpIHsgZG9uZSgpOyB9KTtcbiAgICAgICAgZXZlbnQuZW1pdChtYXRjaCk7XG4gICAgfSk7XG4gICAgaXQoXCJwYXNzZXMgYXJndW1lbnRcIiwgKGRvbmU6IE1vY2hhRG9uZSkgPT4ge1xuICAgICAgICBsZXQgdGVzdEFyZyA9IFwidGVzdFwiO1xuICAgICAgICBsZXQgZXZlbnQgPSBuZXcgRXZlbnRQcm9wZXJ0eTxzdHJpbmc+KCk7XG4gICAgICAgIGV2ZW50W21ldGhvZF0odGVzdEFyZywgKGFyZzogc3RyaW5nKSA9PiB7XG4gICAgICAgICAgICBleHBlY3QoYXJnKS50by5iZS5lcXVhbCh0ZXN0QXJnKTtcbiAgICAgICAgICAgIGRvbmUoKTtcbiAgICAgICAgfSk7XG4gICAgICAgIGV2ZW50LmVtaXQodGVzdEFyZyk7XG4gICAgfSk7XG4gICAgaXQoXCJwYXNzZXMgY29udGV4dFwiLCAoZG9uZTogTW9jaGFEb25lKSA9PiB7XG4gICAgICAgIGxldCBldmVudCA9IG5ldyBFdmVudFByb3BlcnR5PHN0cmluZz4oKTtcbiAgICAgICAgbGV0IGxpc3RlbmVyOiB7XG4gICAgICAgICAgICBpdElzTGlzdGVuZXI6IGJvb2xlYW47XG4gICAgICAgICAgICBmbjogKCkgPT4gdm9pZDtcbiAgICAgICAgfTtcbiAgICAgICAgbGlzdGVuZXIgID0ge1xuICAgICAgICAgICAgaXRJc0xpc3RlbmVyOiB0cnVlLFxuICAgICAgICAgICAgZm4oKSB7XG4gICAgICAgICAgICAgICAgY2hhaS5leHBlY3QodGhpcykudG8uYmUuZXF1YWwobGlzdGVuZXIpO1xuICAgICAgICAgICAgICAgIGRvbmUoKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfTtcbiAgICAgICAgZXZlbnRbbWV0aG9kXShtYXRjaCwgbGlzdGVuZXIuZm4sIGxpc3RlbmVyKTtcbiAgICAgICAgZXZlbnQuZW1pdChtYXRjaCk7XG4gICAgfSk7XG4gICAgaXQoXCJpZ25vcmVzIGlycmVsZXZhbnQgZW1pdHNcIiwgKCkgPT4ge1xuICAgICAgICBsZXQgZXZlbnQgPSBuZXcgRXZlbnRQcm9wZXJ0eTxzdHJpbmc+KCk7XG4gICAgICAgIGV2ZW50W21ldGhvZF0obWF0Y2gsIGZ1bmN0aW9uICgpIHsgdGhyb3cgbmV3IEVycm9yKFwiTXVzdCBub3QgYmUgaW52b2tlZFwiKTsgfSk7XG4gICAgICAgIGV2ZW50LmVtaXQoXCJcIik7XG4gICAgICAgIGV2ZW50LmVtaXQoXCJhYmNcIik7XG4gICAgICAgIGV2ZW50LmVtaXQobnVsbCk7XG4gICAgfSk7XG59Il19