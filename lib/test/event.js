/// <reference path="../../typings/index.d.ts"/>
Object.defineProperty(exports, "__esModule", { value: true });
const chai = require("chai");
const event_1 = require("../event");
let expect = chai.expect;
function testTriggers(method) {
    it("returns listenerId", () => {
        let event = new event_1.EventProperty();
        let id = event[method](() => { });
        expect(typeof id).to.equal("number");
    });
    it("triggers", (done) => {
        let event = new event_1.EventProperty.Void();
        event[method](done);
        event.emit();
    });
    it("passes argument", (done) => {
        let testArg = "test";
        let event = new event_1.EventProperty();
        event[method]((arg) => {
            expect(arg).to.be.equal(testArg);
            done();
        });
        event.emit(testArg);
    });
    it("passes context", (done) => {
        let event = new event_1.EventProperty.Void();
        let listener;
        listener = {
            itIsListener: true,
            fn() {
                chai.expect(this).to.be.equal(listener);
                done();
            }
        };
        event[method](listener.fn, listener);
        event.emit();
    });
}
function testMatchTriggers(method) {
    let match = "testMatchValue";
    it("returns listenerId", () => {
        let event = new event_1.EventProperty();
        let id = event[method](match, () => { });
        expect(typeof id).to.equal("number");
    });
    it("triggers", (done) => {
        let event = new event_1.EventProperty();
        event[method](match, function () { done(); });
        event.emit(match);
    });
    it("passes argument", (done) => {
        let testArg = "test";
        let event = new event_1.EventProperty();
        event[method](testArg, (arg) => {
            expect(arg).to.be.equal(testArg);
            done();
        });
        event.emit(testArg);
    });
    it("passes context", (done) => {
        let event = new event_1.EventProperty();
        let listener;
        listener = {
            itIsListener: true,
            fn() {
                chai.expect(this).to.be.equal(listener);
                done();
            }
        };
        event[method](match, listener.fn, listener);
        event.emit(match);
    });
    it("ignores irrelevant emits", () => {
        let event = new event_1.EventProperty();
        event[method](match, function () { throw new Error("Must not be invoked"); });
        event.emit("");
        event.emit("abc");
        event.emit(null);
    });
}
describe("EventProperty", () => {
    it("constructor", () => {
        new event_1.EventProperty();
    });
    describe("on", () => {
        testTriggers("on");
        it("invokes all listeners", (done) => {
            let event = new event_1.EventProperty.Void();
            let resolve1 = null;
            let resolve2 = null;
            let promise1 = new Promise((resolve) => { resolve1 = resolve; });
            let promise2 = new Promise((resolve) => { resolve2 = resolve; });
            event.on(resolve1);
            event.on(resolve2);
            Promise.all([promise1, promise2]).then(function () { done(); }).catch(done);
            event.emit();
        });
        it("invokes listeners on each emit", (done) => {
            let event = new event_1.EventProperty.Void();
            let nExpected = 5;
            let nRegistered = 0;
            event.on(() => {
                nRegistered++;
                if (nRegistered === nExpected)
                    done();
            });
            for (let i = 0; i < nExpected; i++)
                event.emit();
        });
    });
    describe("off", () => {
        it("by handler", () => {
            let event = new event_1.EventProperty.Void();
            let handler = () => {
                throw new Error("Should not be invoked");
            };
            event.on(handler);
            event.off(handler);
            event.emit();
        });
        it("by id", () => {
            let event = new event_1.EventProperty.Void();
            let handler = () => {
                throw new Error("Should not be invoked");
            };
            let id = event.on(handler);
            event.off(id);
            event.emit();
        });
        it("by context", (done) => {
            let event = new event_1.EventProperty.Void();
            let context = {};
            let handler = function () {
                if (this === context)
                    throw new Error("Should not be invoked");
                else
                    done();
            };
            // Off by context should remove all handlers with the
            // context but should not affect the handlers passed without context
            event.on(handler, context);
            event.on(handler, context);
            event.on(handler);
            event.off(context);
            event.emit();
        });
        it("clears", (done) => {
            let event = new event_1.EventProperty.Void();
            let handler = function () {
                if (this === context)
                    throw new Error("Should not be invoked");
                else
                    done();
            };
            // Off by context should remove all handlers with the
            // context but should not affect the handlers passed without context
            event.on(handler);
            event.on(handler);
            event.off();
            setTimeout(done, 10);
            event.emit();
        });
    });
    describe("once", () => {
        testTriggers("once");
        it("triggers once", () => {
            let event = new event_1.EventProperty.Void();
            let isFirst = true;
            event.once(function () {
                chai.assert(isFirst);
                isFirst = false;
            });
            event.emit();
            event.emit();
        });
    });
    describe("match", () => {
        testMatchTriggers("match");
        it("matches object part", (done) => {
            let event = new event_1.EventProperty();
            event.match({ a: 1, b: 2 }, function () { done(); });
            event.emit({ a: 1, b: 2, c: 3, d: "x" });
        });
        it("matches deeper", (done) => {
            let event = new event_1.EventProperty();
            event.match({ a: { x: "y" }, c: [1, 2] }, function () { done(); });
            event.emit({ a: { x: "y", z: { r: 1 } }, c: [1, 2, { x: "?" }, null] });
        });
        it("matches regexp", (done) => {
            let event = new event_1.EventProperty();
            event.match(/test[123]+x/, function () { done(); });
            event.emit("test-test2xs");
        });
    });
    describe("matchOnce", () => {
        testMatchTriggers("matchOnce");
        it("matches once", () => {
            let event = new event_1.EventProperty();
            let isFirst = true;
            event.matchOnce("match", function () {
                chai.assert(isFirst);
                isFirst = false;
            });
            event.emit("match");
            event.emit("match");
            event.emit("unmatch");
        });
    });
    describe("pipe", () => {
        it("passes argument, get listenerId", (done) => {
            let eventFrom = new event_1.EventProperty();
            let eventTo = new event_1.EventProperty();
            let testArg = "test";
            eventTo.on(function (arg) {
                expect(arg).to.equal(testArg);
                done();
            });
            let id = eventFrom.pipe(eventTo);
            expect(typeof id).to.equal("number");
            eventFrom.emit(testArg);
        });
        it("offs with id", () => {
            let eventFrom = new event_1.EventProperty.Void();
            let eventTo = new event_1.EventProperty.Void();
            eventTo.on(function () { throw new Error("Should not happen"); });
            let id = eventFrom.pipe(eventTo);
            eventFrom.off(id);
            eventFrom.emit();
        });
        it("offs with event", () => {
            let eventFrom = new event_1.EventProperty.Void();
            let eventTo = new event_1.EventProperty.Void();
            eventTo.on(function () { throw new Error("Should not happen"); });
            eventFrom.pipe(eventTo);
            eventFrom.off(eventTo);
            eventFrom.emit();
        });
    });
    describe("route", () => {
        it("string", () => {
            let eventFrom = new event_1.EventProperty();
            let eventTo = new event_1.EventProperty();
            eventTo.on(function (arg) {
                expect(arg).to.equal("test");
            });
            let id = eventFrom.route("test", eventTo);
            expect(typeof id).to.equal("number");
            eventFrom.emit("test");
            eventFrom.emit("random");
            eventFrom.emit("any");
        });
        it("regexp", () => {
            let eventFrom = new event_1.EventProperty();
            let eventTo = new event_1.EventProperty();
            let pass = 1;
            eventTo.on(function (arg) {
                chai.assert(/^\/[a-zA-Z]*/.test(arg));
                chai.assert(!--pass);
            });
            let id = eventFrom.route(/^\/[a-zA-Z]+/, eventTo);
            expect(typeof id).to.equal("number");
            eventFrom.emit("/root");
            eventFrom.emit("random");
            eventFrom.emit("/34/");
        });
    });
    describe("first", () => {
        it("resolves with value", (done) => {
            let event = new event_1.EventProperty();
            let testArg = "test";
            event.first().then((arg) => {
                expect(arg).to.equal(testArg);
                done();
            });
            event.emit(testArg);
        });
        it("can be caught after emit", (done) => {
            let event = new event_1.EventProperty.Void();
            event.emit();
            event.first().then(() => {
                done();
            });
        });
    });
    describe("next", () => {
        it("resolves with value", (done) => {
            let event = new event_1.EventProperty();
            let testArg = "test";
            event.next().then((arg) => {
                expect(arg).to.equal(testArg);
                done();
            });
            event.emit(testArg);
        });
        it("creates new promises", (done) => {
            let event = new event_1.EventProperty();
            let testArg1 = "test1";
            let testArg2 = "test2";
            event.next().then((arg) => {
                expect(arg).to.equal(testArg1);
                event.next().then((arg) => {
                    expect(arg).to.equal(testArg2);
                    event.next().then((arg) => {
                        expect(arg).to.equal(testArg1);
                        done();
                    });
                    event.emit(testArg1);
                });
                event.emit(testArg2);
            });
            event.emit(testArg1);
        });
    });
    it("EventProperty.make", (done) => {
        class Test {
            constructor() {
                [this.event, this.emitter] = event_1.EventProperty.make();
            }
            test() {
                this.event.emit("test");
            }
        }
        let instance = new Test();
        instance.emitter.on(() => done());
        instance.test();
    });
});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZXZlbnQuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi9zcmMvdGVzdC9ldmVudC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQSxnREFBZ0Q7O0FBRWhELDZCQUE2QjtBQUM3QixvQ0FBdUM7QUFFdkMsSUFBSSxNQUFNLEdBQUcsSUFBSSxDQUFDLE1BQU0sQ0FBQztBQUV6QixzQkFBc0IsTUFBYztJQUNoQyxFQUFFLENBQUMsb0JBQW9CLEVBQUU7UUFDckIsSUFBSSxLQUFLLEdBQUcsSUFBSSxxQkFBYSxFQUFRLENBQUM7UUFDdEMsSUFBSSxFQUFFLEdBQUcsS0FBSyxDQUFDLE1BQU0sQ0FBQyxDQUFDLFFBQU8sQ0FBQyxDQUFDLENBQUM7UUFDakMsTUFBTSxDQUFDLE9BQU8sRUFBRSxDQUFDLENBQUMsRUFBRSxDQUFDLEtBQUssQ0FBQyxRQUFRLENBQUMsQ0FBQztJQUN6QyxDQUFDLENBQUMsQ0FBQztJQUNILEVBQUUsQ0FBQyxVQUFVLEVBQUUsQ0FBQyxJQUFlO1FBQzNCLElBQUksS0FBSyxHQUFHLElBQUkscUJBQWEsQ0FBQyxJQUFJLEVBQUUsQ0FBQztRQUNyQyxLQUFLLENBQUMsTUFBTSxDQUFDLENBQUMsSUFBSSxDQUFDLENBQUM7UUFDcEIsS0FBSyxDQUFDLElBQUksRUFBRSxDQUFDO0lBQ2pCLENBQUMsQ0FBQyxDQUFDO0lBQ0gsRUFBRSxDQUFDLGlCQUFpQixFQUFFLENBQUMsSUFBZTtRQUNsQyxJQUFJLE9BQU8sR0FBRyxNQUFNLENBQUM7UUFDckIsSUFBSSxLQUFLLEdBQUcsSUFBSSxxQkFBYSxFQUFVLENBQUM7UUFDeEMsS0FBSyxDQUFDLE1BQU0sQ0FBQyxDQUFDLENBQUMsR0FBVztZQUN0QixNQUFNLENBQUMsR0FBRyxDQUFDLENBQUMsRUFBRSxDQUFDLEVBQUUsQ0FBQyxLQUFLLENBQUMsT0FBTyxDQUFDLENBQUM7WUFDakMsSUFBSSxFQUFFLENBQUM7UUFDWCxDQUFDLENBQUMsQ0FBQztRQUNILEtBQUssQ0FBQyxJQUFJLENBQUMsT0FBTyxDQUFDLENBQUM7SUFDeEIsQ0FBQyxDQUFDLENBQUM7SUFDSCxFQUFFLENBQUMsZ0JBQWdCLEVBQUUsQ0FBQyxJQUFlO1FBQ2pDLElBQUksS0FBSyxHQUFHLElBQUkscUJBQWEsQ0FBQyxJQUFJLEVBQUUsQ0FBQztRQUNyQyxJQUFJLFFBR0gsQ0FBQztRQUNGLFFBQVEsR0FBSTtZQUNSLFlBQVksRUFBRSxJQUFJO1lBQ2xCLEVBQUU7Z0JBQ0UsSUFBSSxDQUFDLE1BQU0sQ0FBQyxJQUFJLENBQUMsQ0FBQyxFQUFFLENBQUMsRUFBRSxDQUFDLEtBQUssQ0FBQyxRQUFRLENBQUMsQ0FBQztnQkFDeEMsSUFBSSxFQUFFLENBQUM7WUFDWCxDQUFDO1NBQ0osQ0FBQztRQUNGLEtBQUssQ0FBQyxNQUFNLENBQUMsQ0FBQyxRQUFRLENBQUMsRUFBRSxFQUFFLFFBQVEsQ0FBQyxDQUFDO1FBQ3JDLEtBQUssQ0FBQyxJQUFJLEVBQUUsQ0FBQztJQUNqQixDQUFDLENBQUMsQ0FBQztBQUNQLENBQUM7QUFFRCwyQkFBMkIsTUFBYztJQUNyQyxJQUFJLEtBQUssR0FBRyxnQkFBZ0IsQ0FBQztJQUM3QixFQUFFLENBQUMsb0JBQW9CLEVBQUU7UUFDckIsSUFBSSxLQUFLLEdBQUcsSUFBSSxxQkFBYSxFQUFVLENBQUM7UUFDeEMsSUFBSSxFQUFFLEdBQUcsS0FBSyxDQUFDLE1BQU0sQ0FBQyxDQUFDLEtBQUssRUFBRSxRQUFPLENBQUMsQ0FBQyxDQUFDO1FBQ3hDLE1BQU0sQ0FBQyxPQUFPLEVBQUUsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxLQUFLLENBQUMsUUFBUSxDQUFDLENBQUM7SUFDekMsQ0FBQyxDQUFDLENBQUM7SUFDSCxFQUFFLENBQUMsVUFBVSxFQUFFLENBQUMsSUFBZTtRQUMzQixJQUFJLEtBQUssR0FBRyxJQUFJLHFCQUFhLEVBQVUsQ0FBQztRQUN4QyxLQUFLLENBQUMsTUFBTSxDQUFDLENBQUMsS0FBSyxFQUFFLGNBQWMsSUFBSSxFQUFFLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQztRQUM5QyxLQUFLLENBQUMsSUFBSSxDQUFDLEtBQUssQ0FBQyxDQUFDO0lBQ3RCLENBQUMsQ0FBQyxDQUFDO0lBQ0gsRUFBRSxDQUFDLGlCQUFpQixFQUFFLENBQUMsSUFBZTtRQUNsQyxJQUFJLE9BQU8sR0FBRyxNQUFNLENBQUM7UUFDckIsSUFBSSxLQUFLLEdBQUcsSUFBSSxxQkFBYSxFQUFVLENBQUM7UUFDeEMsS0FBSyxDQUFDLE1BQU0sQ0FBQyxDQUFDLE9BQU8sRUFBRSxDQUFDLEdBQVc7WUFDL0IsTUFBTSxDQUFDLEdBQUcsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxFQUFFLENBQUMsS0FBSyxDQUFDLE9BQU8sQ0FBQyxDQUFDO1lBQ2pDLElBQUksRUFBRSxDQUFDO1FBQ1gsQ0FBQyxDQUFDLENBQUM7UUFDSCxLQUFLLENBQUMsSUFBSSxDQUFDLE9BQU8sQ0FBQyxDQUFDO0lBQ3hCLENBQUMsQ0FBQyxDQUFDO0lBQ0gsRUFBRSxDQUFDLGdCQUFnQixFQUFFLENBQUMsSUFBZTtRQUNqQyxJQUFJLEtBQUssR0FBRyxJQUFJLHFCQUFhLEVBQVUsQ0FBQztRQUN4QyxJQUFJLFFBR0gsQ0FBQztRQUNGLFFBQVEsR0FBSTtZQUNSLFlBQVksRUFBRSxJQUFJO1lBQ2xCLEVBQUU7Z0JBQ0UsSUFBSSxDQUFDLE1BQU0sQ0FBQyxJQUFJLENBQUMsQ0FBQyxFQUFFLENBQUMsRUFBRSxDQUFDLEtBQUssQ0FBQyxRQUFRLENBQUMsQ0FBQztnQkFDeEMsSUFBSSxFQUFFLENBQUM7WUFDWCxDQUFDO1NBQ0osQ0FBQztRQUNGLEtBQUssQ0FBQyxNQUFNLENBQUMsQ0FBQyxLQUFLLEVBQUUsUUFBUSxDQUFDLEVBQUUsRUFBRSxRQUFRLENBQUMsQ0FBQztRQUM1QyxLQUFLLENBQUMsSUFBSSxDQUFDLEtBQUssQ0FBQyxDQUFDO0lBQ3RCLENBQUMsQ0FBQyxDQUFDO0lBQ0gsRUFBRSxDQUFDLDBCQUEwQixFQUFFO1FBQzNCLElBQUksS0FBSyxHQUFHLElBQUkscUJBQWEsRUFBVSxDQUFDO1FBQ3hDLEtBQUssQ0FBQyxNQUFNLENBQUMsQ0FBQyxLQUFLLEVBQUUsY0FBYyxNQUFNLElBQUksS0FBSyxDQUFDLHFCQUFxQixDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQztRQUM5RSxLQUFLLENBQUMsSUFBSSxDQUFDLEVBQUUsQ0FBQyxDQUFDO1FBQ2YsS0FBSyxDQUFDLElBQUksQ0FBQyxLQUFLLENBQUMsQ0FBQztRQUNsQixLQUFLLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxDQUFDO0lBQ3JCLENBQUMsQ0FBQyxDQUFDO0FBQ1AsQ0FBQztBQUVELFFBQVEsQ0FBQyxlQUFlLEVBQUU7SUFDdEIsRUFBRSxDQUFDLGFBQWEsRUFBRTtRQUNkLElBQUkscUJBQWEsRUFBUSxDQUFDO0lBQzlCLENBQUMsQ0FBQyxDQUFDO0lBQ0gsUUFBUSxDQUFDLElBQUksRUFBRTtRQUNYLFlBQVksQ0FBQyxJQUFJLENBQUMsQ0FBQztRQUNuQixFQUFFLENBQUMsdUJBQXVCLEVBQUUsQ0FBQyxJQUFlO1lBQ3hDLElBQUksS0FBSyxHQUFHLElBQUkscUJBQWEsQ0FBQyxJQUFJLEVBQUUsQ0FBQztZQUNyQyxJQUFJLFFBQVEsR0FBZSxJQUFJLENBQUM7WUFDaEMsSUFBSSxRQUFRLEdBQWUsSUFBSSxDQUFDO1lBQ2hDLElBQUksUUFBUSxHQUFpQixJQUFJLE9BQU8sQ0FBTSxDQUFDLE9BQU8sT0FBTyxRQUFRLEdBQUcsT0FBTyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUM7WUFDcEYsSUFBSSxRQUFRLEdBQWlCLElBQUksT0FBTyxDQUFNLENBQUMsT0FBTyxPQUFPLFFBQVEsR0FBRyxPQUFPLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQztZQUNwRixLQUFLLENBQUMsRUFBRSxDQUFDLFFBQVEsQ0FBQyxDQUFDO1lBQ25CLEtBQUssQ0FBQyxFQUFFLENBQUMsUUFBUSxDQUFDLENBQUM7WUFDbkIsT0FBTyxDQUFDLEdBQUcsQ0FBQyxDQUFDLFFBQVEsRUFBRSxRQUFRLENBQUMsQ0FBQyxDQUFDLElBQUksQ0FBQyxjQUFZLElBQUksRUFBRSxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsS0FBSyxDQUFDLElBQUksQ0FBQyxDQUFDO1lBQzFFLEtBQUssQ0FBQyxJQUFJLEVBQUUsQ0FBQztRQUNqQixDQUFDLENBQUMsQ0FBQztRQUNILEVBQUUsQ0FBQyxnQ0FBZ0MsRUFBRSxDQUFDLElBQWU7WUFDakQsSUFBSSxLQUFLLEdBQUcsSUFBSSxxQkFBYSxDQUFDLElBQUksRUFBRSxDQUFDO1lBQ3JDLElBQUksU0FBUyxHQUFHLENBQUMsQ0FBQztZQUNsQixJQUFJLFdBQVcsR0FBRyxDQUFDLENBQUM7WUFDcEIsS0FBSyxDQUFDLEVBQUUsQ0FBQztnQkFDTCxXQUFXLEVBQUUsQ0FBQztnQkFDZCxFQUFFLENBQUMsQ0FBQyxXQUFXLEtBQUssU0FBUyxDQUFDO29CQUFDLElBQUksRUFBRSxDQUFDO1lBQzFDLENBQUMsQ0FBQyxDQUFDO1lBQ0gsR0FBRyxDQUFDLENBQUMsSUFBSSxDQUFDLEdBQUcsQ0FBQyxFQUFFLENBQUMsR0FBRyxTQUFTLEVBQUUsQ0FBQyxFQUFFO2dCQUFFLEtBQUssQ0FBQyxJQUFJLEVBQUUsQ0FBQztRQUNyRCxDQUFDLENBQUMsQ0FBQztJQUNQLENBQUMsQ0FBQyxDQUFDO0lBRUgsUUFBUSxDQUFDLEtBQUssRUFBRTtRQUNaLEVBQUUsQ0FBQyxZQUFZLEVBQUU7WUFDYixJQUFJLEtBQUssR0FBRyxJQUFJLHFCQUFhLENBQUMsSUFBSSxFQUFFLENBQUM7WUFDckMsSUFBSSxPQUFPLEdBQUc7Z0JBQ1YsTUFBTSxJQUFJLEtBQUssQ0FBQyx1QkFBdUIsQ0FBQyxDQUFDO1lBQzdDLENBQUMsQ0FBQztZQUVGLEtBQUssQ0FBQyxFQUFFLENBQUMsT0FBTyxDQUFDLENBQUM7WUFDbEIsS0FBSyxDQUFDLEdBQUcsQ0FBQyxPQUFPLENBQUMsQ0FBQztZQUVuQixLQUFLLENBQUMsSUFBSSxFQUFFLENBQUM7UUFDakIsQ0FBQyxDQUFDLENBQUM7UUFDSCxFQUFFLENBQUMsT0FBTyxFQUFFO1lBQ1IsSUFBSSxLQUFLLEdBQUcsSUFBSSxxQkFBYSxDQUFDLElBQUksRUFBRSxDQUFDO1lBQ3JDLElBQUksT0FBTyxHQUFHO2dCQUNWLE1BQU0sSUFBSSxLQUFLLENBQUMsdUJBQXVCLENBQUMsQ0FBQztZQUM3QyxDQUFDLENBQUM7WUFFRixJQUFJLEVBQUUsR0FBRyxLQUFLLENBQUMsRUFBRSxDQUFDLE9BQU8sQ0FBQyxDQUFDO1lBQzNCLEtBQUssQ0FBQyxHQUFHLENBQUMsRUFBRSxDQUFDLENBQUM7WUFFZCxLQUFLLENBQUMsSUFBSSxFQUFFLENBQUM7UUFDakIsQ0FBQyxDQUFDLENBQUM7UUFDSCxFQUFFLENBQUMsWUFBWSxFQUFFLENBQUMsSUFBZTtZQUM3QixJQUFJLEtBQUssR0FBRyxJQUFJLHFCQUFhLENBQUMsSUFBSSxFQUFFLENBQUM7WUFDckMsSUFBSSxPQUFPLEdBQUcsRUFBRSxDQUFDO1lBQ2pCLElBQUksT0FBTyxHQUFHO2dCQUNWLEVBQUUsQ0FBQyxDQUFDLElBQUksS0FBSyxPQUFPLENBQUM7b0JBQ2pCLE1BQU0sSUFBSSxLQUFLLENBQUMsdUJBQXVCLENBQUMsQ0FBQztnQkFDN0MsSUFBSTtvQkFDQSxJQUFJLEVBQUUsQ0FBQztZQUNmLENBQUMsQ0FBQztZQUNGLHFEQUFxRDtZQUNyRCxvRUFBb0U7WUFFcEUsS0FBSyxDQUFDLEVBQUUsQ0FBQyxPQUFPLEVBQUUsT0FBTyxDQUFDLENBQUM7WUFDM0IsS0FBSyxDQUFDLEVBQUUsQ0FBQyxPQUFPLEVBQUUsT0FBTyxDQUFDLENBQUM7WUFDM0IsS0FBSyxDQUFDLEVBQUUsQ0FBQyxPQUFPLENBQUMsQ0FBQztZQUNsQixLQUFLLENBQUMsR0FBRyxDQUFDLE9BQU8sQ0FBQyxDQUFDO1lBRW5CLEtBQUssQ0FBQyxJQUFJLEVBQUUsQ0FBQztRQUNqQixDQUFDLENBQUMsQ0FBQztRQUNILEVBQUUsQ0FBQyxRQUFRLEVBQUUsQ0FBQyxJQUFlO1lBQ3pCLElBQUksS0FBSyxHQUFHLElBQUkscUJBQWEsQ0FBQyxJQUFJLEVBQUUsQ0FBQztZQUNyQyxJQUFJLE9BQU8sR0FBRztnQkFDVixFQUFFLENBQUMsQ0FBQyxJQUFJLEtBQUssT0FBTyxDQUFDO29CQUNqQixNQUFNLElBQUksS0FBSyxDQUFDLHVCQUF1QixDQUFDLENBQUM7Z0JBQzdDLElBQUk7b0JBQ0EsSUFBSSxFQUFFLENBQUM7WUFDZixDQUFDLENBQUM7WUFDRixxREFBcUQ7WUFDckQsb0VBQW9FO1lBQ3BFLEtBQUssQ0FBQyxFQUFFLENBQUMsT0FBTyxDQUFDLENBQUM7WUFDbEIsS0FBSyxDQUFDLEVBQUUsQ0FBQyxPQUFPLENBQUMsQ0FBQztZQUNsQixLQUFLLENBQUMsR0FBRyxFQUFFLENBQUM7WUFDWixVQUFVLENBQUMsSUFBSSxFQUFFLEVBQUUsQ0FBQyxDQUFDO1lBRXJCLEtBQUssQ0FBQyxJQUFJLEVBQUUsQ0FBQztRQUNqQixDQUFDLENBQUMsQ0FBQztJQUNQLENBQUMsQ0FBQyxDQUFDO0lBRUgsUUFBUSxDQUFDLE1BQU0sRUFBRTtRQUNiLFlBQVksQ0FBQyxNQUFNLENBQUMsQ0FBQztRQUNyQixFQUFFLENBQUMsZUFBZSxFQUFFO1lBQ2hCLElBQUksS0FBSyxHQUFHLElBQUkscUJBQWEsQ0FBQyxJQUFJLEVBQUUsQ0FBQztZQUNyQyxJQUFJLE9BQU8sR0FBRyxJQUFJLENBQUM7WUFDbkIsS0FBSyxDQUFDLElBQUksQ0FBQztnQkFDUCxJQUFJLENBQUMsTUFBTSxDQUFDLE9BQU8sQ0FBQyxDQUFDO2dCQUNyQixPQUFPLEdBQUcsS0FBSyxDQUFDO1lBQ3BCLENBQUMsQ0FBQyxDQUFDO1lBQ0gsS0FBSyxDQUFDLElBQUksRUFBRSxDQUFDO1lBQ2IsS0FBSyxDQUFDLElBQUksRUFBRSxDQUFDO1FBQ2pCLENBQUMsQ0FBQyxDQUFDO0lBQ1AsQ0FBQyxDQUFDLENBQUM7SUFDSCxRQUFRLENBQUMsT0FBTyxFQUFFO1FBQ2QsaUJBQWlCLENBQUMsT0FBTyxDQUFDLENBQUM7UUFDM0IsRUFBRSxDQUFDLHFCQUFxQixFQUFFLENBQUMsSUFBZTtZQUN0QyxJQUFJLEtBQUssR0FBRyxJQUFJLHFCQUFhLEVBQU8sQ0FBQztZQUNyQyxLQUFLLENBQUMsS0FBSyxDQUFDLEVBQUUsQ0FBQyxFQUFFLENBQUMsRUFBRSxDQUFDLEVBQUUsQ0FBQyxFQUFFLEVBQUUsY0FBYyxJQUFJLEVBQUUsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDO1lBQ3JELEtBQUssQ0FBQyxJQUFJLENBQUMsRUFBRSxDQUFDLEVBQUUsQ0FBQyxFQUFFLENBQUMsRUFBRSxDQUFDLEVBQUUsQ0FBQyxFQUFFLENBQUMsRUFBRSxDQUFDLEVBQUUsR0FBRyxFQUFDLENBQUMsQ0FBQztRQUM1QyxDQUFDLENBQUMsQ0FBQztRQUNILEVBQUUsQ0FBQyxnQkFBZ0IsRUFBRSxDQUFDLElBQWU7WUFDakMsSUFBSSxLQUFLLEdBQUcsSUFBSSxxQkFBYSxFQUFPLENBQUM7WUFDckMsS0FBSyxDQUFDLEtBQUssQ0FBQyxFQUFFLENBQUMsRUFBRSxFQUFDLENBQUMsRUFBRyxHQUFHLEVBQUMsRUFBRSxDQUFDLEVBQUUsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxDQUFDLEVBQUUsRUFBRSxjQUFjLElBQUksRUFBRSxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUM7WUFDbEUsS0FBSyxDQUFDLElBQUksQ0FBQyxFQUFFLENBQUMsRUFBRSxFQUFDLENBQUMsRUFBRyxHQUFHLEVBQUUsQ0FBQyxFQUFFLEVBQUMsQ0FBQyxFQUFFLENBQUMsRUFBQyxFQUFDLEVBQUUsQ0FBQyxFQUFFLENBQUMsQ0FBQyxFQUFFLENBQUMsRUFBRSxFQUFFLENBQUMsRUFBRSxHQUFHLEVBQUMsRUFBRSxJQUFJLENBQUMsRUFBRSxDQUFDLENBQUM7UUFDeEUsQ0FBQyxDQUFDLENBQUM7UUFDSCxFQUFFLENBQUMsZ0JBQWdCLEVBQUUsQ0FBQyxJQUFlO1lBQ2pDLElBQUksS0FBSyxHQUFHLElBQUkscUJBQWEsRUFBTyxDQUFDO1lBQ3JDLEtBQUssQ0FBQyxLQUFLLENBQUMsYUFBYSxFQUFFLGNBQWMsSUFBSSxFQUFFLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQztZQUNwRCxLQUFLLENBQUMsSUFBSSxDQUFDLGNBQWMsQ0FBQyxDQUFDO1FBQy9CLENBQUMsQ0FBQyxDQUFDO0lBQ1AsQ0FBQyxDQUFDLENBQUM7SUFDSCxRQUFRLENBQUMsV0FBVyxFQUFFO1FBQ2xCLGlCQUFpQixDQUFDLFdBQVcsQ0FBQyxDQUFDO1FBQy9CLEVBQUUsQ0FBQyxjQUFjLEVBQUU7WUFDZixJQUFJLEtBQUssR0FBRyxJQUFJLHFCQUFhLEVBQVUsQ0FBQztZQUN4QyxJQUFJLE9BQU8sR0FBRyxJQUFJLENBQUM7WUFDbkIsS0FBSyxDQUFDLFNBQVMsQ0FBQyxPQUFPLEVBQUU7Z0JBQ3JCLElBQUksQ0FBQyxNQUFNLENBQUMsT0FBTyxDQUFDLENBQUM7Z0JBQ3JCLE9BQU8sR0FBRyxLQUFLLENBQUM7WUFDcEIsQ0FBQyxDQUFDLENBQUM7WUFDSCxLQUFLLENBQUMsSUFBSSxDQUFDLE9BQU8sQ0FBQyxDQUFDO1lBQ3BCLEtBQUssQ0FBQyxJQUFJLENBQUMsT0FBTyxDQUFDLENBQUM7WUFDcEIsS0FBSyxDQUFDLElBQUksQ0FBQyxTQUFTLENBQUMsQ0FBQztRQUMxQixDQUFDLENBQUMsQ0FBQztJQUNQLENBQUMsQ0FBQyxDQUFDO0lBQ0gsUUFBUSxDQUFDLE1BQU0sRUFBRTtRQUNiLEVBQUUsQ0FBQyxpQ0FBaUMsRUFBRSxDQUFDLElBQWU7WUFDbEQsSUFBSSxTQUFTLEdBQUcsSUFBSSxxQkFBYSxFQUFVLENBQUM7WUFDNUMsSUFBSSxPQUFPLEdBQUcsSUFBSSxxQkFBYSxFQUFVLENBQUM7WUFDMUMsSUFBSSxPQUFPLEdBQUcsTUFBTSxDQUFDO1lBQ3JCLE9BQU8sQ0FBQyxFQUFFLENBQUMsVUFBVSxHQUFXO2dCQUM1QixNQUFNLENBQUMsR0FBRyxDQUFDLENBQUMsRUFBRSxDQUFDLEtBQUssQ0FBQyxPQUFPLENBQUMsQ0FBQztnQkFDOUIsSUFBSSxFQUFFLENBQUM7WUFDWCxDQUFDLENBQUMsQ0FBQztZQUNILElBQUksRUFBRSxHQUFHLFNBQVMsQ0FBQyxJQUFJLENBQUMsT0FBTyxDQUFDLENBQUM7WUFDakMsTUFBTSxDQUFDLE9BQU8sRUFBRSxDQUFDLENBQUMsRUFBRSxDQUFDLEtBQUssQ0FBQyxRQUFRLENBQUMsQ0FBQztZQUNyQyxTQUFTLENBQUMsSUFBSSxDQUFDLE9BQU8sQ0FBQyxDQUFDO1FBQzVCLENBQUMsQ0FBQyxDQUFDO1FBQ0gsRUFBRSxDQUFDLGNBQWMsRUFBRTtZQUNmLElBQUksU0FBUyxHQUFHLElBQUkscUJBQWEsQ0FBQyxJQUFJLEVBQUUsQ0FBQztZQUN6QyxJQUFJLE9BQU8sR0FBRyxJQUFJLHFCQUFhLENBQUMsSUFBSSxFQUFFLENBQUM7WUFFdkMsT0FBTyxDQUFDLEVBQUUsQ0FBQyxjQUFjLE1BQU0sSUFBSSxLQUFLLENBQUMsbUJBQW1CLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDO1lBQ2xFLElBQUksRUFBRSxHQUFHLFNBQVMsQ0FBQyxJQUFJLENBQUMsT0FBTyxDQUFDLENBQUM7WUFDakMsU0FBUyxDQUFDLEdBQUcsQ0FBQyxFQUFFLENBQUMsQ0FBQztZQUNsQixTQUFTLENBQUMsSUFBSSxFQUFFLENBQUM7UUFDckIsQ0FBQyxDQUFDLENBQUM7UUFDSCxFQUFFLENBQUMsaUJBQWlCLEVBQUU7WUFDbEIsSUFBSSxTQUFTLEdBQUcsSUFBSSxxQkFBYSxDQUFDLElBQUksRUFBRSxDQUFDO1lBQ3pDLElBQUksT0FBTyxHQUFHLElBQUkscUJBQWEsQ0FBQyxJQUFJLEVBQUUsQ0FBQztZQUV2QyxPQUFPLENBQUMsRUFBRSxDQUFDLGNBQWMsTUFBTSxJQUFJLEtBQUssQ0FBQyxtQkFBbUIsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUM7WUFDbEUsU0FBUyxDQUFDLElBQUksQ0FBQyxPQUFPLENBQUMsQ0FBQztZQUN4QixTQUFTLENBQUMsR0FBRyxDQUFDLE9BQU8sQ0FBQyxDQUFDO1lBQ3ZCLFNBQVMsQ0FBQyxJQUFJLEVBQUUsQ0FBQztRQUNyQixDQUFDLENBQUMsQ0FBQztJQUNQLENBQUMsQ0FBQyxDQUFDO0lBQ0gsUUFBUSxDQUFDLE9BQU8sRUFBRTtRQUNkLEVBQUUsQ0FBQyxRQUFRLEVBQUU7WUFDVCxJQUFJLFNBQVMsR0FBRyxJQUFJLHFCQUFhLEVBQVUsQ0FBQztZQUM1QyxJQUFJLE9BQU8sR0FBRyxJQUFJLHFCQUFhLEVBQVUsQ0FBQztZQUUxQyxPQUFPLENBQUMsRUFBRSxDQUFDLFVBQVUsR0FBVztnQkFDNUIsTUFBTSxDQUFDLEdBQUcsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxLQUFLLENBQUMsTUFBTSxDQUFDLENBQUM7WUFDakMsQ0FBQyxDQUFDLENBQUM7WUFDSCxJQUFJLEVBQUUsR0FBRyxTQUFTLENBQUMsS0FBSyxDQUFDLE1BQU0sRUFBRSxPQUFPLENBQUMsQ0FBQztZQUMxQyxNQUFNLENBQUMsT0FBTyxFQUFFLENBQUMsQ0FBQyxFQUFFLENBQUMsS0FBSyxDQUFDLFFBQVEsQ0FBQyxDQUFDO1lBQ3JDLFNBQVMsQ0FBQyxJQUFJLENBQUMsTUFBTSxDQUFDLENBQUM7WUFDdkIsU0FBUyxDQUFDLElBQUksQ0FBQyxRQUFRLENBQUMsQ0FBQztZQUN6QixTQUFTLENBQUMsSUFBSSxDQUFDLEtBQUssQ0FBQyxDQUFDO1FBQzFCLENBQUMsQ0FBQyxDQUFDO1FBQ0gsRUFBRSxDQUFDLFFBQVEsRUFBRTtZQUNULElBQUksU0FBUyxHQUFHLElBQUkscUJBQWEsRUFBVSxDQUFDO1lBQzVDLElBQUksT0FBTyxHQUFHLElBQUkscUJBQWEsRUFBVSxDQUFDO1lBQzFDLElBQUksSUFBSSxHQUFHLENBQUMsQ0FBQztZQUViLE9BQU8sQ0FBQyxFQUFFLENBQUMsVUFBVSxHQUFXO2dCQUM1QixJQUFJLENBQUMsTUFBTSxDQUFDLGNBQWMsQ0FBQyxJQUFJLENBQUMsR0FBRyxDQUFDLENBQUMsQ0FBQztnQkFDdEMsSUFBSSxDQUFDLE1BQU0sQ0FBQyxDQUFDLEVBQUUsSUFBSSxDQUFDLENBQUE7WUFDeEIsQ0FBQyxDQUFDLENBQUM7WUFDSCxJQUFJLEVBQUUsR0FBRyxTQUFTLENBQUMsS0FBSyxDQUFDLGNBQWMsRUFBRSxPQUFPLENBQUMsQ0FBQztZQUNsRCxNQUFNLENBQUMsT0FBTyxFQUFFLENBQUMsQ0FBQyxFQUFFLENBQUMsS0FBSyxDQUFDLFFBQVEsQ0FBQyxDQUFDO1lBQ3JDLFNBQVMsQ0FBQyxJQUFJLENBQUMsT0FBTyxDQUFDLENBQUM7WUFDeEIsU0FBUyxDQUFDLElBQUksQ0FBQyxRQUFRLENBQUMsQ0FBQztZQUN6QixTQUFTLENBQUMsSUFBSSxDQUFDLE1BQU0sQ0FBQyxDQUFDO1FBQzNCLENBQUMsQ0FBQyxDQUFDO0lBQ1AsQ0FBQyxDQUFDLENBQUM7SUFDSCxRQUFRLENBQUMsT0FBTyxFQUFFO1FBQ2QsRUFBRSxDQUFDLHFCQUFxQixFQUFFLENBQUMsSUFBZTtZQUN0QyxJQUFJLEtBQUssR0FBRyxJQUFJLHFCQUFhLEVBQVUsQ0FBQztZQUN4QyxJQUFJLE9BQU8sR0FBVyxNQUFNLENBQUM7WUFDN0IsS0FBSyxDQUFDLEtBQUssRUFBRSxDQUFDLElBQUksQ0FBQyxDQUFDLEdBQVc7Z0JBQzNCLE1BQU0sQ0FBQyxHQUFHLENBQUMsQ0FBQyxFQUFFLENBQUMsS0FBSyxDQUFDLE9BQU8sQ0FBQyxDQUFDO2dCQUM5QixJQUFJLEVBQUUsQ0FBQztZQUNYLENBQUMsQ0FBQyxDQUFDO1lBQ0gsS0FBSyxDQUFDLElBQUksQ0FBQyxPQUFPLENBQUMsQ0FBQztRQUN4QixDQUFDLENBQUMsQ0FBQztRQUVILEVBQUUsQ0FBQywwQkFBMEIsRUFBRSxDQUFDLElBQWU7WUFDM0MsSUFBSSxLQUFLLEdBQUcsSUFBSSxxQkFBYSxDQUFDLElBQUksRUFBRSxDQUFDO1lBQ3JDLEtBQUssQ0FBQyxJQUFJLEVBQUUsQ0FBQztZQUNiLEtBQUssQ0FBQyxLQUFLLEVBQUUsQ0FBQyxJQUFJLENBQUM7Z0JBQ2YsSUFBSSxFQUFFLENBQUM7WUFDWCxDQUFDLENBQUMsQ0FBQztRQUNQLENBQUMsQ0FBQyxDQUFDO0lBQ1AsQ0FBQyxDQUFDLENBQUM7SUFDSCxRQUFRLENBQUMsTUFBTSxFQUFFO1FBQ2IsRUFBRSxDQUFDLHFCQUFxQixFQUFFLENBQUMsSUFBZTtZQUN0QyxJQUFJLEtBQUssR0FBRyxJQUFJLHFCQUFhLEVBQVUsQ0FBQztZQUN4QyxJQUFJLE9BQU8sR0FBVyxNQUFNLENBQUM7WUFDN0IsS0FBSyxDQUFDLElBQUksRUFBRSxDQUFDLElBQUksQ0FBQyxDQUFDLEdBQVc7Z0JBQzFCLE1BQU0sQ0FBQyxHQUFHLENBQUMsQ0FBQyxFQUFFLENBQUMsS0FBSyxDQUFDLE9BQU8sQ0FBQyxDQUFDO2dCQUM5QixJQUFJLEVBQUUsQ0FBQztZQUNYLENBQUMsQ0FBQyxDQUFDO1lBQ0gsS0FBSyxDQUFDLElBQUksQ0FBQyxPQUFPLENBQUMsQ0FBQztRQUN4QixDQUFDLENBQUMsQ0FBQztRQUNILEVBQUUsQ0FBQyxzQkFBc0IsRUFBRSxDQUFDLElBQWU7WUFDdkMsSUFBSSxLQUFLLEdBQUcsSUFBSSxxQkFBYSxFQUFVLENBQUM7WUFDeEMsSUFBSSxRQUFRLEdBQVcsT0FBTyxDQUFDO1lBQy9CLElBQUksUUFBUSxHQUFXLE9BQU8sQ0FBQztZQUMvQixLQUFLLENBQUMsSUFBSSxFQUFFLENBQUMsSUFBSSxDQUFDLENBQUMsR0FBVztnQkFDMUIsTUFBTSxDQUFDLEdBQUcsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxLQUFLLENBQUMsUUFBUSxDQUFDLENBQUM7Z0JBQy9CLEtBQUssQ0FBQyxJQUFJLEVBQUUsQ0FBQyxJQUFJLENBQUMsQ0FBQyxHQUFXO29CQUMxQixNQUFNLENBQUMsR0FBRyxDQUFDLENBQUMsRUFBRSxDQUFDLEtBQUssQ0FBQyxRQUFRLENBQUMsQ0FBQztvQkFDL0IsS0FBSyxDQUFDLElBQUksRUFBRSxDQUFDLElBQUksQ0FBQyxDQUFDLEdBQVc7d0JBQzFCLE1BQU0sQ0FBQyxHQUFHLENBQUMsQ0FBQyxFQUFFLENBQUMsS0FBSyxDQUFDLFFBQVEsQ0FBQyxDQUFDO3dCQUMvQixJQUFJLEVBQUUsQ0FBQztvQkFDWCxDQUFDLENBQUMsQ0FBQztvQkFDSCxLQUFLLENBQUMsSUFBSSxDQUFDLFFBQVEsQ0FBQyxDQUFDO2dCQUN6QixDQUFDLENBQUMsQ0FBQztnQkFDSCxLQUFLLENBQUMsSUFBSSxDQUFDLFFBQVEsQ0FBQyxDQUFDO1lBQ3pCLENBQUMsQ0FBQyxDQUFDO1lBQ0gsS0FBSyxDQUFDLElBQUksQ0FBQyxRQUFRLENBQUMsQ0FBQztRQUN6QixDQUFDLENBQUMsQ0FBQztJQUNQLENBQUMsQ0FBQyxDQUFDO0lBQ0gsRUFBRSxDQUFDLG9CQUFvQixFQUFFLENBQUMsSUFBZTtRQUNyQztZQUdJO2dCQUNJLENBQUMsSUFBSSxDQUFDLEtBQUssRUFBRSxJQUFJLENBQUMsT0FBTyxDQUFDLEdBQUcscUJBQWEsQ0FBQyxJQUFJLEVBQVUsQ0FBQztZQUM5RCxDQUFDO1lBQ0QsSUFBSTtnQkFDQSxJQUFJLENBQUMsS0FBSyxDQUFDLElBQUksQ0FBQyxNQUFNLENBQUMsQ0FBQztZQUM1QixDQUFDO1NBQ0o7UUFDRCxJQUFJLFFBQVEsR0FBRyxJQUFJLElBQUksRUFBRSxDQUFDO1FBQzFCLFFBQVEsQ0FBQyxPQUFPLENBQUMsRUFBRSxDQUFDLE1BQU0sSUFBSSxFQUFFLENBQUMsQ0FBQztRQUNsQyxRQUFRLENBQUMsSUFBSSxFQUFFLENBQUM7SUFDcEIsQ0FBQyxDQUFDLENBQUM7QUFDUCxDQUFDLENBQUMsQ0FBQyIsInNvdXJjZXNDb250ZW50IjpbIi8vLyA8cmVmZXJlbmNlIHBhdGg9XCIuLi8uLi90eXBpbmdzL2luZGV4LmQudHNcIi8+XG5cbmltcG9ydCAqIGFzIGNoYWkgZnJvbSBcImNoYWlcIjtcbmltcG9ydCB7RXZlbnRQcm9wZXJ0eX0gZnJvbSBcIi4uL2V2ZW50XCI7XG5pbXBvcnQge2Fzc2VydH0gZnJvbSBcIn5jaGFpL2xpYi9DaGFpXCI7XG5sZXQgZXhwZWN0ID0gY2hhaS5leHBlY3Q7XG5cbmZ1bmN0aW9uIHRlc3RUcmlnZ2VycyhtZXRob2Q6IHN0cmluZykge1xuICAgIGl0KFwicmV0dXJucyBsaXN0ZW5lcklkXCIsICgpID0+IHtcbiAgICAgICAgbGV0IGV2ZW50ID0gbmV3IEV2ZW50UHJvcGVydHk8dm9pZD4oKTtcbiAgICAgICAgbGV0IGlkID0gZXZlbnRbbWV0aG9kXSgoKSA9PiB7fSk7XG4gICAgICAgIGV4cGVjdCh0eXBlb2YgaWQpLnRvLmVxdWFsKFwibnVtYmVyXCIpO1xuICAgIH0pO1xuICAgIGl0KFwidHJpZ2dlcnNcIiwgKGRvbmU6IE1vY2hhRG9uZSkgPT4ge1xuICAgICAgICBsZXQgZXZlbnQgPSBuZXcgRXZlbnRQcm9wZXJ0eS5Wb2lkKCk7XG4gICAgICAgIGV2ZW50W21ldGhvZF0oZG9uZSk7XG4gICAgICAgIGV2ZW50LmVtaXQoKTtcbiAgICB9KTtcbiAgICBpdChcInBhc3NlcyBhcmd1bWVudFwiLCAoZG9uZTogTW9jaGFEb25lKSA9PiB7XG4gICAgICAgIGxldCB0ZXN0QXJnID0gXCJ0ZXN0XCI7XG4gICAgICAgIGxldCBldmVudCA9IG5ldyBFdmVudFByb3BlcnR5PHN0cmluZz4oKTtcbiAgICAgICAgZXZlbnRbbWV0aG9kXSgoYXJnOiBzdHJpbmcpID0+IHtcbiAgICAgICAgICAgIGV4cGVjdChhcmcpLnRvLmJlLmVxdWFsKHRlc3RBcmcpO1xuICAgICAgICAgICAgZG9uZSgpO1xuICAgICAgICB9KTtcbiAgICAgICAgZXZlbnQuZW1pdCh0ZXN0QXJnKTtcbiAgICB9KTtcbiAgICBpdChcInBhc3NlcyBjb250ZXh0XCIsIChkb25lOiBNb2NoYURvbmUpID0+IHtcbiAgICAgICAgbGV0IGV2ZW50ID0gbmV3IEV2ZW50UHJvcGVydHkuVm9pZCgpO1xuICAgICAgICBsZXQgbGlzdGVuZXI6IHtcbiAgICAgICAgICAgIGl0SXNMaXN0ZW5lcjogYm9vbGVhbjtcbiAgICAgICAgICAgIGZuOiAoKSA9PiB2b2lkO1xuICAgICAgICB9O1xuICAgICAgICBsaXN0ZW5lciAgPSB7XG4gICAgICAgICAgICBpdElzTGlzdGVuZXI6IHRydWUsXG4gICAgICAgICAgICBmbigpIHtcbiAgICAgICAgICAgICAgICBjaGFpLmV4cGVjdCh0aGlzKS50by5iZS5lcXVhbChsaXN0ZW5lcik7XG4gICAgICAgICAgICAgICAgZG9uZSgpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9O1xuICAgICAgICBldmVudFttZXRob2RdKGxpc3RlbmVyLmZuLCBsaXN0ZW5lcik7XG4gICAgICAgIGV2ZW50LmVtaXQoKTtcbiAgICB9KTtcbn1cblxuZnVuY3Rpb24gdGVzdE1hdGNoVHJpZ2dlcnMobWV0aG9kOiBzdHJpbmcpIHtcbiAgICBsZXQgbWF0Y2ggPSBcInRlc3RNYXRjaFZhbHVlXCI7XG4gICAgaXQoXCJyZXR1cm5zIGxpc3RlbmVySWRcIiwgKCkgPT4ge1xuICAgICAgICBsZXQgZXZlbnQgPSBuZXcgRXZlbnRQcm9wZXJ0eTxzdHJpbmc+KCk7XG4gICAgICAgIGxldCBpZCA9IGV2ZW50W21ldGhvZF0obWF0Y2gsICgpID0+IHt9KTtcbiAgICAgICAgZXhwZWN0KHR5cGVvZiBpZCkudG8uZXF1YWwoXCJudW1iZXJcIik7XG4gICAgfSk7XG4gICAgaXQoXCJ0cmlnZ2Vyc1wiLCAoZG9uZTogTW9jaGFEb25lKSA9PiB7XG4gICAgICAgIGxldCBldmVudCA9IG5ldyBFdmVudFByb3BlcnR5PHN0cmluZz4oKTtcbiAgICAgICAgZXZlbnRbbWV0aG9kXShtYXRjaCwgZnVuY3Rpb24gKCkgeyBkb25lKCk7IH0pO1xuICAgICAgICBldmVudC5lbWl0KG1hdGNoKTtcbiAgICB9KTtcbiAgICBpdChcInBhc3NlcyBhcmd1bWVudFwiLCAoZG9uZTogTW9jaGFEb25lKSA9PiB7XG4gICAgICAgIGxldCB0ZXN0QXJnID0gXCJ0ZXN0XCI7XG4gICAgICAgIGxldCBldmVudCA9IG5ldyBFdmVudFByb3BlcnR5PHN0cmluZz4oKTtcbiAgICAgICAgZXZlbnRbbWV0aG9kXSh0ZXN0QXJnLCAoYXJnOiBzdHJpbmcpID0+IHtcbiAgICAgICAgICAgIGV4cGVjdChhcmcpLnRvLmJlLmVxdWFsKHRlc3RBcmcpO1xuICAgICAgICAgICAgZG9uZSgpO1xuICAgICAgICB9KTtcbiAgICAgICAgZXZlbnQuZW1pdCh0ZXN0QXJnKTtcbiAgICB9KTtcbiAgICBpdChcInBhc3NlcyBjb250ZXh0XCIsIChkb25lOiBNb2NoYURvbmUpID0+IHtcbiAgICAgICAgbGV0IGV2ZW50ID0gbmV3IEV2ZW50UHJvcGVydHk8c3RyaW5nPigpO1xuICAgICAgICBsZXQgbGlzdGVuZXI6IHtcbiAgICAgICAgICAgIGl0SXNMaXN0ZW5lcjogYm9vbGVhbjtcbiAgICAgICAgICAgIGZuOiAoKSA9PiB2b2lkO1xuICAgICAgICB9O1xuICAgICAgICBsaXN0ZW5lciAgPSB7XG4gICAgICAgICAgICBpdElzTGlzdGVuZXI6IHRydWUsXG4gICAgICAgICAgICBmbigpIHtcbiAgICAgICAgICAgICAgICBjaGFpLmV4cGVjdCh0aGlzKS50by5iZS5lcXVhbChsaXN0ZW5lcik7XG4gICAgICAgICAgICAgICAgZG9uZSgpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9O1xuICAgICAgICBldmVudFttZXRob2RdKG1hdGNoLCBsaXN0ZW5lci5mbiwgbGlzdGVuZXIpO1xuICAgICAgICBldmVudC5lbWl0KG1hdGNoKTtcbiAgICB9KTtcbiAgICBpdChcImlnbm9yZXMgaXJyZWxldmFudCBlbWl0c1wiLCAoKSA9PiB7XG4gICAgICAgIGxldCBldmVudCA9IG5ldyBFdmVudFByb3BlcnR5PHN0cmluZz4oKTtcbiAgICAgICAgZXZlbnRbbWV0aG9kXShtYXRjaCwgZnVuY3Rpb24gKCkgeyB0aHJvdyBuZXcgRXJyb3IoXCJNdXN0IG5vdCBiZSBpbnZva2VkXCIpOyB9KTtcbiAgICAgICAgZXZlbnQuZW1pdChcIlwiKTtcbiAgICAgICAgZXZlbnQuZW1pdChcImFiY1wiKTtcbiAgICAgICAgZXZlbnQuZW1pdChudWxsKTtcbiAgICB9KTtcbn1cblxuZGVzY3JpYmUoXCJFdmVudFByb3BlcnR5XCIsICgpID0+IHtcbiAgICBpdChcImNvbnN0cnVjdG9yXCIsICgpID0+IHtcbiAgICAgICAgbmV3IEV2ZW50UHJvcGVydHk8dm9pZD4oKTtcbiAgICB9KTtcbiAgICBkZXNjcmliZShcIm9uXCIsICgpID0+IHtcbiAgICAgICAgdGVzdFRyaWdnZXJzKFwib25cIik7XG4gICAgICAgIGl0KFwiaW52b2tlcyBhbGwgbGlzdGVuZXJzXCIsIChkb25lOiBNb2NoYURvbmUpID0+IHtcbiAgICAgICAgICAgIGxldCBldmVudCA9IG5ldyBFdmVudFByb3BlcnR5LlZvaWQoKTtcbiAgICAgICAgICAgIGxldCByZXNvbHZlMTogKCkgPT4gdm9pZCA9IG51bGw7XG4gICAgICAgICAgICBsZXQgcmVzb2x2ZTI6ICgpID0+IHZvaWQgPSBudWxsO1xuICAgICAgICAgICAgbGV0IHByb21pc2UxOiBQcm9taXNlPGFueT4gPSBuZXcgUHJvbWlzZTxhbnk+KChyZXNvbHZlKSA9PiB7IHJlc29sdmUxID0gcmVzb2x2ZTsgfSk7XG4gICAgICAgICAgICBsZXQgcHJvbWlzZTI6IFByb21pc2U8YW55PiA9IG5ldyBQcm9taXNlPGFueT4oKHJlc29sdmUpID0+IHsgcmVzb2x2ZTIgPSByZXNvbHZlOyB9KTtcbiAgICAgICAgICAgIGV2ZW50Lm9uKHJlc29sdmUxKTtcbiAgICAgICAgICAgIGV2ZW50Lm9uKHJlc29sdmUyKTtcbiAgICAgICAgICAgIFByb21pc2UuYWxsKFtwcm9taXNlMSwgcHJvbWlzZTJdKS50aGVuKGZ1bmN0aW9uKCl7IGRvbmUoKTsgfSkuY2F0Y2goZG9uZSk7XG4gICAgICAgICAgICBldmVudC5lbWl0KCk7XG4gICAgICAgIH0pO1xuICAgICAgICBpdChcImludm9rZXMgbGlzdGVuZXJzIG9uIGVhY2ggZW1pdFwiLCAoZG9uZTogTW9jaGFEb25lKSA9PiB7XG4gICAgICAgICAgICBsZXQgZXZlbnQgPSBuZXcgRXZlbnRQcm9wZXJ0eS5Wb2lkKCk7XG4gICAgICAgICAgICBsZXQgbkV4cGVjdGVkID0gNTtcbiAgICAgICAgICAgIGxldCBuUmVnaXN0ZXJlZCA9IDA7XG4gICAgICAgICAgICBldmVudC5vbigoKSA9PiB7XG4gICAgICAgICAgICAgICAgblJlZ2lzdGVyZWQrKztcbiAgICAgICAgICAgICAgICBpZiAoblJlZ2lzdGVyZWQgPT09IG5FeHBlY3RlZCkgZG9uZSgpO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IG5FeHBlY3RlZDsgaSsrKSBldmVudC5lbWl0KCk7XG4gICAgICAgIH0pO1xuICAgIH0pO1xuXG4gICAgZGVzY3JpYmUoXCJvZmZcIiwgKCkgPT4ge1xuICAgICAgICBpdChcImJ5IGhhbmRsZXJcIiwgKCkgPT4ge1xuICAgICAgICAgICAgbGV0IGV2ZW50ID0gbmV3IEV2ZW50UHJvcGVydHkuVm9pZCgpO1xuICAgICAgICAgICAgbGV0IGhhbmRsZXIgPSAoKSA9PiB7XG4gICAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKFwiU2hvdWxkIG5vdCBiZSBpbnZva2VkXCIpO1xuICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgZXZlbnQub24oaGFuZGxlcik7XG4gICAgICAgICAgICBldmVudC5vZmYoaGFuZGxlcik7XG5cbiAgICAgICAgICAgIGV2ZW50LmVtaXQoKTtcbiAgICAgICAgfSk7XG4gICAgICAgIGl0KFwiYnkgaWRcIiwgKCkgPT4ge1xuICAgICAgICAgICAgbGV0IGV2ZW50ID0gbmV3IEV2ZW50UHJvcGVydHkuVm9pZCgpO1xuICAgICAgICAgICAgbGV0IGhhbmRsZXIgPSAoKSA9PiB7XG4gICAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKFwiU2hvdWxkIG5vdCBiZSBpbnZva2VkXCIpO1xuICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgbGV0IGlkID0gZXZlbnQub24oaGFuZGxlcik7XG4gICAgICAgICAgICBldmVudC5vZmYoaWQpO1xuXG4gICAgICAgICAgICBldmVudC5lbWl0KCk7XG4gICAgICAgIH0pO1xuICAgICAgICBpdChcImJ5IGNvbnRleHRcIiwgKGRvbmU6IE1vY2hhRG9uZSkgPT4ge1xuICAgICAgICAgICAgbGV0IGV2ZW50ID0gbmV3IEV2ZW50UHJvcGVydHkuVm9pZCgpO1xuICAgICAgICAgICAgbGV0IGNvbnRleHQgPSB7fTtcbiAgICAgICAgICAgIGxldCBoYW5kbGVyID0gZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgaWYgKHRoaXMgPT09IGNvbnRleHQpXG4gICAgICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihcIlNob3VsZCBub3QgYmUgaW52b2tlZFwiKTtcbiAgICAgICAgICAgICAgICBlbHNlXG4gICAgICAgICAgICAgICAgICAgIGRvbmUoKTtcbiAgICAgICAgICAgIH07XG4gICAgICAgICAgICAvLyBPZmYgYnkgY29udGV4dCBzaG91bGQgcmVtb3ZlIGFsbCBoYW5kbGVycyB3aXRoIHRoZVxuICAgICAgICAgICAgLy8gY29udGV4dCBidXQgc2hvdWxkIG5vdCBhZmZlY3QgdGhlIGhhbmRsZXJzIHBhc3NlZCB3aXRob3V0IGNvbnRleHRcblxuICAgICAgICAgICAgZXZlbnQub24oaGFuZGxlciwgY29udGV4dCk7XG4gICAgICAgICAgICBldmVudC5vbihoYW5kbGVyLCBjb250ZXh0KTtcbiAgICAgICAgICAgIGV2ZW50Lm9uKGhhbmRsZXIpO1xuICAgICAgICAgICAgZXZlbnQub2ZmKGNvbnRleHQpO1xuXG4gICAgICAgICAgICBldmVudC5lbWl0KCk7XG4gICAgICAgIH0pO1xuICAgICAgICBpdChcImNsZWFyc1wiLCAoZG9uZTogTW9jaGFEb25lKSA9PiB7XG4gICAgICAgICAgICBsZXQgZXZlbnQgPSBuZXcgRXZlbnRQcm9wZXJ0eS5Wb2lkKCk7XG4gICAgICAgICAgICBsZXQgaGFuZGxlciA9IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgIGlmICh0aGlzID09PSBjb250ZXh0KVxuICAgICAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXCJTaG91bGQgbm90IGJlIGludm9rZWRcIik7XG4gICAgICAgICAgICAgICAgZWxzZVxuICAgICAgICAgICAgICAgICAgICBkb25lKCk7XG4gICAgICAgICAgICB9O1xuICAgICAgICAgICAgLy8gT2ZmIGJ5IGNvbnRleHQgc2hvdWxkIHJlbW92ZSBhbGwgaGFuZGxlcnMgd2l0aCB0aGVcbiAgICAgICAgICAgIC8vIGNvbnRleHQgYnV0IHNob3VsZCBub3QgYWZmZWN0IHRoZSBoYW5kbGVycyBwYXNzZWQgd2l0aG91dCBjb250ZXh0XG4gICAgICAgICAgICBldmVudC5vbihoYW5kbGVyKTtcbiAgICAgICAgICAgIGV2ZW50Lm9uKGhhbmRsZXIpO1xuICAgICAgICAgICAgZXZlbnQub2ZmKCk7XG4gICAgICAgICAgICBzZXRUaW1lb3V0KGRvbmUsIDEwKTtcblxuICAgICAgICAgICAgZXZlbnQuZW1pdCgpO1xuICAgICAgICB9KTtcbiAgICB9KTtcblxuICAgIGRlc2NyaWJlKFwib25jZVwiLCAoKSA9PiB7XG4gICAgICAgIHRlc3RUcmlnZ2VycyhcIm9uY2VcIik7XG4gICAgICAgIGl0KFwidHJpZ2dlcnMgb25jZVwiLCAoKSA9PiB7XG4gICAgICAgICAgICBsZXQgZXZlbnQgPSBuZXcgRXZlbnRQcm9wZXJ0eS5Wb2lkKCk7XG4gICAgICAgICAgICBsZXQgaXNGaXJzdCA9IHRydWU7XG4gICAgICAgICAgICBldmVudC5vbmNlKGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICBjaGFpLmFzc2VydChpc0ZpcnN0KTtcbiAgICAgICAgICAgICAgICBpc0ZpcnN0ID0gZmFsc2U7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIGV2ZW50LmVtaXQoKTtcbiAgICAgICAgICAgIGV2ZW50LmVtaXQoKTtcbiAgICAgICAgfSk7XG4gICAgfSk7XG4gICAgZGVzY3JpYmUoXCJtYXRjaFwiLCAoKSA9PiB7XG4gICAgICAgIHRlc3RNYXRjaFRyaWdnZXJzKFwibWF0Y2hcIik7XG4gICAgICAgIGl0KFwibWF0Y2hlcyBvYmplY3QgcGFydFwiLCAoZG9uZTogTW9jaGFEb25lKSA9PiB7XG4gICAgICAgICAgICBsZXQgZXZlbnQgPSBuZXcgRXZlbnRQcm9wZXJ0eTxhbnk+KCk7XG4gICAgICAgICAgICBldmVudC5tYXRjaCh7IGE6IDEsIGI6IDIgfSwgZnVuY3Rpb24gKCkgeyBkb25lKCk7IH0pO1xuICAgICAgICAgICAgZXZlbnQuZW1pdCh7IGE6IDEsIGI6IDIsIGM6IDMsIGQ6IFwieFwifSk7XG4gICAgICAgIH0pO1xuICAgICAgICBpdChcIm1hdGNoZXMgZGVlcGVyXCIsIChkb25lOiBNb2NoYURvbmUpID0+IHtcbiAgICAgICAgICAgIGxldCBldmVudCA9IG5ldyBFdmVudFByb3BlcnR5PGFueT4oKTtcbiAgICAgICAgICAgIGV2ZW50Lm1hdGNoKHsgYToge3ggOiBcInlcIn0sIGM6IFsxLCAyXSB9LCBmdW5jdGlvbiAoKSB7IGRvbmUoKTsgfSk7XG4gICAgICAgICAgICBldmVudC5lbWl0KHsgYToge3ggOiBcInlcIiwgejoge3I6IDF9fSwgYzogWzEsIDIsIHsgeDogXCI/XCJ9LCBudWxsXSB9KTtcbiAgICAgICAgfSk7XG4gICAgICAgIGl0KFwibWF0Y2hlcyByZWdleHBcIiwgKGRvbmU6IE1vY2hhRG9uZSkgPT4ge1xuICAgICAgICAgICAgbGV0IGV2ZW50ID0gbmV3IEV2ZW50UHJvcGVydHk8YW55PigpO1xuICAgICAgICAgICAgZXZlbnQubWF0Y2goL3Rlc3RbMTIzXSt4LywgZnVuY3Rpb24gKCkgeyBkb25lKCk7IH0pO1xuICAgICAgICAgICAgZXZlbnQuZW1pdChcInRlc3QtdGVzdDJ4c1wiKTtcbiAgICAgICAgfSk7XG4gICAgfSk7XG4gICAgZGVzY3JpYmUoXCJtYXRjaE9uY2VcIiwgKCkgPT4ge1xuICAgICAgICB0ZXN0TWF0Y2hUcmlnZ2VycyhcIm1hdGNoT25jZVwiKTtcbiAgICAgICAgaXQoXCJtYXRjaGVzIG9uY2VcIiwgKCkgPT4ge1xuICAgICAgICAgICAgbGV0IGV2ZW50ID0gbmV3IEV2ZW50UHJvcGVydHk8c3RyaW5nPigpO1xuICAgICAgICAgICAgbGV0IGlzRmlyc3QgPSB0cnVlO1xuICAgICAgICAgICAgZXZlbnQubWF0Y2hPbmNlKFwibWF0Y2hcIiwgZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgIGNoYWkuYXNzZXJ0KGlzRmlyc3QpO1xuICAgICAgICAgICAgICAgIGlzRmlyc3QgPSBmYWxzZTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgZXZlbnQuZW1pdChcIm1hdGNoXCIpO1xuICAgICAgICAgICAgZXZlbnQuZW1pdChcIm1hdGNoXCIpO1xuICAgICAgICAgICAgZXZlbnQuZW1pdChcInVubWF0Y2hcIik7XG4gICAgICAgIH0pO1xuICAgIH0pO1xuICAgIGRlc2NyaWJlKFwicGlwZVwiLCAoKSA9PiB7XG4gICAgICAgIGl0KFwicGFzc2VzIGFyZ3VtZW50LCBnZXQgbGlzdGVuZXJJZFwiLCAoZG9uZTogTW9jaGFEb25lKSA9PiB7XG4gICAgICAgICAgICBsZXQgZXZlbnRGcm9tID0gbmV3IEV2ZW50UHJvcGVydHk8c3RyaW5nPigpO1xuICAgICAgICAgICAgbGV0IGV2ZW50VG8gPSBuZXcgRXZlbnRQcm9wZXJ0eTxzdHJpbmc+KCk7XG4gICAgICAgICAgICBsZXQgdGVzdEFyZyA9IFwidGVzdFwiO1xuICAgICAgICAgICAgZXZlbnRUby5vbihmdW5jdGlvbiAoYXJnOiBzdHJpbmcpIHtcbiAgICAgICAgICAgICAgICBleHBlY3QoYXJnKS50by5lcXVhbCh0ZXN0QXJnKTtcbiAgICAgICAgICAgICAgICBkb25lKCk7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIGxldCBpZCA9IGV2ZW50RnJvbS5waXBlKGV2ZW50VG8pO1xuICAgICAgICAgICAgZXhwZWN0KHR5cGVvZiBpZCkudG8uZXF1YWwoXCJudW1iZXJcIik7XG4gICAgICAgICAgICBldmVudEZyb20uZW1pdCh0ZXN0QXJnKTtcbiAgICAgICAgfSk7XG4gICAgICAgIGl0KFwib2ZmcyB3aXRoIGlkXCIsICgpID0+IHtcbiAgICAgICAgICAgIGxldCBldmVudEZyb20gPSBuZXcgRXZlbnRQcm9wZXJ0eS5Wb2lkKCk7XG4gICAgICAgICAgICBsZXQgZXZlbnRUbyA9IG5ldyBFdmVudFByb3BlcnR5LlZvaWQoKTtcblxuICAgICAgICAgICAgZXZlbnRUby5vbihmdW5jdGlvbiAoKSB7IHRocm93IG5ldyBFcnJvcihcIlNob3VsZCBub3QgaGFwcGVuXCIpOyB9KTtcbiAgICAgICAgICAgIGxldCBpZCA9IGV2ZW50RnJvbS5waXBlKGV2ZW50VG8pO1xuICAgICAgICAgICAgZXZlbnRGcm9tLm9mZihpZCk7XG4gICAgICAgICAgICBldmVudEZyb20uZW1pdCgpO1xuICAgICAgICB9KTtcbiAgICAgICAgaXQoXCJvZmZzIHdpdGggZXZlbnRcIiwgKCkgPT4ge1xuICAgICAgICAgICAgbGV0IGV2ZW50RnJvbSA9IG5ldyBFdmVudFByb3BlcnR5LlZvaWQoKTtcbiAgICAgICAgICAgIGxldCBldmVudFRvID0gbmV3IEV2ZW50UHJvcGVydHkuVm9pZCgpO1xuXG4gICAgICAgICAgICBldmVudFRvLm9uKGZ1bmN0aW9uICgpIHsgdGhyb3cgbmV3IEVycm9yKFwiU2hvdWxkIG5vdCBoYXBwZW5cIik7IH0pO1xuICAgICAgICAgICAgZXZlbnRGcm9tLnBpcGUoZXZlbnRUbyk7XG4gICAgICAgICAgICBldmVudEZyb20ub2ZmKGV2ZW50VG8pO1xuICAgICAgICAgICAgZXZlbnRGcm9tLmVtaXQoKTtcbiAgICAgICAgfSk7XG4gICAgfSk7XG4gICAgZGVzY3JpYmUoXCJyb3V0ZVwiLCAoKSA9PiB7XG4gICAgICAgIGl0KFwic3RyaW5nXCIsICgpID0+IHtcbiAgICAgICAgICAgIGxldCBldmVudEZyb20gPSBuZXcgRXZlbnRQcm9wZXJ0eTxzdHJpbmc+KCk7XG4gICAgICAgICAgICBsZXQgZXZlbnRUbyA9IG5ldyBFdmVudFByb3BlcnR5PHN0cmluZz4oKTtcblxuICAgICAgICAgICAgZXZlbnRUby5vbihmdW5jdGlvbiAoYXJnOiBzdHJpbmcpIHtcbiAgICAgICAgICAgICAgICBleHBlY3QoYXJnKS50by5lcXVhbChcInRlc3RcIik7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIGxldCBpZCA9IGV2ZW50RnJvbS5yb3V0ZShcInRlc3RcIiwgZXZlbnRUbyk7XG4gICAgICAgICAgICBleHBlY3QodHlwZW9mIGlkKS50by5lcXVhbChcIm51bWJlclwiKTtcbiAgICAgICAgICAgIGV2ZW50RnJvbS5lbWl0KFwidGVzdFwiKTtcbiAgICAgICAgICAgIGV2ZW50RnJvbS5lbWl0KFwicmFuZG9tXCIpO1xuICAgICAgICAgICAgZXZlbnRGcm9tLmVtaXQoXCJhbnlcIik7XG4gICAgICAgIH0pO1xuICAgICAgICBpdChcInJlZ2V4cFwiLCAoKSA9PiB7XG4gICAgICAgICAgICBsZXQgZXZlbnRGcm9tID0gbmV3IEV2ZW50UHJvcGVydHk8c3RyaW5nPigpO1xuICAgICAgICAgICAgbGV0IGV2ZW50VG8gPSBuZXcgRXZlbnRQcm9wZXJ0eTxzdHJpbmc+KCk7XG4gICAgICAgICAgICBsZXQgcGFzcyA9IDE7XG5cbiAgICAgICAgICAgIGV2ZW50VG8ub24oZnVuY3Rpb24gKGFyZzogc3RyaW5nKSB7XG4gICAgICAgICAgICAgICAgY2hhaS5hc3NlcnQoL15cXC9bYS16QS1aXSovLnRlc3QoYXJnKSk7XG4gICAgICAgICAgICAgICAgY2hhaS5hc3NlcnQoIS0tcGFzcylcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgbGV0IGlkID0gZXZlbnRGcm9tLnJvdXRlKC9eXFwvW2EtekEtWl0rLywgZXZlbnRUbyk7XG4gICAgICAgICAgICBleHBlY3QodHlwZW9mIGlkKS50by5lcXVhbChcIm51bWJlclwiKTtcbiAgICAgICAgICAgIGV2ZW50RnJvbS5lbWl0KFwiL3Jvb3RcIik7XG4gICAgICAgICAgICBldmVudEZyb20uZW1pdChcInJhbmRvbVwiKTtcbiAgICAgICAgICAgIGV2ZW50RnJvbS5lbWl0KFwiLzM0L1wiKTtcbiAgICAgICAgfSk7XG4gICAgfSk7XG4gICAgZGVzY3JpYmUoXCJmaXJzdFwiLCAoKSA9PiB7XG4gICAgICAgIGl0KFwicmVzb2x2ZXMgd2l0aCB2YWx1ZVwiLCAoZG9uZTogTW9jaGFEb25lKSA9PiB7XG4gICAgICAgICAgICBsZXQgZXZlbnQgPSBuZXcgRXZlbnRQcm9wZXJ0eTxzdHJpbmc+KCk7XG4gICAgICAgICAgICBsZXQgdGVzdEFyZzogc3RyaW5nID0gXCJ0ZXN0XCI7XG4gICAgICAgICAgICBldmVudC5maXJzdCgpLnRoZW4oKGFyZzogc3RyaW5nKSA9PiB7XG4gICAgICAgICAgICAgICAgZXhwZWN0KGFyZykudG8uZXF1YWwodGVzdEFyZyk7XG4gICAgICAgICAgICAgICAgZG9uZSgpO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICBldmVudC5lbWl0KHRlc3RBcmcpO1xuICAgICAgICB9KTtcblxuICAgICAgICBpdChcImNhbiBiZSBjYXVnaHQgYWZ0ZXIgZW1pdFwiLCAoZG9uZTogTW9jaGFEb25lKSA9PiB7XG4gICAgICAgICAgICBsZXQgZXZlbnQgPSBuZXcgRXZlbnRQcm9wZXJ0eS5Wb2lkKCk7XG4gICAgICAgICAgICBldmVudC5lbWl0KCk7XG4gICAgICAgICAgICBldmVudC5maXJzdCgpLnRoZW4oKCkgPT4ge1xuICAgICAgICAgICAgICAgIGRvbmUoKTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9KTtcbiAgICB9KTtcbiAgICBkZXNjcmliZShcIm5leHRcIiwgKCkgPT4ge1xuICAgICAgICBpdChcInJlc29sdmVzIHdpdGggdmFsdWVcIiwgKGRvbmU6IE1vY2hhRG9uZSkgPT4ge1xuICAgICAgICAgICAgbGV0IGV2ZW50ID0gbmV3IEV2ZW50UHJvcGVydHk8c3RyaW5nPigpO1xuICAgICAgICAgICAgbGV0IHRlc3RBcmc6IHN0cmluZyA9IFwidGVzdFwiO1xuICAgICAgICAgICAgZXZlbnQubmV4dCgpLnRoZW4oKGFyZzogc3RyaW5nKSA9PiB7XG4gICAgICAgICAgICAgICAgZXhwZWN0KGFyZykudG8uZXF1YWwodGVzdEFyZyk7XG4gICAgICAgICAgICAgICAgZG9uZSgpO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICBldmVudC5lbWl0KHRlc3RBcmcpO1xuICAgICAgICB9KTtcbiAgICAgICAgaXQoXCJjcmVhdGVzIG5ldyBwcm9taXNlc1wiLCAoZG9uZTogTW9jaGFEb25lKSA9PiB7XG4gICAgICAgICAgICBsZXQgZXZlbnQgPSBuZXcgRXZlbnRQcm9wZXJ0eTxzdHJpbmc+KCk7XG4gICAgICAgICAgICBsZXQgdGVzdEFyZzE6IHN0cmluZyA9IFwidGVzdDFcIjtcbiAgICAgICAgICAgIGxldCB0ZXN0QXJnMjogc3RyaW5nID0gXCJ0ZXN0MlwiO1xuICAgICAgICAgICAgZXZlbnQubmV4dCgpLnRoZW4oKGFyZzogc3RyaW5nKSA9PiB7XG4gICAgICAgICAgICAgICAgZXhwZWN0KGFyZykudG8uZXF1YWwodGVzdEFyZzEpO1xuICAgICAgICAgICAgICAgIGV2ZW50Lm5leHQoKS50aGVuKChhcmc6IHN0cmluZykgPT4ge1xuICAgICAgICAgICAgICAgICAgICBleHBlY3QoYXJnKS50by5lcXVhbCh0ZXN0QXJnMik7XG4gICAgICAgICAgICAgICAgICAgIGV2ZW50Lm5leHQoKS50aGVuKChhcmc6IHN0cmluZykgPT4ge1xuICAgICAgICAgICAgICAgICAgICAgICAgZXhwZWN0KGFyZykudG8uZXF1YWwodGVzdEFyZzEpO1xuICAgICAgICAgICAgICAgICAgICAgICAgZG9uZSgpO1xuICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAgICAgZXZlbnQuZW1pdCh0ZXN0QXJnMSk7XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgZXZlbnQuZW1pdCh0ZXN0QXJnMik7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIGV2ZW50LmVtaXQodGVzdEFyZzEpO1xuICAgICAgICB9KTtcbiAgICB9KTtcbiAgICBpdChcIkV2ZW50UHJvcGVydHkubWFrZVwiLCAoZG9uZTogTW9jaGFEb25lKSA9PiB7XG4gICAgICAgIGNsYXNzIFRlc3Qge1xuICAgICAgICAgICAgcHJpdmF0ZSBldmVudDogRXZlbnRQcm9wZXJ0eTxzdHJpbmc+O1xuICAgICAgICAgICAgcHVibGljIGVtaXR0ZXI6IEV2ZW50UHJvcGVydHkuRW1pdHRlcjxzdHJpbmc+O1xuICAgICAgICAgICAgY29uc3RydWN0b3IoKSB7XG4gICAgICAgICAgICAgICAgW3RoaXMuZXZlbnQsIHRoaXMuZW1pdHRlcl0gPSBFdmVudFByb3BlcnR5Lm1ha2U8c3RyaW5nPigpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgdGVzdCgpIHtcbiAgICAgICAgICAgICAgICB0aGlzLmV2ZW50LmVtaXQoXCJ0ZXN0XCIpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIGxldCBpbnN0YW5jZSA9IG5ldyBUZXN0KCk7XG4gICAgICAgIGluc3RhbmNlLmVtaXR0ZXIub24oKCkgPT4gZG9uZSgpKTtcbiAgICAgICAgaW5zdGFuY2UudGVzdCgpO1xuICAgIH0pO1xufSk7Il19