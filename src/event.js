/// <reference path="../typings/index.d.ts"/>
const _ = require("lodash");
/**
 * Represents an event and proviedes various way to observe the event both
 * externally and internally. Internally provides also a way to trigger the event.
 */
class Event {
    constructor() {
        this.listeners = [];
        this.isBeingTriggered = false;
        /*
        This whole thing with 'delegates' was desiged first of all to provide
        a way to make mixin feature, which wouldn't create new closures all the time,
        and so that the user never has to use closures or 'bind' to use any of
        event object methods as callbacks passed somewhere, etc...
    
        This 'delegate' code definitely could be shorter, and it is not the best way
        to do it. Here is a good place to mention that this lib,
        is created not for production sites, but for my own academical purposes,
        so first of all it should be convinient for me, not taking into account other
        people. I totally don't care about performance in this lib. I have no goal to
        make the most fast or error-free thing right now. The goal of this library is
        to implement the 'event-object' approach to events concept, and experiment
        with various possible API features, to find out which of them are usefull and
        which are not really needed, or make API too complex. After finding out what i believe
        is the most simple, laconic and clear API this lib could have - i'll cover it fully with
        tests, and only after that will i even consider taking any performance issues into account.
        */
        this.triggerDelegate = null;
        this.listenDelegate = null;
        this.matchDelegate = null;
        this.matchOnceDelegate = null;
        this.unlistenDelegate = null;
        this.onceDelegate = null;
        this.whenDelegate = null;
        this.thenDelegate = null;
        this.catchDelegate = null;
        this.promise = null;
        this.isFirstTriggerDone = false;
        this.idCounter = 0;
        this.triggerDelegate = (eventArg) => this.trigger(eventArg);
        this.listenDelegate = (...args) => {
            return this.listen.apply(this, args);
        };
        this.matchDelegate = (...args) => {
            return this.match.apply(this, args);
        };
        this.matchOnceDelegate = (...args) => {
            return this.matchOnce.apply(this, args);
        };
        this.unlistenDelegate = (...args) => {
            return this.unlisten.apply(this, args);
        };
        this.onceDelegate = (handler, context = null) => {
            return this.once(handler, context);
        };
        this.whenDelegate = () => {
            return this.when();
        };
        this.thenDelegate = (onOk, onFail) => {
            return this.then(onOk, onFail);
        };
        this.catchDelegate = (onFail) => {
            return this.catch(onFail);
        };
        this.promise = new Promise((resolve) => { this.resolve = resolve; });
    }
    /**
     * Mix this events methods into the target object.
     * This is a way to add the event functionality to some existing object,
     * without messing with it's inheritance chain.
     */
    mixin(target) {
        target.trigger = this.getTriggerer();
        target.getTriggerer = () => {
            return this.getTriggerer();
        };
        target.listen = this.getListener();
        target.match = this.getMatchListener();
        target.matchOnce = this.getMatchOncer();
        target.unlisten = this.getUnlistener();
        target.once = this.getOncer();
        target.when = this.getWhener();
        target.then = this.getThener();
        target.catch = this.getCatcher();
        return target;
    }
    /** Returns a context-independent callback that triggers the event with given argument */
    getTriggerer() { return this.triggerDelegate; }
    getListener() { return this.listenDelegate; }
    getMatchListener() { return this.matchDelegate; }
    getMatchOncer() { return this.matchOnceDelegate; }
    getUnlistener() { return this.unlistenDelegate; }
    getOncer() { return this.onceDelegate; }
    getWhener() { return this.whenDelegate; }
    getThener() { return this.thenDelegate; }
    getCatcher() { return this.catchDelegate; }
    /**
     * Triggers the event with given argument, invoking all of its handlers, and if
     * the event is triggered for the first time - removing the once event handlers and
     * saving given argument inetrnally as first trigger argument.
     *
     * The argument is optional, since event can be of void type (`x= new Event<void>()`),
     * but if the event is not of a void type - you should allways pass an argument to
     * the trigger method.
     */
    trigger(eventArg) {
        if (this.isBeingTriggered) {
            throw new Error(`Event triggered during trigger handling - suspecting recursive event.`);
        }
        this.isBeingTriggered = true;
        if (!this.isFirstTriggerDone) {
            this.isFirstTriggerDone = true;
            this.resolve(eventArg);
        }
        this.listeners.slice().forEach((listener) => {
            let doCall = true;
            if (listener.onlyMatching) {
                doCall = listener.matchValue === eventArg;
            }
            if (doCall) {
                if (listener.context) {
                    listener.handler.call(listener.context, eventArg);
                }
                else {
                    listener.handler.call(null, eventArg);
                }
                if (listener.once) {
                    this.removeListener(listener);
                }
            }
        });
        this.isBeingTriggered = false;
    }
    listen(...args) {
        let id;
        if (typeof args[0] === 'string') {
            let [name, handler, context] = args;
            id = this.addListener({ name, handler, context });
        }
        else {
            let [handler, context] = args;
            id = this.addListener({ handler, context });
        }
        return id;
    }
    ;
    match(value, ...args) {
        let id;
        if (typeof args[0] === 'string') {
            let [name, handler, context] = args;
            id = this.addListener({ name, handler, context, onlyMatching: true, matchValue: value });
        }
        else {
            let [handler, context] = args;
            id = this.addListener({ handler, context, onlyMatching: true, matchValue: value });
        }
        return id;
    }
    ;
    /**
     * Combines 'match' and 'once' features.
     */
    matchOnce(value, handler, context = null) {
        return this.addListener({ context, handler, once: true, onlyMatching: true, matchValue: value });
    }
    once(handler, context = null) {
        return this.addListener({ context, handler, once: true });
    }
    unlisten(...args) {
        let name = null, context, handler, idToRemove = null;
        switch (args.length) {
            case 0:
                this.listeners = [];
                return;
            case 1:
                if (typeof args[0] === 'string') {
                    name = args[0];
                    handler = args[1];
                    context = args[2];
                }
                else if (typeof args[0] === 'number') {
                    idToRemove = args[0];
                }
                else {
                    handler = args[0];
                    context = args[1];
                }
                ;
                break;
            case 2:
                handler = args[0];
                context = args[1];
                break;
        }
        this.listeners = _.filter(this.listeners, (hConf) => {
            let differentHandler = hConf.handler !== handler;
            let noContextGiven = context === null;
            let confHasNoContext = !!hConf.context;
            let differentContext = hConf.context !== context;
            let sameName = name && hConf.name && (name === hConf.name);
            let dontRemove;
            if (idToRemove !== null) {
                dontRemove = idToRemove !== hConf.id;
            }
            else {
                if (name) {
                    dontRemove = !sameName;
                }
                else {
                    if (differentHandler) {
                        dontRemove = true;
                    }
                    else {
                        dontRemove = noContextGiven ? (!confHasNoContext) : (confHasNoContext || differentContext);
                    }
                }
            }
            return dontRemove;
        });
    }
    on(nameOrHandler, handlerOrNothing) {
        return this.listen.apply(this, arguments);
    }
    off(bullshitWTF, context) {
        return this.unlisten.apply(this, arguments);
    }
    when() { return this.promise; }
    then(onOk, onFail) { return this.when().then(onOk, onFail); }
    after(onAny) { return this.then(onAny).catch(onAny); }
    catch(onFail) { return this.when().catch(onFail); }
    /**
     * Piping the events means that the other event must be triggered(happen) any time
     * this event happens and with exactly the same argument.
     */
    pipe(other) {
        this.on(other.getTriggerer());
    }
    unpipe(other) {
        this.off(other.getTriggerer());
    }
    removeListener(listener) {
        let listenerIndex = this.listeners.indexOf(listener);
        if (listenerIndex !== -1) {
            this.listeners.splice(listenerIndex, 1);
        }
    }
    addListener(options) {
        let { context, handler, once, onlyMatching, matchValue } = options;
        this.idCounter++;
        this.listeners.push({ context, handler, once, id: this.idCounter, onlyMatching, matchValue });
        return this.idCounter;
    }
}
exports.Event = Event;
Object.defineProperty(exports, "__esModule", { value: true });
exports.default = Event;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZXZlbnQuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyJldmVudC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQSw2Q0FBNkM7QUFFN0MsNEJBQTRCO0FBcUI1Qjs7O0dBR0c7QUFDSDtJQTJDSTtRQTFDUSxjQUFTLEdBQWdDLEVBQUUsQ0FBQztRQUM1QyxxQkFBZ0IsR0FBWSxLQUFLLENBQUM7UUFFMUM7Ozs7Ozs7Ozs7Ozs7Ozs7O1VBaUJFO1FBQ00sb0JBQWUsR0FBc0IsSUFBSSxDQUFDO1FBRTFDLG1CQUFjLEdBQXFCLElBQUksQ0FBQztRQUN4QyxrQkFBYSxHQUEwQixJQUFJLENBQUM7UUFDNUMsc0JBQWlCLEdBQXVCLElBQUksQ0FBQztRQUM3QyxxQkFBZ0IsR0FBdUIsSUFBSSxDQUFDO1FBRTVDLGlCQUFZLEdBQWtCLElBQUksQ0FBQztRQUVuQyxpQkFBWSxHQUFtQixJQUFJLENBQUM7UUFFcEMsaUJBQVksR0FBbUIsSUFBSSxDQUFDO1FBQ3BDLGtCQUFhLEdBQW9CLElBQUksQ0FBQztRQUV0QyxZQUFPLEdBQWUsSUFBSSxDQUFDO1FBRTNCLHVCQUFrQixHQUFZLEtBQUssQ0FBQztRQUVwQyxjQUFTLEdBQVcsQ0FBQyxDQUFDO1FBSTFCLElBQUksQ0FBQyxlQUFlLEdBQUcsQ0FBQyxRQUFXLEtBQUssSUFBSSxDQUFDLE9BQU8sQ0FBQyxRQUFRLENBQUMsQ0FBQztRQUMvRCxJQUFJLENBQUMsY0FBYyxHQUFHLENBQUMsR0FBRyxJQUFXO1lBQ2pDLE1BQU0sQ0FBQyxJQUFJLENBQUMsTUFBTSxDQUFDLEtBQUssQ0FBQyxJQUFJLEVBQUUsSUFBSSxDQUFDLENBQUM7UUFDekMsQ0FBQyxDQUFDO1FBQ0YsSUFBSSxDQUFDLGFBQWEsR0FBRyxDQUFDLEdBQUcsSUFBVztZQUNoQyxNQUFNLENBQUMsSUFBSSxDQUFDLEtBQUssQ0FBQyxLQUFLLENBQUMsSUFBSSxFQUFFLElBQUksQ0FBQyxDQUFDO1FBQ3hDLENBQUMsQ0FBQztRQUNGLElBQUks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QUFDLFNBQVMsQ0FBQyxJQUFJLENBQUMsRUFBQyxPQUFPLEVBQUUsT0FBTyxFQUFFLElBQUksRUFBRSxFQUFFLEVBQUUsSUFBSSxDQUFDLFNBQVMsRUFBRSxZQUFZLEVBQUUsVUFBVSxFQUFDLENBQUMsQ0FBQztRQUM1RixNQUFNLENBQUMsSUFBSSxDQUFDLFNBQVMsQ0FBQztJQUMxQixDQUFDO0NBQ0o7QUF4U0Qsc0JBd1NDOztBQXFCRCxrQkFBZSxLQUFLLENBQUMiLCJzb3VyY2VzQ29udGVudCI6WyIvLy8gPHJlZmVyZW5jZSBwYXRoPVwiLi4vdHlwaW5ncy9pbmRleC5kLnRzXCIvPlxuXG5pbXBvcnQgKiBhcyBfIGZyb20gJ2xvZGFzaCc7XG5pbXBvcnQgKiBhcyBkZWVwRXF1YWwgZnJvbSAnZGVlcC1zdHJpY3QtZXF1YWwnO1xuaW1wb3J0IHtcbiAgICBFdmVudEhhbmRsZXIsXG4gICAgRXZlbnRIYW5kbGVyT3B0aW9ucyxcbiAgICBFdmVudEhhbmRsZXJEZXNjcmlwdG9yLFxuICAgIEV2ZW50VHJpZ2dlcmVyLFxuICAgIEV2ZW50TGlzdGVuZXIsXG4gICAgRXZlbnRVbmxpc3RlbmVyLFxuICAgIEV2ZW50T25jZXIsXG4gICAgRXZlbnRNYXRjaExpc3RlbmVyLFxuICAgIEV2ZW50TWF0Y2hPbmNlcixcbiAgICBFdmVudFdoZW5lcixcbiAgICBFdmVudFRoZW5lcixcbiAgICBFdmVudENhdGNoZXIsXG4gICAgRXZlbnRUcmFpdCxcbiAgICBUaGVuYWJsZSxcbiAgICBFdmVudEVtaXR0ZXIsXG4gICAgRXZlbnRUcmFpdFRyaWdnZXJcbn0gZnJvbSAnLi9pbnRlcmZhY2VzJztcblxuLyoqXG4gKiBSZXByZXNlbnRzIGFuIGV2ZW50IGFuZCBwcm92aWVkZXMgdmFyaW91cyB3YXkgdG8gb2JzZXJ2ZSB0aGUgZXZlbnQgYm90aFxuICogZXh0ZXJuYWxseSBhbmQgaW50ZXJuYWxseS4gSW50ZXJuYWxseSBwcm92aWRlcyBhbHNvIGEgd2F5IHRvIHRyaWdnZXIgdGhlIGV2ZW50LlxuICovXG5leHBvcnQgY2xhc3MgRXZlbnQ8VD4gaW1wbGVtZW50cyBFdmVudFRyYWl0PFQ+LCBUaGVuYWJsZTxUPiB7XG4gICAgcHJpdmF0ZSBsaXN0ZW5lcnM6IEV2ZW50SGFuZGxlckRlc2NyaXB0b3I8VD5bXSA9IFtdO1xuICAgIHByaXZhdGUgaXNCZWluZ1RyaWdnZXJlZDogYm9vbGVhbiA9IGZhbHNlO1xuXG4gICAgLyogXG4gICAgVGhpcyB3aG9sZSB0aGluZyB3aXRoICdkZWxlZ2F0ZXMnIHdhcyBkZXNpZ2VkIGZpcnN0IG9mIGFsbCB0byBwcm92aWRlXG4gICAgYSB3YXkgdG8gbWFrZSBtaXhpbiBmZWF0dXJlLCB3aGljaCB3b3VsZG4ndCBjcmVhdGUgbmV3IGNsb3N1cmVzIGFsbCB0aGUgdGltZSxcbiAgICBhbmQgc28gdGhhdCB0aGUgdXNlciBuZXZlciBoYXMgdG8gdXNlIGNsb3N1cmVzIG9yICdiaW5kJyB0byB1c2UgYW55IG9mXG4gICAgZXZlbnQgb2JqZWN0IG1ldGhvZHMgYXMgY2FsbGJhY2tzIHBhc3NlZCBzb21ld2hlcmUsIGV0Yy4uLlxuXG4gICAgVGhpcyAnZGVsZWdhdGUnIGNvZGUgZGVmaW5pdGVseSBjb3VsZCBiZSBzaG9ydGVyLCBhbmQgaXQgaXMgbm90IHRoZSBiZXN0IHdheVxuICAgIHRvIGRvIGl0LiBIZXJlIGlzIGEgZ29vZCBwbGFjZSB0byBtZW50aW9uIHRoYXQgdGhpcyBsaWIsXG4gICAgaXMgY3JlYXRlZCBub3QgZm9yIHByb2R1Y3Rpb24gc2l0ZXMsIGJ1dCBmb3IgbXkgb3duIGFjYWRlbWljYWwgcHVycG9zZXMsXG4gICAgc28gZmlyc3Qgb2YgYWxsIGl0IHNob3VsZCBiZSBjb252aW5pZW50IGZvciBtZSwgbm90IHRha2luZyBpbnRvIGFjY291bnQgb3RoZXJcbiAgICBwZW9wbGUuIEkgdG90YWxseSBkb24ndCBjYXJlIGFib3V0IHBlcmZvcm1hbmNlIGluIHRoaXMgbGliLiBJIGhhdmUgbm8gZ29hbCB0b1xuICAgIG1ha2UgdGhlIG1vc3QgZmFzdCBvciBlcnJvci1mcmVlIHRoaW5nIHJpZ2h0IG5vdy4gVGhlIGdvYWwgb2YgdGhpcyBsaWJyYXJ5IGlzXG4gICAgdG8gaW1wbGVtZW50IHRoZSAnZXZlbnQtb2JqZWN0JyBhcHByb2FjaCB0byBldmVudHMgY29uY2VwdCwgYW5kIGV4cGVyaW1lbnQgXG4gICAgd2l0aCB2YXJpb3VzIHBvc3NpYmxlIEFQSSBmZWF0dXJlcywgdG8gZmluZCBvdXQgd2hpY2ggb2YgdGhlbSBhcmUgdXNlZnVsbCBhbmRcbiAgICB3aGljaCBhcmUgbm90IHJlYWxseSBuZWVkZWQsIG9yIG1ha2UgQVBJIHRvbyBjb21wbGV4LiBBZnRlciBmaW5kaW5nIG91dCB3aGF0IGkgYmVsaWV2ZVxuICAgIGlzIHRoZSBtb3N0IHNpbXBsZSwgbGFjb25pYyBhbmQgY2xlYXIgQVBJIHRoaXMgbGliIGNvdWxkIGhhdmUgLSBpJ2xsIGNvdmVyIGl0IGZ1bGx5IHdpdGhcbiAgICB0ZXN0cywgYW5kIG9ubHkgYWZ0ZXIgdGhhdCB3aWxsIGkgZXZlbiBjb25zaWRlciB0YWtpbmcgYW55IHBlcmZvcm1hbmNlIGlzc3VlcyBpbnRvIGFjY291bnQuXG4gICAgKi9cbiAgICBwcml2YXRlIHRyaWdnZXJEZWxlZ2F0ZTogRXZlbnRUcmlnZ2VyZXI8VD4gPSBudWxsO1xuXG4gICAgcHJpdmF0ZSBsaXN0ZW5EZWxlZ2F0ZTogRXZlbnRMaXN0ZW5lcjxUPiA9IG51bGw7XG4gICAgcHJpdmF0ZSBtYXRjaERlbGVnYXRlOiBFdmVudE1hdGNoTGlzdGVuZXI8VD4gPSBudWxsO1xuICAgIHByaXZhdGUgbWF0Y2hPbmNlRGVsZWdhdGU6IEV2ZW50TWF0Y2hPbmNlcjxUPiA9IG51bGw7XG4gICAgcHJpdmF0ZSB1bmxpc3RlbkRlbGVnYXRlOiBFdmVudFVubGlzdGVuZXI8VD4gPSBudWxsO1xuXG4gICAgcHJpdmF0ZSBvbmNlRGVsZWdhdGU6IEV2ZW50T25jZXI8VD4gPSBudWxsO1xuXG4gICAgcHJpdmF0ZSB3aGVuRGVsZWdhdGU6IEV2ZW50V2hlbmVyPFQ+ID0gbnVsbDtcblxuICAgIHByaXZhdGUgdGhlbkRlbGVnYXRlOiBFdmVudFRoZW5lcjxUPiA9IG51bGw7XG4gICAgcHJpdmF0ZSBjYXRjaERlbGVnYXRlOiBFdmVudENhdGNoZXI8VD4gPSBudWxsO1xuXG4gICAgcHJpdmF0ZSBwcm9taXNlOiBQcm9taXNlPFQ+ID0gbnVsbDsgXG4gICAgcHJpdmF0ZSByZXNvbHZlOiAodmFsdWU6IFQpID0+IFQ7XG4gICAgcHJpdmF0ZSBpc0ZpcnN0VHJpZ2dlckRvbmU6IGJvb2xlYW4gPSBmYWxzZTtcblxuICAgIHByaXZhdGUgaWRDb3VudGVyOiBudW1iZXIgPSAwO1xuXG5cbiAgICBjb25zdHJ1Y3RvcigpIHtcbiAgICAgICAgdGhpcy50cmlnZ2VyRGVsZWdhdGUgPSAoZXZlbnRBcmc6IFQpID0+IHRoaXMudHJpZ2dlcihldmVudEFyZyk7XG4gICAgICAgIHRoaXMubGlzdGVuRGVsZWdhdGUgPSAoLi4uYXJnczogYW55W10pOiB2b2lkID0+IHtcbiAgICAgICAgICAgIHJldHVybiB0aGlzLmxpc3Rlbi5hcHBseSh0aGlzLCBhcmdzKTtcbiAgICAgICAgfTtcbiAgICAgICAgdGhpcy5tYXRjaERlbGVnYXRlID0gKC4uLmFyZ3M6IGFueVtdKTogdm9pZCA9PiB7XG4gICAgICAgICAgICByZXR1cm4gdGhpcy5tYXRjaC5hcHBseSh0aGlzLCBhcmdzKTtcbiAgICAgICAgfTtcbiAgICAgICAgdGhpcy5tYXRjaE9uY2VEZWxlZ2F0ZSA9ICguLi5hcmdzOiBhbnlbXSk6IHZvaWQgPT4ge1xuICAgICAgICAgICAgcmV0dXJuIHRoaXMubWF0Y2hPbmNlLmFwcGx5KHRoaXMsIGFyZ3MpO1xuICAgICAgICB9OyBcbiAgICAgICAgdGhpcy51bmxpc3RlbkRlbGVnYXRlID0gKC4uLmFyZ3M6IGFueVtdKTogdm9pZCA9PiB7XG4gICAgICAgICAgICByZXR1cm4gdGhpcy51bmxpc3Rlbi5hcHBseSh0aGlzLCBhcmdzKTtcbiAgICAgICAgfTtcbiAgICAgICAgdGhpcy5vbmNlRGVsZWdhdGUgPSAoaGFuZGxlcjogRXZlbnRIYW5kbGVyPFQ+LCBjb250ZXh0OiBPYmplY3QgPSBudWxsKSA9PiB7XG4gICAgICAgICAgICByZXR1cm4gdGhpcy5vbmNlKGhhbmRsZXIsIGNvbnRleHQpO1xuICAgICAgICB9O1xuICAgICAgICB0aGlzLndoZW5EZWxlZ2F0ZSA9ICgpID0+IHtcbiAgICAgICAgICAgIHJldHVybiB0aGlzLndoZW4oKTtcbiAgICAgICAgfTtcbiAgICAgICAgdGhpcy50aGVuRGVsZWdhdGUgPSAob25PazogRXZlbnRIYW5kbGVyPFQ+LCBvbkZhaWw6IEZ1bmN0aW9uKSA9PiB7XG4gICAgICAgICAgICByZXR1cm4gdGhpcy50aGVuKG9uT2ssIDxhbnk+b25GYWlsKTtcbiAgICAgICAgfTtcbiAgICAgICAgdGhpcy5jYXRjaERlbGVnYXRlID0gKG9uRmFpbDogRnVuY3Rpb24pID0+IHtcbiAgICAgICAgICAgIHJldHVybiB0aGlzLmNhdGNoKDxhbnk+b25GYWlsKTtcbiAgICAgICAgfTtcbiAgICAgICAgdGhpcy5wcm9taXNlID0gbmV3IFByb21pc2UoKHJlc29sdmU6IGFueSkgPT4geyB0aGlzLnJlc29sdmUgPSByZXNvbHZlOyB9KTtcbiAgICB9XG4gICAgXG4gICAgLyoqXG4gICAgICogTWl4IHRoaXMgZXZlbnRzIG1ldGhvZHMgaW50byB0aGUgdGFyZ2V0IG9iamVjdC5cbiAgICAgKiBUaGlzIGlzIGEgd2F5IHRvIGFkZCB0aGUgZXZlbnQgZnVuY3Rpb25hbGl0eSB0byBzb21lIGV4aXN0aW5nIG9iamVjdCxcbiAgICAgKiB3aXRob3V0IG1lc3Npbmcgd2l0aCBpdCdzIGluaGVyaXRhbmNlIGNoYWluLlxuICAgICAqL1xuICAgIG1peGluKHRhcmdldDogYW55KTogRXZlbnRUcmFpdDxUPiB7XG4gICAgICAgIHRhcmdldC50cmlnZ2VyID0gdGhpcy5nZXRUcmlnZ2VyZXIoKTtcbiAgICAgICAgdGFyZ2V0LmdldFRyaWdnZXJlciA9ICgpPT57XG4gICAgICAgICAgICByZXR1cm4gdGhpcy5nZXRUcmlnZ2VyZXIoKTtcbiAgICAgICAgfVxuXG4gICAgICAgIHRhcmdldC5saXN0ZW4gPSB0aGlzLmdldExpc3RlbmVyKCk7XG4gICAgICAgIHRhcmdldC5tYXRjaCA9IHRoaXMuZ2V0TWF0Y2hMaXN0ZW5lcigpO1xuICAgICAgICB0YXJnZXQubWF0Y2hPbmNlID0gdGhpcy5nZXRNYXRjaE9uY2VyKCk7XG4gICAgICAgIHRhcmdldC51bmxpc3RlbiA9IHRoaXMuZ2V0VW5saXN0ZW5lcigpO1xuXG4gICAgICAgIHRhcmdldC5vbmNlID0gdGhpcy5nZXRPbmNlcigpO1xuXG4gICAgICAgIHRhcmdldC53aGVuID0gdGhpcy5nZXRXaGVuZXIoKTtcbiAgICAgICAgdGFyZ2V0LnRoZW4gPSB0aGlzLmdldFRoZW5lcigpO1xuICAgICAgICB0YXJnZXQuY2F0Y2ggID10aGlzLmdldENhdGNoZXIoKTtcblxuICAgICAgICByZXR1cm4gdGFyZ2V0O1xuICAgIH1cblxuICAgIC8qKiBSZXR1cm5zIGEgY29udGV4dC1pbmRlcGVuZGVudCBjYWxsYmFjayB0aGF0IHRyaWdnZXJzIHRoZSBldmVudCB3aXRoIGdpdmVuIGFyZ3VtZW50ICovXG4gICAgZ2V0VHJpZ2dlcmVyKCk6IEV2ZW50VHJpZ2dlcmVyPFQ+IHsgcmV0dXJuIHRoaXMudHJpZ2dlckRlbGVnYXRlOyB9XG4gICAgZ2V0TGlzdGVuZXIoKTogRXZlbnRMaXN0ZW5lcjxUPiB7IHJldHVybiB0aGlzLmxpc3RlbkRlbGVnYXRlOyB9XG4gICAgZ2V0TWF0Y2hMaXN0ZW5lcigpOiBFdmVudE1hdGNoTGlzdGVuZXI8VD4geyByZXR1cm4gdGhpcy5tYXRjaERlbGVnYXRlOyB9XG4gICAgZ2V0TWF0Y2hPbmNlcigpOiBFdmVudE1hdGNoT25jZXI8VD4geyByZXR1cm4gdGhpcy5tYXRjaE9uY2VEZWxlZ2F0ZTsgfVxuICAgIGdldFVubGlzdGVuZXIoKTogRXZlbnRVbmxpc3RlbmVyPFQ+IHsgcmV0dXJuIHRoaXMudW5saXN0ZW5EZWxlZ2F0ZTsgfVxuICAgIGdldE9uY2VyKCk6IEV2ZW50T25jZXI8VD4geyByZXR1cm4gdGhpcy5vbmNlRGVsZWdhdGU7IH1cbiAgICBnZXRXaGVuZXIoKTogRXZlbnRXaGVuZXI8VD4geyByZXR1cm4gdGhpcy53aGVuRGVsZWdhdGU7IH1cbiAgICBnZXRUaGVuZXIoKTogRXZlbnRUaGVuZXI8VD4geyByZXR1cm4gdGhpcy50aGVuRGVsZWdhdGU7IH1cbiAgICBnZXRDYXRjaGVyKCk6IEV2ZW50Q2F0Y2hlcjxUPiB7IHJldHVybiB0aGlzLmNhdGNoRGVsZWdhdGU7IH1cblxuICAgIC8qKlxuICAgICAqIFRyaWdnZXJzIHRoZSBldmVudCB3aXRoIGdpdmVuIGFyZ3VtZW50LCBpbnZva2luZyBhbGwgb2YgaXRzIGhhbmRsZXJzLCBhbmQgaWZcbiAgICAgKiB0aGUgZXZlbnQgaXMgdHJpZ2dlcmVkIGZvciB0aGUgZmlyc3QgdGltZSAtIHJlbW92aW5nIHRoZSBvbmNlIGV2ZW50IGhhbmRsZXJzIGFuZFxuICAgICAqIHNhdmluZyBnaXZlbiBhcmd1bWVudCBpbmV0cm5hbGx5IGFzIGZpcnN0IHRyaWdnZXIgYXJndW1lbnQuXG4gICAgICogXG4gICAgICogVGhlIGFyZ3VtZW50IGlzIG9wdGlvbmFsLCBzaW5jZSBldmVudCBjYW4gYmUgb2Ygdm9pZCB0eXBlIChgeD0gbmV3IEV2ZW50PHZvaWQ+KClgKSxcbiAgICAgKiBidXQgaWYgdGhlIGV2ZW50IGlzIG5vdCBvZiBhIHZvaWQgdHlwZSAtIHlvdSBzaG91bGQgYWxsd2F5cyBwYXNzIGFuIGFyZ3VtZW50IHRvXG4gICAgICogdGhlIHRyaWdnZXIgbWV0aG9kLlxuICAgICAqL1xuICAgIHRyaWdnZXIoZXZlbnRBcmc/OiBUKTogdm9pZCB7XG4gICAgICAgIGlmICh0aGlzLmlzQmVpbmdUcmlnZ2VyZWQpIHtcbiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihgRXZlbnQgdHJpZ2dlcmVkIGR1cmluZyB0cmlnZ2VyIGhhbmRsaW5nIC0gc3VzcGVjdGluZyByZWN1cnNpdmUgZXZlbnQuYCk7XG4gICAgICAgIH1cbiAgICAgICAgdGhpcy5pc0JlaW5nVHJpZ2dlcmVkID0gdHJ1ZTtcbiAgICAgICAgaWYgKCF0aGlzLmlzRmlyc3RUcmlnZ2VyRG9uZSkge1xuICAgICAgICAgICAgdGhpcy5pc0ZpcnN0VHJpZ2dlckRvbmUgPSB0cnVlO1xuICAgICAgICAgICAgdGhpcy5yZXNvbHZlKGV2ZW50QXJnKTtcbiAgICAgICAgfVxuICAgICAgICB0aGlzLmxpc3RlbmVycy5zbGljZSgpLmZvckVhY2goKGxpc3RlbmVyKSA9PiB7XG4gICAgICAgICAgICBsZXQgZG9DYWxsID0gdHJ1ZTtcbiAgICAgICAgICAgIGlmIChsaXN0ZW5lci5vbmx5TWF0Y2hpbmcpIHtcbiAgICAgICAgICAgICAgICBkb0NhbGwgPSBsaXN0ZW5lci5tYXRjaFZhbHVlID09PSBldmVudEFyZztcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIFxuICAgICAgICAgICAgaWYgKGRvQ2FsbCkge1xuICAgICAgICAgICAgICAgIGlmIChsaXN0ZW5lci5jb250ZXh0KSB7XG4gICAgICAgICAgICAgICAgICAgIGxpc3RlbmVyLmhhbmRsZXIuY2FsbChsaXN0ZW5lci5jb250ZXh0LCBldmVudEFyZyk7IFxuICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIGxpc3RlbmVyLmhhbmRsZXIuY2FsbChudWxsLCBldmVudEFyZyk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGlmIChsaXN0ZW5lci5vbmNlKSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMucmVtb3ZlTGlzdGVuZXIobGlzdGVuZXIpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgICAgIHRoaXMuaXNCZWluZ1RyaWdnZXJlZCA9IGZhbHNlO1xuICAgIH0gIFxuXG4gICAgLyoqXG4gICAgICogQWRkcyBhIGxpc3RlbmVyLiBJZiBvbmNlPXRydWUgdGhlbiBhZGRzIG9uY2UgbGlzdGVuZXIgd2hpY2ggbWVhbnMgdGhhdCBsaXN0ZW5lciB3aWxsIGJlIHJlbW92ZWQsXG4gICAgICogd2hlbiBldmVudCB0cmlnZ2VycyBmb3IgdGhlIGZpcnN0IHRpbWUuIEFsc28gaWYgZXZlbnQgYWxscmVhZHkgd2FzIHRyaWdnZXJlZCBmb3IgdGhlIGZpcnN0IHRpbWVcbiAgICAgKiB3aGVuIHlvdSBjYWxsICdhZGQoKScgdGhlbiBvbmNlIGxpc3RlbmVyIHdpbGwgbm90IGJlIGFkZGVkIGJ1dCBpbnN0ZWFkIGludm9rZWQgaW1taWRpYXRlbHksXG4gICAgICogd2l0aCBhcmd1bWVudCwgdGhhdCBldmVudCB3YXMgdHJpZ2dlcmVkIHdpdGggdGhlIGZpcnN0IHRpbWUuXG4gICAgICovXG4gICAgbGlzdGVuKGhhbmRsZXI6IEV2ZW50SGFuZGxlcjxUPiwgY29udGV4dD86IE9iamVjdCk6IG51bWJlcjtcbiAgICBsaXN0ZW4obmFtZTogc3RyaW5nLCBoOiBFdmVudEhhbmRsZXI8VD4sIGNvbnRleHQ/OiBPYmplY3QpOiBudW1iZXI7XG4gICAgbGlzdGVuKC4uLmFyZ3M6IGFueVtdKTogbnVtYmVyIHtcbiAgICAgICAgbGV0IGlkOiBudW1iZXI7XG4gICAgICAgIGlmICh0eXBlb2YgYXJnc1swXSA9PT0gJ3N0cmluZycpIHtcbiAgICAgICAgICAgIGxldCBbbmFtZSwgaGFuZGxlciwgY29udGV4dF0gPSBhcmdzO1xuICAgICAgICAgICAgaWQgPSB0aGlzLmFkZExpc3RlbmVyKHsgbmFtZSwgaGFuZGxlciwgY29udGV4dCB9KTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIGxldCBbaGFuZGxlciwgY29udGV4dF0gPSBhcmdzO1xuICAgICAgICAgICAgaWQgPSB0aGlzLmFkZExpc3RlbmVyKHsgaGFuZGxlciwgY29udGV4dCB9KTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gaWQ7XG4gICAgfTtcblxuICAgIC8qKlxuICAgICAqIEFkZHMgYSBsaXN0ZW5lciwgd2hpY2ggd2lsbCBiZSBpbnZva2VkIG9ubHkgaWYgdGhlIGV2ZW50LWFyZ3VtZW50IGlzIGRlZXBseS1lcXVhbCB0b1xuICAgICAqIHRoZSBnaXZlbiB2YWx1ZS5cbiAgICAgKi9cbiAgICBtYXRjaCh2YWx1ZTogVCwgaDogRXZlbnRIYW5kbGVyPFQ+LCBjb250ZXh0PzogT2JqZWN0KTogbnVtYmVyO1xuICAgIG1hdGNoKHZhbHVlOiBULCBuYW1lOiBzdHJpbmcsIGg6IEV2ZW50SGFuZGxlcjxUPiwgY29udGV4dD86IE9iamVjdCk6IG51bWJlcjtcbiAgICBtYXRjaCh2YWx1ZTogVCwgLi4uYXJnczogYW55W10pOiBudW1iZXIge1xuICAgICAgICBsZXQgaWQ6IG51bWJlcjtcbiAgICAgICAgaWYgKHR5cGVvZiBhcmdzWzBdID09PSAnc3RyaW5nJykge1xuICAgICAgICAgICAgbGV0IFtuYW1lLCBoYW5kbGVyLCBjb250ZXh0XSA9IGFyZ3M7XG4gICAgICAgICAgICBpZCA9IHRoaXMuYWRkTGlzdGVuZXIoeyBuYW1lLCBoYW5kbGVyLCBjb250ZXh0LCBvbmx5TWF0Y2hpbmc6IHRydWUsIG1hdGNoVmFsdWU6IHZhbHVlIH0pO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgbGV0IFtoYW5kbGVyLCBjb250ZXh0XSA9IGFyZ3M7XG4gICAgICAgICAgICBpZCA9IHRoaXMuYWRkTGlzdGVuZXIoeyBoYW5kbGVyLCBjb250ZXh0LCBvbmx5TWF0Y2hpbmc6IHRydWUsIG1hdGNoVmFsdWU6IHZhbHVlIH0pO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiBpZDtcbiAgICB9O1xuXG4gICAgLyoqXG4gICAgICogQ29tYmluZXMgJ21hdGNoJyBhbmQgJ29uY2UnIGZlYXR1cmVzLlxuICAgICAqL1xuICAgIG1hdGNoT25jZSh2YWx1ZTogVCwgaGFuZGxlcjogRXZlbnRIYW5kbGVyPFQ+LCBjb250ZXh0OiBPYmplY3QgPSBudWxsKTogbnVtYmVyIHtcbiAgICAgICAgIHJldHVybiB0aGlzLmFkZExpc3RlbmVyKHsgY29udGV4dCwgaGFuZGxlciwgb25jZTogdHJ1ZSwgb25seU1hdGNoaW5nOiB0cnVlLCBtYXRjaFZhbHVlOiB2YWx1ZSB9KTtcbiAgICB9XG5cbiAgICBvbmNlKGhhbmRsZXI6IEV2ZW50SGFuZGxlcjxUPiwgY29udGV4dDogT2JqZWN0ID0gbnVsbCk6IG51bWJlciB7XG4gICAgICAgICByZXR1cm4gdGhpcy5hZGRMaXN0ZW5lcih7IGNvbnRleHQsIGhhbmRsZXIsIG9uY2U6IHRydWUgfSk7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogUmVtb3ZlIGEgbGlzdGVuZXIocykuIFdoZW4gbm8gY29udGV4dCBnaXZlbiByZW1vdmVzIGFsbCBsaXN0ZW5lcnMsIHRoYXQgd2VyZSBhdHRhY2hlZFxuICAgICAqIHdpdGhvdXQgYSBjb250ZXh0LiBXaGVuIGEgY29udGV4dCBpcyBnaXZlbiByZW1vdmVzIG9ubHkgbGlzdGVuZXJzIHRoYXQgd2VyZSBhdHRhY2hlZCB3aXRoXG4gICAgICogdGhhdCBjb250ZXh0IGFuZCBkb2Vzbid0IHJlbW92ZSBhbnkgbGlzdGVuZXJzIHRoYXQgd2VyZSBhdHRhY2hlZCB3aXRob3V0IGEgY29udGV4dC5cbiAgICAgKi9cbiAgICB1bmxpc3RlbihoYW5kbGVyOiBFdmVudEhhbmRsZXI8VD4sIGNvbnRleHQ/OiBPYmplY3QpOiB2b2lkO1xuICAgIHVubGlzdGVuKGNvbnRleHQ6IE9iamVjdCk6IHZvaWQ7XG4gICAgdW5saXN0ZW4obmFtZTogc3RyaW5nKTogdm9pZDtcbiAgICB1bmxpc3RlbihpZDogbnVtYmVyKTogdm9pZDtcbiAgICB1bmxpc3RlbigpOiB2b2lkO1xuICAgIHVubGlzdGVuKC4uLmFyZ3M6IGFueVtdKTogdm9pZCB7XG4gICAgICAgIGxldCBuYW1lOiBzdHJpbmcgPSBudWxsLCBjb250ZXh0OiBPYmplY3QsIGhhbmRsZXI6IEV2ZW50SGFuZGxlcjxUPiwgaWRUb1JlbW92ZTogbnVtYmVyID0gbnVsbDsgXG4gICAgICAgIHN3aXRjaCAoYXJncy5sZW5ndGgpIHtcbiAgICAgICAgICAgIGNhc2UgMDogdGhpcy5saXN0ZW5lcnMgPSBbXTsgcmV0dXJuO1xuICAgICAgICAgICAgY2FzZSAxOlxuICAgICAgICAgICAgICAgIGlmICh0eXBlb2YgYXJnc1swXSA9PT0gJ3N0cmluZycpIHtcbiAgICAgICAgICAgICAgICAgICAgbmFtZSA9IGFyZ3NbMF07XG4gICAgICAgICAgICAgICAgICAgIGhhbmRsZXIgPSBhcmdzWzFdO1xuICAgICAgICAgICAgICAgICAgICBjb250ZXh0ID0gYXJnc1syXTtcbiAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKHR5cGVvZiBhcmdzWzBdID09PSAnbnVtYmVyJykge1xuICAgICAgICAgICAgICAgICAgICBpZFRvUmVtb3ZlID0gYXJnc1swXTtcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICBoYW5kbGVyID0gYXJnc1swXTtcbiAgICAgICAgICAgICAgICAgICAgY29udGV4dCA9IGFyZ3NbMV07XG4gICAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIGNhc2UgMjpcbiAgICAgICAgICAgICAgICBoYW5kbGVyID0gYXJnc1swXTtcbiAgICAgICAgICAgICAgICBjb250ZXh0ID0gYXJnc1sxXTtcbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIFxuICAgICAgICB9XG4gICAgICAgIHRoaXMubGlzdGVuZXJzID0gXy5maWx0ZXIodGhpcy5saXN0ZW5lcnMsIChoQ29uZjogRXZlbnRIYW5kbGVyRGVzY3JpcHRvcjxUPikgPT4ge1xuICAgICAgICAgICAgbGV0IGRpZmZlcmVudEhhbmRsZXI6IGJvb2xlYW4gPSBoQ29uZi5oYW5kbGVyICE9PSBoYW5kbGVyO1xuICAgICAgICAgICAgbGV0IG5vQ29udGV4dEdpdmVuOiBib29sZWFuID0gY29udGV4dCA9PT0gbnVsbDtcbiAgICAgICAgICAgIGxldCBjb25mSGFzTm9Db250ZXh0OiBib29sZWFuID0gISFoQ29uZi5jb250ZXh0O1xuICAgICAgICAgICAgbGV0IGRpZmZlcmVudENvbnRleHQ6IGJvb2xlYW4gPSBoQ29uZi5jb250ZXh0ICE9PSBjb250ZXh0O1xuICAgICAgICAgICAgbGV0IHNhbWVOYW1lID0gbmFtZSAmJiBoQ29uZi5uYW1lICYmIChuYW1lID09PSBoQ29uZi5uYW1lKTtcbiAgICAgICAgICAgIGxldCBkb250UmVtb3ZlOiBib29sZWFuO1xuICAgICAgICAgICAgaWYgKGlkVG9SZW1vdmUgIT09IG51bGwpIHtcbiAgICAgICAgICAgICAgICBkb250UmVtb3ZlID0gaWRUb1JlbW92ZSAhPT0gaENvbmYuaWQ7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIGlmIChuYW1lKSB7XG4gICAgICAgICAgICAgICAgICAgIGRvbnRSZW1vdmUgPSAhc2FtZU5hbWU7XG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKGRpZmZlcmVudEhhbmRsZXIpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGRvbnRSZW1vdmUgPSB0cnVlO1xuICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgZG9udFJlbW92ZSA9IG5vQ29udGV4dEdpdmVuID8gKCFjb25mSGFzTm9Db250ZXh0KSA6IChjb25mSGFzTm9Db250ZXh0IHx8IGRpZmZlcmVudENvbnRleHQpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgICAgXG4gICAgICAgICAgICByZXR1cm4gZG9udFJlbW92ZTtcbiAgICAgICAgfSk7XG4gICAgfVxuXG4gICAgb24obmFtZTogc3RyaW5nLCBoOiBFdmVudEhhbmRsZXI8VD4pOiBudW1iZXI7XG4gICAgb24oaGFuZGxlcjogRXZlbnRIYW5kbGVyPFQ+KTogbnVtYmVyO1xuICAgIG9uKG5hbWVPckhhbmRsZXI6IEV2ZW50SGFuZGxlcjxUPnxzdHJpbmcsIGhhbmRsZXJPck5vdGhpbmc/OiBFdmVudEhhbmRsZXI8VD4pOiBudW1iZXIge1xuICAgICAgICByZXR1cm4gdGhpcy5saXN0ZW4uYXBwbHkodGhpcywgYXJndW1lbnRzKTtcbiAgICB9XG5cbiAgICBvZmYoaGFuZGxlcjogRXZlbnRIYW5kbGVyPFQ+LCBjb250ZXh0PzogT2JqZWN0KTogdm9pZDtcbiAgICBvZmYoY29udGV4dDogT2JqZWN0KTogdm9pZDtcbiAgICBvZmYobmFtZTogc3RyaW5nKTogdm9pZDtcbiAgICBvZmYoaWQ6IG51bWJlcik6IHZvaWQ7XG4gICAgb2ZmKCk6IHZvaWQ7XG4gICAgb2ZmKGJ1bGxzaGl0V1RGPzogRXZlbnRIYW5kbGVyPFQ+fHN0cmluZ3xudW1iZXIsIGNvbnRleHQ/OiBPYmplY3QpOiB2b2lkIHtcbiAgICAgICAgcmV0dXJuIHRoaXMudW5saXN0ZW4uYXBwbHkodGhpcywgYXJndW1lbnRzKTtcbiAgICB9XG5cbiAgICB3aGVuKCk6IFByb21pc2U8VD4geyByZXR1cm4gdGhpcy5wcm9taXNlOyB9XG4gICAgdGhlbihvbk9rOiAocjogVCk9PiBUfGFueSwgb25GYWlsPzogKGU6IGFueSk9PlR8YW55KTogUHJvbWlzZTxUPiB7IHJldHVybiB0aGlzLndoZW4oKS50aGVuKG9uT2ssIG9uRmFpbCk7IH1cbiAgICBhZnRlcihvbkFueTogKHI6IFR8YW55KT0+VHxhbnkpOiBQcm9taXNlPFQ+IHsgcmV0dXJuIHRoaXMudGhlbihvbkFueSkuY2F0Y2gob25BbnkpO31cbiAgICBjYXRjaChvbkZhaWw6IChlOiBhbnkpPT5UfGFueSk6IFByb21pc2U8VD4geyByZXR1cm4gdGhpcy53aGVuKCkuY2F0Y2gob25GYWlsKTsgfVxuXG4gICAgLyoqXG4gICAgICogUGlwaW5nIHRoZSBldmVudHMgbWVhbnMgdGhhdCB0aGUgb3RoZXIgZXZlbnQgbXVzdCBiZSB0cmlnZ2VyZWQoaGFwcGVuKSBhbnkgdGltZVxuICAgICAqIHRoaXMgZXZlbnQgaGFwcGVucyBhbmQgd2l0aCBleGFjdGx5IHRoZSBzYW1lIGFyZ3VtZW50LlxuICAgICAqL1xuICAgIHBpcGUob3RoZXI6IEV2ZW50PFQ+KTogdm9pZCB7XG4gICAgICAgIHRoaXMub24ob3RoZXIuZ2V0VHJpZ2dlcmVyKCkpO1xuICAgIH1cbiAgICB1bnBpcGUob3RoZXI6IEV2ZW50PFQ+KTogdm9pZCB7XG4gICAgICAgIHRoaXMub2ZmKG90aGVyLmdldFRyaWdnZXJlcigpKTtcbiAgICB9XG5cbiAgICBwcml2YXRlIHJlbW92ZUxpc3RlbmVyKGxpc3RlbmVyOiBFdmVudEhhbmRsZXJEZXNjcmlwdG9yPFQ+KTogdm9pZCB7XG4gICAgICAgIGxldCBsaXN0ZW5lckluZGV4ID0gdGhpcy5saXN0ZW5lcnMuaW5kZXhPZihsaXN0ZW5lcik7XG4gICAgICAgIGlmIChsaXN0ZW5lckluZGV4ICE9PSAtMSkge1xuICAgICAgICAgICAgdGhpcy5saXN0ZW5lcnMuc3BsaWNlKGxpc3RlbmVySW5kZXgsIDEpO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgcHJpdmF0ZSBhZGRMaXN0ZW5lcihvcHRpb25zOiBFdmVudEhhbmRsZXJPcHRpb25zPFQ+KTogbnVtYmVyIHtcbiAgICAgICAgbGV0IHtjb250ZXh0LCBoYW5kbGVyLCBvbmNlLCBvbmx5TWF0Y2hpbmcsIG1hdGNoVmFsdWV9ID0gb3B0aW9ucztcbiAgICAgICAgdGhpcy5pZENvdW50ZXIrKztcbiAgICAgICAgdGhpcy5saXN0ZW5lcnMucHVzaCh7Y29udGV4dCwgaGFuZGxlciwgb25jZSwgaWQ6IHRoaXMuaWRDb3VudGVyLCBvbmx5TWF0Y2hpbmcsIG1hdGNoVmFsdWV9KTtcbiAgICAgICAgcmV0dXJuIHRoaXMuaWRDb3VudGVyO1xuICAgIH1cbn1cblxuZXhwb3J0IHtcbiAgICBFdmVudEhhbmRsZXIsXG4gICAgRXZlbnRIYW5kbGVyT3B0aW9ucyxcbiAgICBFdmVudEhhbmRsZXJEZXNjcmlwdG9yLFxuICAgIEV2ZW50VHJpZ2dlcmVyLFxuICAgIEV2ZW50TGlzdGVuZXIsXG4gICAgRXZlbnRVbmxpc3RlbmVyLFxuICAgIEV2ZW50T25jZXIsXG4gICAgRXZlbnRNYXRjaExpc3RlbmVyLFxuICAgIEV2ZW50TWF0Y2hPbmNlcixcbiAgICBFdmVudFdoZW5lcixcbiAgICBFdmVudFRoZW5lcixcbiAgICBFdmVudENhdGNoZXIsXG4gICAgRXZlbnRUcmFpdCxcbiAgICBUaGVuYWJsZSxcbiAgICBFdmVudEVtaXR0ZXIsXG4gICAgRXZlbnRUcmFpdFRyaWdnZXIsXG59XG5cbmV4cG9ydCBkZWZhdWx0IEV2ZW50OyJdfQ==